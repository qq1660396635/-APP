<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>å¯¼èˆªä¸­å¿ƒ</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{ font-family:-apple-system, BlinkMacSystemFont,'Segoe UI', Roboto,'Helvetica Neue',Arial, sans-serif; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);background-size:cover;background-position: center; background-attachment: fixed; min-height: 100vh; padding: 15px;}
.container{max-width:1400px;margin:0 auto;position:relative;}

/* é¡¶éƒ¨æœç´¢æ  */
.top-search{position:fixed;top:15px;left:50%;transform:translateX(-50%);z-index:100;display:flex;align-items:center;background:rgba(255,255,255,0.95);border-radius:25px;padding:8px 20px;box-shadow:0 4px 15px rgba(0,0,0,0.2);backdrop-filter:blur(10px);animation:slideDown 0.5s ease;}
.search-input{border:none;background:transparent;padding:5px 10px;font-size:14px;width:200px;outline:none;}
.search-input::placeholder{color:#999;}
.search-icon{color:#667eea;font-size:16px;}

/* ä¾§è¾¹æ  */
.sidebar{position:fixed;left:-280px;top:0;width:280px;height:100vh;background:rgba(255,255,255,0.98);box-shadow:2px 0 15px rgba(0,0,0,0.2);z-index:200;transition:left 0.3s ease;overflow-y:auto;}
.sidebar.open{left:0;}
.sidebar-toggle{position:fixed;left:15px;top:20px;width:40px;height:40px;background:rgba(255,255,255,0.95);border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 4px 15px rgba(0,0,0,0.2);z-index:199;transition:all 0.3s ease;}
.sidebar-toggle:hover{transform:scale(1.1);}
.sidebar-toggle.open{left:295px;}
.sidebar-toggle i{color:#667eea;font-size:18px;transition:transform 0.3s ease;}
.sidebar-toggle.open i{transform:rotate(180deg);}

.sidebar-header{padding:20px;border-bottom:1px solid #e0e0e0;}
.sidebar-title{font-size:1.2rem;font-weight:600;color:#333;margin-bottom:15px;}
.sidebar-section{padding:20px;border-bottom:1px solid #e0e0e0;}
.sidebar-section:last-child{border-bottom:none;}
.section-title{font-size:0.9rem;font-weight:600;color:#666;margin-bottom:15px;text-transform:uppercase;letter-spacing:1px;}

/* ä¾§è¾¹æ æŒ‰é’® */
.sidebar-btn{width:100%;padding:10px 15px;margin-bottom:8px;border:none;border-radius:8px;font-size:14px;font-weight:500;cursor:pointer;transition:all 0.3s ease;text-align:left;display:flex;align-items:center;gap:10px;}
.sidebar-btn.primary{background:linear-gradient(135deg,#667eea,#764ba2);color:white;}
.sidebar-btn.secondary{background:#f5f5f5;color:#333;}
.sidebar-btn.danger{background:linear-gradient(135deg,#f093fb,#f5576c);color:white;}
.sidebar-btn:hover{transform:translateX(5px);box-shadow:0 3px 10px rgba(0,0,0,0.15);}
.sidebar-btn i{width:16px;text-align:center;}

/* æ¨¡å¼åˆ‡æ¢ */
.mode-switch{display:flex;align-items:center;gap:10px;margin-bottom:15px;}
.switch{position:relative;width:50px;height:26px;}
.switch input{opacity:0;width:0;height:0;}
.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;transition:.4s;border-radius:26px;}
.slider:before{position:absolute;content:"";height:20px;width:20px;left:3px;bottom:3px;background-color:white;transition:.4s;border-radius:50%;}
input:checked+.slider{background-color:#667eea;}
input:checked+.slider:before{transform:translateX(24px);}

/* åˆ†é¡µ */
.sidebar-pagination{display:flex;flex-direction:column;gap:8px;}
.pagination-btn{padding:8px 12px;border:none;border-radius:6px;background:#f5f5f5;color:#667eea;cursor:pointer;font-weight:500;transition:all 0.3s ease;font-size:14px;}
.pagination-btn:hover{background:#667eea;color:white;}
.pagination-btn.active{background:linear-gradient(135deg,#667eea,#764ba2);color:white;}
.pagination-info{text-align:center;color:#666;font-size:12px;margin-top:5px;}

/* ä¸»å†…å®¹åŒº */
.main-content{padding-top:60px;transition:margin-left 0.3s ease;}
.main-content.shifted{margin-left:280px;}
header{text-align: center; margin-bottom:15px;color:white;}
h1{ font-size: 1.5rem; margin-bottom: 5px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); animation: fadeInDown 0.8s ease;}
.subtitle{font-size:0.9rem;opacity:0.9;animation:fadeInUp 0.8s ease;}

.cards-container{display:grid;grid-template-columns:repeat(auto-fit,minmax(400px,1fr));gap:25px;max-width:1200px;margin:0 auto;}
.card{background:rgba(255,255,255,0.95);border-radius:15px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,0.2);backdrop-filter:blur(10px);animation:fadeIn 0.8s ease;min-height:200px;}
.card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;padding-bottom:10px;border-bottom:2px solid #e0e0e0;}
.card-title{font-size:1.2rem;font-weight:600;color:#333;}
.card-count{background:linear-gradient(135deg,#667eea,#764ba2);color:white;padding:5px 12px;border-radius:15px;font-size:12px;}
.links-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;}
.link-item{display:flex;flex-direction:column;align-items:center;padding:8px 4px;border-radius:8px;background:#f8f9fa;text-decoration:none;color:#333;transition:all 0.3s ease;cursor:pointer;min-height:60px;}
.link-item:hover{background:linear-gradient(135deg,#667eea,#764ba2);color:white;transform:translateY(-2px);box-shadow:0 3px 10px rgba(0,0,0,0.2);}
.link-icon{font-size:18px;margin-bottom:3px;}
.link-name{font-size:11px;text-align:center;line-height:1.2;word-break:break-all;font-weight:500;}

/* iframeå®¹å™¨ */
.iframe-container{position:fixed;top:0;left:0;width:100%;height:100%;background:white;z-index:300;display:none;}
.iframe-container.active{display:block;}
.site-iframe{width:100%;height:100%;border:none;}
.iframe-header{position:fixed;top:0;left:0;width:100%;height:50px;background:rgba(255,255,255,0.95);backdrop-filter:blur(10px);box-shadow:0 2px 10px rgba(0,0,0,0.1);z-index:301;display:flex;align-items:center;justify-content:space-between;padding:0 20px;}
.iframe-title{font-size:16px;font-weight:600;color:#333;}
.iframe-controls{display:flex;gap:10px;}
.iframe-btn{padding:8px 15px;border:none;border-radius:6px;background:#667eea;color:white;cursor:pointer;font-size:14px;transition:all 0.3s ease;}
.iframe-btn:hover{background:#5569d8;}
.iframe-btn.close{background:#f5576c;}
.iframe-btn.close:hover{background:#e6465b;}

.no-data{text-align:center;color:white;padding:60px 20px;font-size:18px;background:rgba(255,255,255,0.1);border-radius:15px;margin:20px auto;max-width:600px;}

/* æ¨¡æ€æ¡† */
.modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,0.5);animation:fadeIn 0.3s ease;}
.modal-content{background-color:white;margin:5% auto;padding:25px;border-radius:15px;width:95%;max-width:600px;max-height:85vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,0.3);animation:slideIn 0.3s ease;}
.close{color:#aaa;float:right;font-size:28px;font-weight:bold;cursor:pointer;}
.close:hover{color:#000;}
.modal h2{margin-bottom:15px;color:#333;}
.modal .example{background:#f5f5f5;padding:10px;border-radius:8px;margin-bottom:15px;font-family:monospace;font-size:12px;max-height:200px;overflow-y:auto;}
.modal textarea{width:100%;height:200px;padding:10px;border:2px solid #e0e0e0;border-radius:10px;font-family:monospace;font-size:12px;resize:vertical;}
.modal-buttons{display:flex;gap:10px;justify-content:flex-end;margin-top:20px;}
.modal-btn{padding:10px 20px;border:none;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;transition:all 0.3s ease;}
.modal-btn.confirm{background:linear-gradient(135deg,#667eea,#764ba2);color:white;}
.modal-btn.cancel{background:#e0e0e0;color:#333;}
.modal-btn:hover{transform:translateY(-2px);}

/* é€‰æ‹©æ¡† */
.import-options{display:flex;gap:10px;margin-bottom:15px;}
.option-btn{flex:1;padding:10px;border:2px solid #e0e0e0;border-radius:8px;background:white;cursor:pointer;transition:all 0.3s ease;text-align:center;}
.option-btn.selected{border-color:#667eea;background:#f0f4ff;}
.option-btn:hover{border-color:#667eea;}

/* Toastæç¤º */
.toast{position:fixed;bottom:30px;left:50%;transform:translateX(-50%) translateY(100px);background:rgba(102,126,234,0.95);color:white;padding:12px 24px;border-radius:30px;font-size:14px;font-weight:500;box-shadow:0 4px 12px rgba(0,0,0,0.2);opacity:0;transition:all 0.3s ease;z-index:2000;max-width:80%;text-align:center;}
.toast.show{transform:translateX(-50%) translateY(0);opacity:1;}

@keyframes fadeInDown{from{opacity:0;transform:translateY(-20px);}to{opacity:1;transform:translateY(0);}}
@keyframes fadeInUp{ from{ opacity:0;transform:translateY(20px);} to{opacity:1;transform:translateY(0);}}
@keyframes fadeIn{ from{ opacity: 0;} to: opacity:1;}}
@keyframes slideIn{ from{ opacity: 0; transform: translateY(-10px);} to:opacity:1;transform:translateY(0);}}
@keyframes slideDown{from{opacity:0;transform:translateY(-20px);}to{opacity:1;transform:translateY(0);}}

/* å“åº”å¼è®¾è®¡ */
@media(max-width: 768px){ 
    .sidebar{width:250px;left:-250px;}
    .sidebar-toggle.open{left:265px;}
    .main-content.shifted{margin-left:250px;}
    .top-search{width:calc(100% - 30px);max-width:300px;}
    .search-input{width:150px;}
    h1{ font-size: 1.3rem;}
    .cards-container{grid-template-columns:1fr;gap:20px;}
    .card{padding:15px;}
    .links-grid{grid-template-columns:repeat(4,1fr);gap:6px;}
    .link-item{padding:6px 3px;min-height:50px;}
    .link-icon{font-size:16px;}
    .link-name{font-size:10px;}
}

@media(max-width: 480px){
    .sidebar{width:220px;left:-220px;}
    .sidebar-toggle.open{left:235px;}
    .main-content.shifted{margin-left:220px;}
    .links-grid{gap:4px;}
    .link-item{padding:4px 2px;min-height:45px;}
    .link-icon{font-size:14px;}
    .link-name{font-size:9px;}
}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
<!-- é¡¶éƒ¨æœç´¢æ  -->
<div class="top-search">
    <i class="fas fa-search search-icon"></i>
    <input type="text" class="search-input" id="searchInput" placeholder="æœç´¢ç½‘ç«™...">
</div>

<!-- ä¾§è¾¹æ åˆ‡æ¢æŒ‰é’® -->
<div class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()">
    <i class="fas fa-chevron-right"></i>
</div>

<!-- ä¾§è¾¹æ  -->
<div class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <h2 class="sidebar-title">âš™ï¸ è®¾ç½®ä¸­å¿ƒ</h2>
    </div>
    
    <div class="sidebar-section">
        <div class="section-title">é…ç½®ç®¡ç†</div>
        <button class="sidebar-btn primary" onclick="loadDefaultConfig()">
            <i class="fas fa-database"></i> ä½¿ç”¨é»˜è®¤é…ç½®
        </button>
        <button class="sidebar-btn secondary" onclick="showImportModal()">
            <i class="fas fa-file-import"></i> å¯¼å…¥JSONæ•°æ®
        </button>
        <input type="file" id="fileInput" accept=".json" onchange="handleFileImport(event)" style="display:none;">
        <button class="sidebar-btn secondary" onclick="document.getElementById('fileInput').click()">
            <i class="fas fa-upload"></i> ä¸Šä¼ JSONæ–‡ä»¶
        </button>
        <button class="sidebar-btn danger" onclick="resetAll()">
            <i class="fas fa-trash-alt"></i> æ¸…é™¤æ‰€æœ‰æ•°æ®
        </button>
    </div>
    
    <div class="sidebar-section">
        <div class="section-title">æ‰“å¼€æ–¹å¼</div>
        <div class="mode-switch">
            <span>æ–°æ ‡ç­¾é¡µ</span>
            <label class="switch">
                <input type="checkbox" id="modeToggle" onchange="toggleMode()">
                <span class="slider"></span>
            </label>
            <span>å†…åµŒæ¡†æ¶</span>
        </div>
    </div>
    
    <div class="sidebar-section">
        <div class="section-title">èƒŒæ™¯è®¾ç½®</div>
        <button class="sidebar-btn secondary" onclick="document.getElementById('bgInput').click()">
            <i class="fas fa-image"></i> ä¸Šä¼ èƒŒæ™¯å›¾ç‰‡
        </button>
        <input type="file" id="bgInput" accept="image/*" onchange="handleBgUpload(event)" style="display:none;">
        <button class="sidebar-btn secondary" onclick="resetBackground()">
            <i class="fas fa-undo"></i> æ¢å¤é»˜è®¤èƒŒæ™¯
        </button>
    </div>
    
    <div class="sidebar-section">
        <div class="section-title">åˆ†é¡µå¯¼èˆª</div>
        <div class="sidebar-pagination" id="sidebarPagination"></div>
        <div class="pagination-info" id="paginationInfo"></div>
    </div>
</div>

<!-- ä¸»å†…å®¹åŒº -->
<div class="main-content" id="mainContent">
<div class="container">
<header>
<h1>å¯¼èˆªä¸­å¿ƒ</h1>
</header>

<div id="cardsContainer"></div>

<div class="no-data" id="noData" style="display:none;">
<i class="fas fa-inbox" style="font-size:48px;margin-bottom:15px;"></i>
<p>æš‚æ— æ•°æ®ï¼Œè¯·ç‚¹å‡»å·¦ä¸Šè§’ç®­å¤´æ‰“å¼€è®¾ç½®</p>
</div>
</div>
</div>

<!-- iframeå®¹å™¨ -->
<div class="iframe-container" id="iframeContainer">
    <div class="iframe-header">
        <div class="iframe-title" id="iframeTitle">ç½‘ç«™æ ‡é¢˜</div>
        <div class="iframe-controls">
            <button class="iframe-btn" onclick="refreshIframe()">
                <i class="fas fa-sync-alt"></i> åˆ·æ–°
            </button>
            <button class="iframe-btn close" onclick="closeIframe()">
                <i class="fas fa-times"></i> å…³é—­
            </button>
        </div>
    </div>
    <iframe class="site-iframe" id="siteIframe" src=""></iframe>
</div>

<!-- å¯¼å…¥æ¨¡æ€æ¡† -->
<div id="importModal" class="modal">
<div class="modal-content">
<span class="close" onclick="closeImportModal()">&times;</span>
<h2>å¯¼å…¥JSONé…ç½®</h2>
<p style="margin-bottom:10px;color:#666;font-size:14px;">æœ€å°æ ¼å¼ç¤ºä¾‹ï¼š</p>
<div class="example">
{
  "åˆ†ç±»1": [
    {"name": "ç½‘ç«™1", "url": "https://example1.com/"},
    {"name": "ç½‘ç«™2", "url": "https://example2.com/"}
  ]
}
</div>
<div class="import-options">
    <div class="option-btn selected" onclick="selectImportMode('replace')">
        <i class="fas fa-sync-alt"></i><br>è¦†ç›–ç°æœ‰
    </div>
    <div class="option-btn" onclick="selectImportMode('append')">
        <i class="fas fa-plus"></i><br>è¿½åŠ åˆ°ç°æœ‰
    </div>
</div>
<p style="margin-bottom:15px;color:#666;font-size:14px;">è¯·ç²˜è´´JSONæ ¼å¼çš„é…ç½®æ•°æ®ï¼š</p>
<textarea id="jsonInput" placeholder='ç²˜è´´æ‚¨çš„JSONæ•°æ®...'></textarea>
<div class="modal-buttons">
<button class="modal-btn cancel" onclick="closeImportModal()">å–æ¶ˆ</button>
<button class="modal-btn confirm" onclick="importJsonData()">å¯¼å…¥</button>
</div>
</div>
</div>

<div id="toast" class="toast"></div>

<script src="6_ç”¨æˆ·å¯¼èˆªé…ç½®.js"></script>
<script>
let currentPage = 1;
const cardsPerPage = 3; // æ¯é¡µ3ä¸ªå¡ç‰‡
const linksPerCard = 12; // æ¯ä¸ªå¡ç‰‡æœ€å¤š12ä¸ªé“¾æ¥
let allCategories = {}; // ä¿®å¤ï¼šåˆå§‹åŒ–ä¸ºå¯¹è±¡è€Œä¸æ˜¯æ•°ç»„
let filteredCategories = {}; // ä¿®å¤ï¼šåˆå§‹åŒ–ä¸ºå¯¹è±¡è€Œä¸æ˜¯æ•°ç»„
let useIframe = false;
let importMode = 'replace'; // 'replace' æˆ– 'append'

function init() {
    const savedData = localStorage.getItem('navigationData');
    if (savedData) {
        try {
            allCategories = JSON.parse(savedData);
            filteredCategories = {...allCategories};
            renderCards();
            renderSidebarPagination();
        } catch (e) {
            console.error('è§£æä¿å­˜çš„æ•°æ®å¤±è´¥:', e);
            allCategories = {};
            filteredCategories = {};
        }
    } else {
        document.getElementById('noData').style.display = 'block';
    }
    
    // åŠ è½½ä¿å­˜çš„èƒŒæ™¯
    loadSavedBackground();
}

function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const toggle = document.getElementById('sidebarToggle');
    const mainContent = document.getElementById('mainContent');
    
    sidebar.classList.toggle('open');
    toggle.classList.toggle('open');
    mainContent.classList.toggle('shifted');
}

function loadDefaultConfig() {
    try {
        // ç¡®ä¿defaultConfigå­˜åœ¨
        if (window.defaultConfig && typeof window.defaultConfig === 'object') {
            allCategories = {...window.defaultConfig};
            filteredCategories = {...allCategories};
            localStorage.setItem('navigationData', JSON.stringify(allCategories));
            currentPage = 1;
            document.getElementById('noData').style.display = 'none';
            renderCards();
            renderSidebarPagination();
            showToast('é»˜è®¤é…ç½®åŠ è½½æˆåŠŸï¼');
        } else {
            showToast('é»˜è®¤é…ç½®åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥config.jsæ–‡ä»¶');
        }
    } catch (e) {
        console.error('åŠ è½½é»˜è®¤é…ç½®å¤±è´¥:', e);
        showToast('é»˜è®¤é…ç½®åŠ è½½å¤±è´¥ï¼š' + e.message);
    }
}

function resetAll() {
    if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æ•°æ®å¹¶é‡ç½®é¡µé¢å—ï¼Ÿ')) {
        localStorage.removeItem('navigationData');
        allCategories = {};
        filteredCategories = {};
        currentPage = 1;
        document.getElementById('cardsContainer').innerHTML = '';
        document.getElementById('sidebarPagination').innerHTML = '';
        document.getElementById('paginationInfo').textContent = '';
        document.getElementById('noData').style.display = 'block';
        showToast('å·²æ¸…é™¤æ‰€æœ‰æ•°æ®ï¼');
    }
}

function selectImportMode(mode) {
    importMode = mode;
    document.querySelectorAll('.option-btn').forEach(btn => {
        btn.classList.remove('selected');
    });
    event.target.closest('.option-btn').classList.add('selected');
}

function showImportModal() {
    document.getElementById('importModal').style.display = 'block';
}

function closeImportModal() {
    document.getElementById('importModal').style.display = 'none';
    document.getElementById('jsonInput').value = '';
}

function importJsonData() {
    const jsonInput = document.getElementById('jsonInput').value.trim();
    if (!jsonInput) {
        showToast('è¯·è¾“å…¥JSONæ•°æ®');
        return;
    }
    
    try {
        const data = JSON.parse(jsonInput);
        if (typeof data === 'object' && data !== null && !Array.isArray(data)) {
            // é™åˆ¶æ¯ä¸ªåˆ†ç±»æœ€å¤š12ä¸ªé“¾æ¥
            const limitedData = {};
            Object.keys(data).forEach(category => {
                if (Array.isArray(data[category])) {
                    limitedData[category] = data[category].slice(0, linksPerCard);
                }
            });
            
            if (importMode === 'replace') {
                allCategories = {...limitedData};
            } else {
                // è¿½åŠ æ¨¡å¼
                allCategories = {...allCategories, ...limitedData};
            }
            
            filteredCategories = {...allCategories};
            localStorage.setItem('navigationData', JSON.stringify(allCategories));
            closeImportModal();
            currentPage = 1;
            document.getElementById('noData').style.display = 'none';
            renderCards();
            renderSidebarPagination();
            showToast(`JSONæ•°æ®${importMode === 'replace' ? 'è¦†ç›–' : 'è¿½åŠ '}æˆåŠŸï¼`);
        } else {
            showToast('JSONæ ¼å¼é”™è¯¯ï¼Œéœ€è¦å¯¹è±¡æ ¼å¼');
        }
    } catch (e) {
        showToast('JSONè§£æå¤±è´¥ï¼š' + e.message);
    }
}

function handleFileImport(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    if (file.type !== 'application/json') {
        showToast('è¯·é€‰æ‹©JSONæ–‡ä»¶');
        return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const data = JSON.parse(e.target.result);
            if (typeof data === 'object' && data !== null && !Array.isArray(data)) {
                // é™åˆ¶æ¯ä¸ªåˆ†ç±»æœ€å¤š12ä¸ªé“¾æ¥
                const limitedData = {};
                Object.keys(data).forEach(category => {
                    if (Array.isArray(data[category])) {
                        limitedData[category] = data[category].slice(0, linksPerCard);
                    }
                });
                
                if (importMode === 'replace') {
                    allCategories = {...limitedData};
                } else {
                    allCategories = {...allCategories, ...limitedData};
                }
                
                filteredCategories = {...allCategories};
                localStorage.setItem('navigationData', JSON.stringify(allCategories));
                currentPage = 1;
                document.getElementById('noData').style.display = 'none';
                renderCards();
                renderSidebarPagination();
                showToast(`æ–‡ä»¶${importMode === 'replace' ? 'è¦†ç›–' : 'è¿½åŠ '}æˆåŠŸï¼`);
            } else {
                showToast('æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼Œéœ€è¦å¯¹è±¡æ ¼å¼');
            }
        } catch (error) {
            showToast('æ–‡ä»¶è§£æå¤±è´¥ï¼š' + error.message);
        }
    };
    reader.readAsText(file);
    event.target.value = '';
}

function toggleMode() {
    useIframe = document.getElementById('modeToggle').checked;
}

function openLink(url, name) {
    if (useIframe) {
        // å†…åµŒiframeæ¨¡å¼
        document.getElementById('iframeTitle').textContent = name;
        document.getElementById('siteIframe').src = url;
        document.getElementById('iframeContainer').classList.add('active');
    } else {
        // æ–°æ ‡ç­¾é¡µæ¨¡å¼
        window.open(url, '_blank');
    }
}

function closeIframe() {
    document.getElementById('iframeContainer').classList.remove('active');
    document.getElementById('siteIframe').src = '';
}

function refreshIframe() {
    const iframe = document.getElementById('siteIframe');
    iframe.src = iframe.src;
}

// èƒŒæ™¯ä¸Šä¼ å¤„ç†
function handleBgUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    if (!file.type.startsWith('image/')) {
        showToast('è¯·é€‰æ‹©æœ‰æ•ˆçš„å›¾ç‰‡æ–‡ä»¶');
        return;
    }
    
    if (file.size > 5 * 1024 * 1024) {
        showToast('å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡5MB');
        return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            localStorage.setItem('pageBackground', e.target.result);
            localStorage.setItem('bgTimestamp', Date.now().toString());
            document.body.style.backgroundImage = `url(${e.target.result})`;
            showToast('èƒŒæ™¯æ›´æ¢æˆåŠŸ!');
        } catch (e) {
            showToast('èƒŒæ™¯æ›´æ¢å¤±è´¥ï¼Œè¯·æ›´æ¢å¦ä¸€å¼ å›¾ç‰‡');
        }
    };
    
    reader.onerror = function() {
        showToast('å›¾ç‰‡è¯»å–å¤±è´¥ï¼Œè¯·æ›´æ¢å¦ä¸€å¼ å›¾ç‰‡');
    };
    
    reader.readAsDataURL(file);
    event.target.value = "";
}

// åŠ è½½ä¿å­˜çš„èƒŒæ™¯
function loadSavedBackground() {
    const savedBg = localStorage.getItem('pageBackground');
    const timestamp = localStorage.getItem('bgTimestamp');
    
    if (savedBg && timestamp) {
        const age = Date.now() - parseInt(timestamp);
        if (age < 7 * 24 * 60 * 60 * 1000) { // 7å¤©æœ‰æ•ˆæœŸ
            document.body.style.backgroundImage = `url(${savedBg})`;
            return true;
        } else {
            localStorage.removeItem('pageBackground');
            localStorage.removeItem('bgTimestamp');
        }
    }
    return false;
}

// é‡ç½®èƒŒæ™¯
function resetBackground() {
    localStorage.removeItem('pageBackground');
    localStorage.removeItem('bgTimestamp');
    document.body.style.backgroundImage = '';
    showToast('èƒŒæ™¯å·²é‡ç½®ä¸ºé»˜è®¤ï¼');
}

function renderCards() {
    const container = document.getElementById('cardsContainer');
    const categoryNames = Object.keys(filteredCategories);
    
    if (categoryNames.length === 0) {
        container.innerHTML = '<div class="no-data">æ²¡æœ‰æ•°æ®</div>';
        return;
    }
    
    const startIndex = (currentPage - 1) * cardsPerPage;
    const endIndex = startIndex + cardsPerPage;
    const categoriesToShow = categoryNames.slice(startIndex, endIndex);
    
    if (categoriesToShow.length === 0) {
        container.innerHTML = '<div class="no-data">æ²¡æœ‰æ›´å¤šæ•°æ®</div>';
        return;
    }
    
    container.innerHTML = categoriesToShow.map(categoryName => {
        let links = filteredCategories[categoryName];
        // ç¡®ä¿linksæ˜¯æ•°ç»„
        if (!Array.isArray(links)) {
            links = [];
        }
        // ç¡®ä¿æ¯ä¸ªå¡ç‰‡æœ€å¤š12ä¸ªé“¾æ¥
        if (links.length > linksPerCard) {
            links = links.slice(0, linksPerCard);
        }
        
        const icons = ['ğŸŒ', 'ğŸ“š', 'ğŸ®', 'ğŸ› ï¸', 'ğŸ“±', 'ğŸ’¼', 'ğŸ¨', 'ğŸ”§', 'ğŸ“Š', 'ğŸ”'];
        const randomIcon = icons[Math.floor(Math.random() * icons.length)];
        
        return `
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">${randomIcon} ${categoryName}</h3>
                    <span class="card-count">${links.length} é¡¹</span>
                </div>
                <div class="links-grid">
                    ${links.map(link => `
                        <div class="link-item" onclick="openLink('${link.url}', '${link.name}')" title="${link.name}">
                            <div class="link-icon">
                                <i class="fas fa-external-link-alt"></i>
                            </div>
                            <div class="link-name">${link.name}</div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }).join('');
}

function renderSidebarPagination() {
    const pagination = document.getElementById('sidebarPagination');
    const categoryNames = Object.keys(filteredCategories);
    const totalPages = Math.ceil(categoryNames.length / cardsPerPage);
    
    if (totalPages <= 1) {
        pagination.innerHTML = '';
        document.getElementById('paginationInfo').textContent = '';
        return;
    }
    
    let paginationHTML = '';
    
    for (let i = 1; i <= totalPages; i++) {
        paginationHTML += `<button class="pagination-btn ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">ç¬¬${i}é¡µ</button>`;
    }
    
    pagination.innerHTML = paginationHTML;
    document.getElementById('paginationInfo').textContent = `å…± ${totalPages} é¡µ`;
}

function changePage(page) {
    const categoryNames = Object.keys(filteredCategories);
    const totalPages = Math.ceil(categoryNames.length / cardsPerPage);
    if (page >= 1 && page <= totalPages) {
        currentPage = page;
        renderCards();
        renderSidebarPagination();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
}

// æœç´¢åŠŸèƒ½
document.getElementById('searchInput').addEventListener('input', function(e) {
    const searchTerm = e.target.value.toLowerCase().trim();
    
    if (searchTerm === '') {
        filteredCategories = {...allCategories};
    } else {
        filteredCategories = {};
        Object.keys(allCategories).forEach(category => {
            if (Array.isArray(allCategories[category])) {
                const filteredLinks = allCategories[category].filter(link => 
                    link.name && link.name.toLowerCase().includes(searchTerm)
                );
                if (filteredLinks.length > 0) {
                    filteredCategories[category] = filteredLinks;
                }
            }
        });
    }
    
    currentPage = 1;
    if (Object.keys(filteredCategories).length === 0) {
        document.getElementById('cardsContainer').innerHTML = '<div class="no-data">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ç½‘ç«™</div>';
        document.getElementById('sidebarPagination').innerHTML = '';
        document.getElementById('paginationInfo').textContent = '';
    } else {
        renderCards();
        renderSidebarPagination();
    }
});

function showToast(message) {
    const toast = document.getElementById('toast');
    toast.textContent = message;
    toast.classList.add('show');
    setTimeout(() => {
        toast.classList.remove('show');
    }, 3000);
}

// ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
window.onclick = function(event) {
    const modal = document.getElementById('importModal');
    if (event.target === modal) {
        closeImportModal();
    }
}

// ESCé”®å…³é—­iframe
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeIframe();
    }
});

// é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
window.addEventListener('load', init);
</script>
</body>
</html>
