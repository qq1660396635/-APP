<!DOCTYPE html> 
<html lang="zh-CN"> 
<head>
    <meta charset="UTF-8"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰ªè´´æ¿ç®¡å®¶</title> 
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --primary-color: #5e72e4; --secondary-color: #f5365c; --success-color: #2dce89; --warning-color: #fb6340; --info-color: #11cdef; --dark: #32325d; --light: #f8f9fe; --border-radius: 6px; --transition: all 0.3s ease; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 8px; transform-origin: center center; transition: transform 0.3s ease; }
        .container { max-width: 1400px; margin: 0 auto; background: rgba(255, 255, 255, 0.95); border-radius: 8px; padding: 10px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding-bottom: 8px; border-bottom: 1px solid #e9ecef; flex-wrap: wrap; gap: 8px; }
        .title { font-size: 18px; color: var(--dark); font-weight: 600; }
        .header-actions { display: flex; gap: 6px; flex-wrap: wrap; }
        .btn { padding: 6px 10px; border: none; border-radius: 4px; font-size: 11px; font-weight: 500; cursor: pointer; transition: var(--transition); display: inline-flex; align-items: center; gap: 3px; color: white; white-space: nowrap; }
        .btn:hover { transform: translateY(-1px); box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15); }
        .btn-primary { background: var(--primary-color); } .btn-success { background: var(--success-color); } .btn-warning { background: var(--warning-color); } .btn-info { background: var(--info-color); }
        .cards-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 20px; }
        @media (min-width: 1200px) { .cards-grid { grid-template-columns: repeat(4, 1fr); gap: 10px; } }
        @media (min-width: 768px) and (max-width: 1199px) { .cards-grid { grid-template-columns: repeat(3, 1fr); gap: 9px; } }
        @media (max-width: 767px) { .cards-grid { grid-template-columns: repeat(3, 1fr); gap: 6px; } body { padding: 5px; } .container { padding: 8px; } .header { flex-direction: column; align-items: stretch; gap: 8px; } .header-actions { justify-content: center; } .btn { padding: 5px 8px; font-size: 10px; } }
        @media (max-width: 400px) { .cards-grid { gap: 4px; } }
        .card { background: white; border-radius: var(--border-radius); padding: 8px; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08); transition: var(--transition); position: relative; cursor: move; user-select: none; }
        .card:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0, 0, 0, 0.12); }
        .card.dragging { opacity: 0.5; transform: rotate(5deg); z-index: 1000; }
        .card.drag-over { border: 2px dashed var(--primary-color); background: rgba(94, 114, 228, 0.1); }
        .card.selected-for-swap { border: 2px solid var(--info-color); background: rgba(17, 205, 239, 0.1); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
        .card-title { font-weight: 600; color: var(--dark); font-size: 12px; display: flex; align-items: center; gap: 4px; flex: 1; min-width: 0; }
        .card-number { background: var(--primary-color); color: white; width: 16px; height: 16px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 9px; font-weight: bold; flex-shrink: 0; }
        .card-name { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .card-actions { display: flex; gap: 2px; }
        .icon-btn { width: 20px; height: 20px; border: none; background: transparent; border-radius: 3px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: var(--transition); color: var(--dark); font-size: 10px; }
        .icon-btn:hover { background: var(--primary-color); color: white; }
        .card-content { background: var(--light); padding: 6px; border-radius: 4px; min-height: 45px; max-height: 90px; overflow-y: auto; font-size: 10px; line-height: 1.4; color: #495057; word-break: break-all; white-space: pre-wrap; }
        .card-footer { margin-top: 6px; display: flex; justify-content: space-between; align-items: center; font-size: 9px; color: #868e96; }
        .add-card { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); border: 2px dashed #cbd5e0; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: var(--transition); min-height: 100px; }
        .add-card:hover { background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%); border-color: var(--primary-color); }
        .add-icon { font-size: 24px; color: #adb5bd; margin-bottom: 6px; }
        .delete-mode .card { cursor: pointer; }
        .delete-mode .card::after { content: 'âœ“'; position: absolute; top: 3px; right: 3px; width: 16px; height: 16px; background: var(--success-color); color: white; border-radius: 50%; display: none; align-items: center; justify-content: center; font-size: 10px; z-index: 10; }
        .delete-mode .card.selected::after { display: flex; }
        .delete-mode .card.selected { border: 2px solid var(--success-color); background: rgba(45, 206, 137, 0.1); }
        .delete-mode .card:hover { border-color: var(--success-color); }
        .delete-actions { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); background: white; padding: 8px 15px; border-radius: 6px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2); display: none; gap: 8px; z-index: 1000; }
        .delete-actions.active { display: flex; }
        .swap-hint { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: var(--info-color); color: white; padding: 8px 15px; border-radius: 6px; font-size: 12px; display: none; z-index: 1000; }
        .swap-hint.active { display: block; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 1000; animation: fadeIn 0.3s ease; }
        .modal.active { display: flex; align-items: center; justify-content: center; padding: 20px; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .modal-content { background: white; border-radius: 8px; padding: 15px; max-width: 450px; width: 100%; max-height: 90vh; overflow-y: auto; animation: slideUp 0.3s ease; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .modal-header { margin-bottom: 12px; }
        .modal-title { font-size: 16px; color: var(--dark); font-weight: 600; }
        .form-group { margin-bottom: 12px; }
        .form-label { display: block; margin-bottom: 5px; color: var(--dark); font-weight: 500; font-size: 12px; }
        .form-input, .form-textarea { width: 100%; padding: 8px; border: 2px solid #e9ecef; border-radius: 4px; font-size: 12px; transition: var(--transition); }
        .form-input:focus, .form-textarea:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(94, 114, 228, 0.1); }
        .form-textarea { min-height: 80px; resize: vertical; font-family: inherit; }
        .modal-footer { display: flex; justify-content: flex-end; gap: 8px; margin-top: 12px; }
        .zoom-controls { position: fixed; bottom: 20px; right: 20px; background: white; border-radius: 6px; padding: 6px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); display: flex; gap: 6px; z-index: 100; }
        .zoom-btn { width: 28px; height: 28px; border: none; background: var(--primary-color); color: white; border-radius: 4px; cursor: pointer; font-size: 14px; transition: var(--transition); }
        .zoom-btn:hover { background: #4c63d2; }
        .zoom-level { display: flex; align-items: center; padding: 0 6px; font-size: 11px; font-weight: 600; color: var(--dark); min-width: 35px; justify-content: center; }
        .toast { position: fixed; top: 20px; right: 20px; background: white; padding: 10px 12px; border-radius: 4px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); display: flex; align-items: center; gap: 6px; z-index: 2000; animation: slideInRight 0.3s ease; max-width: 250px; font-size: 11px; }
        @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .toast.success { border-left: 3px solid var(--success-color); } .toast.error { border-left: 3px solid var(--secondary-color); } .toast.info { border-left: 3px solid var(--info-color); }
        .import-options { margin-bottom: 12px; }
        .radio-group { display: flex; gap: 12px; margin-top: 6px; }
        .radio-label { display: flex; align-items: center; gap: 4px; font-size: 12px; cursor: pointer; }
        .empty-state { text-align: center; padding: 30px 15px; color: #868e96; grid-column: 1 / -1; }
        .empty-icon { font-size: 36px; margin-bottom: 10px; opacity: 0.5; }
    </style>
</head> 
<body>
    <div class="container">
        <header class="header">
            <h1 class="title">ğŸ“‹å‰ªè´´æ¿ç®¡å®¶</h1> 
            <div class="header-actions">
                <button class="btn btn-primary" onclick="copyAll()">
                    <span>ğŸ“„</span> ç²˜è´´å…¨éƒ¨
                </button> 
                <button class="btn btn-success" onclick="exportData()">
                    <span>ğŸ’¾</span> å¯¼å‡º
                </button> 
                <button class="btn btn-info" onclick="importData()">
                    <span>ğŸ“‚</span> å¯¼å…¥
                </button> 
                <button class="btn btn-warning" id="deleteBtn" onclick="toggleDeleteMode()">
                    <span>ğŸ—‘ï¸</span> åˆ é™¤
                </button> 
                <button class="btn btn-info" id="swapBtn" onclick="toggleSwapMode()">
                    <span>ğŸ”„</span> äº¤æ¢ 
                </button> 
            </div> 
        </header>
        <main>
            <div class="cards-grid" id="cardsGrid">
                <!-- å¡ç‰‡å°†åŠ¨æ€ç”Ÿæˆ--> 
            </div> 
        </main> 
    </div>
    
    <!-- äº¤æ¢æ¨¡å¼æç¤º-->
    <div class="swap-hint" id="swapHint">
        ç‚¹å‡»ä¸¤ä¸ªå¡ç‰‡äº¤æ¢ä½ç½® 
    </div>
    
    <!-- åˆ é™¤æ“ä½œæ -->
    <div class="delete-actions" id="deleteActions">
        <span>å·²é€‰æ‹©<span id="selectedCount">0</span> é¡¹</span> 
        <button class="btn btn-warning" onclick="deleteSelected()">åˆ é™¤é€‰ä¸­ </button>
        <button class="btn" style="background: #6c757d;" onclick="exitDeleteMode()">å–æ¶ˆ</button>
    </div>
    
    <!-- æ·»åŠ /ç¼–è¾‘å¡ç‰‡æ¨¡æ€æ¡†-->
    <div class="modal" id="cardModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">æ·»åŠ æ–°å†…å®¹</h2> 
            </div> 
            <div class="form-group">
                <label class="form-label">ç®€å†™åç§°*</label> 
                <input type="text" class="form-input" id="cardName" placeholder="ä¾‹å¦‚ï¼šåœ°å€ã€é‚®ç®±ã€ä»£ç ç‰‡æ®µ...">
            </div> 
            <div class="form-group">
                <label class="form-label">å†…å®¹*</label> 
                <textarea class="form-textarea" id="cardContent" placeholder="ç²˜è´´æˆ–è¾“å…¥ä½ çš„å†…å®¹..."></textarea>
            </div> 
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="saveCard()"> ä¿å­˜ </button>
                <button class="btn" style="background: #6c757d;" onclick="closeModal()">å–æ¶ˆ</button>
            </div> 
        </div> 
    </div>
    
    <!-- å¯¼å…¥æ¨¡æ€æ¡†-->
    <div class="modal" id="importModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">å¯¼å…¥æ•°æ®</h2> 
            </div> 
            <div class="import-options">
                <label class="form-label">å¯¼å…¥æ–¹å¼</label> 
                <div class="radio-group">
                    <label class="radio-label">
                        <input type="radio" name="importMode" value="replace" checked>
                        è¦†ç›–ç°æœ‰æ•°æ®
                    </label> 
                    <label class="radio-label">
                        <input type="radio" name="importMode" value="append">
                        è¿½åŠ åˆ°ç°æœ‰æ•°æ® 
                    </label> 
                </div>
            </div> 
            <div class="form-group">
                <label class="form-label">ç²˜è´´å¯¼å…¥æ•°æ®</label> 
                <textarea class="form-textarea" id="importData" placeholder="æ ¼å¼ç¤ºä¾‹ï¼š 1. ã€åç§°1ã€‘ å†…å®¹1
2. ã€åç§°2ã€‘ å†…å®¹2"></textarea>
            </div> 
            <div class="modal-footer">
                <button class="btn btn-success" onclick="doImport()"> å¯¼å…¥ </button>
                <button class="btn" style="background: #6c757d;" onclick="closeImportModal()">å–æ¶ˆ</button>
            </div> 
        </div> 
    </div>
    
    <!-- ç¼©æ”¾æ§åˆ¶-->
    <div class="zoom-controls">
        <button class="zoom-btn" onclick="zoomOut()">ï¼</button> 
        <div class="zoom-level" id="zoomLevel">100%</div> 
        <button class="zoom-btn" onclick="zoomIn()">ï¼‹</button> 
        <button class="zoom-btn" onclick="resetZoom()">âŸ²</button> 
    </div>
    
    <!-- å¼•å…¥é…ç½®æ–‡ä»¶ -->
    <script src="config.js"></script>
    
    <script>
        let cards = []; 
        let currentEditIndex = -1; 
        let currentZoom = 100; 
        let deleteMode = false; 
        let swapMode = false; 
        let selectedCards = new Set(); 
        let swapFirstIndex = -1; 
        let draggedIndex = -1;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadFromLocalStorage(); 
            renderCards(); 
            initDragAndDrop(); 
        });

        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
        function loadFromLocalStorage() {
            const saved = localStorage.getItem('clipboardCards'); 
            if (saved) {
                try {
                    cards = JSON.parse(saved); 
                } catch (e) {
                    cards = [];
                }
            } else {
                // å¦‚æœæ²¡æœ‰ä¿å­˜æ•°æ®ï¼Œå°è¯•ä½¿ç”¨é…ç½®æ–‡ä»¶çš„æ•°æ®
                if (typeof defaultCards !== 'undefined' && Array.isArray(defaultCards)) {
                    cards = [...defaultCards];
                    saveToLocalStorage();
                } else {
                    cards = [];
                }
            }
        }

        // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
        function saveToLocalStorage() {
            localStorage.setItem('clipboardCards', JSON.stringify(cards));
        }

        // æ¸²æŸ“å¡ç‰‡
        function renderCards() {
            const grid = document.getElementById('cardsGrid');
            
            if (cards.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“‹</div>
                        <div>æš‚æ— å†…å®¹ï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ·»åŠ </div>
                    </div>
                    <div class="add-card" onclick="openModal()">
                        <div class="add-icon">â•</div>
                        <div style="color: #868e96; font-size: 12px;">æ·»åŠ æ–°å†…å®¹</div>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = cards.map((card, index) => `
                <div class="card ${deleteMode ? 'clickable' : ''} ${swapMode ? 'swapable' : ''}"
                     data-index="${index}" 
                     draggable="${!deleteMode && !swapMode}" 
                     onclick="${deleteMode ? 'toggleCardSelection(' + index + ')' : (swapMode ? 'handleSwapClick(' + index + ')' : '')}">
                    <div class="card-header">
                        <div class="card-title">
                            <span class="card-number">${index + 1}</span>
                            <span class="card-name">${card.name || 'æœªå‘½å'}</span>
                        </div>
                        ${!deleteMode && !swapMode ? `
                            <div class="card-actions">
                                <button class="icon-btn" onclick="event.stopPropagation(); copyCard(${index})" title="å¤åˆ¶">ğŸ“‹</button>
                                <button class="icon-btn" onclick="event.stopPropagation(); editCard(${index})" title="ç¼–è¾‘">âœï¸</button>
                            </div>
                        ` : ''}
                    </div>
                    <div class="card-content">${escapeHtml(card.content || '')}</div>
                    <div class="card-footer">
                        <span>${formatTime(card.timestamp)}</span> 
                        <span>${(card.content || '').length} å­—ç¬¦</span> 
                    </div>
                </div>
            `).join('') + `
                <div class="add-card" onclick="openModal()">
                    <div class="add-icon">â•</div>
                    <div style="color: #868e96; font-size: 12px;">æ·»åŠ æ–°å†…å®¹</div>
                </div>
            `;
            
            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            if (deleteMode) {
                selectedCards.forEach(index => {
                    const card = grid.querySelector(`[data-index="${index}"]`);
                    if (card) card.classList.add('selected');
                });
                updateSelectedCount();
            }
        }

        // åˆå§‹åŒ–æ‹–æ‹½åŠŸèƒ½
        function initDragAndDrop() {
            const grid = document.getElementById('cardsGrid');
            
            grid.addEventListener('dragstart', function(e) {
                if (e.target.classList.contains('card') && !e.target.classList.contains('add-card')) {
                    draggedIndex = parseInt(e.target.dataset.index);
                    e.target.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                }
            });
            
            grid.addEventListener('dragend', function(e) {
                if (e.target.classList.contains('card')) {
                    e.target.classList.remove('dragging');
                }
            });
            
            grid.addEventListener('dragover', function(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                const card = e.target.closest('.card:not(.add-card)');
                if (card && !card.classList.contains('dragging')) {
                    card.classList.add('drag-over');
                }
            });
            
            grid.addEventListener('dragleave', function(e) {
                const card = e.target.closest('.card:not(.add-card)');
                if (card) {
                    card.classList.remove('drag-over');
                }
            });
            
            grid.addEventListener('drop', function(e) {
                e.preventDefault();
                const card = e.target.closest('.card:not(.add-card)');
                if (card) {
                    card.classList.remove('drag-over');
                    const dropIndex = parseInt(card.dataset.index);
                    if (draggedIndex !== -1 && draggedIndex !== dropIndex) {
                        // äº¤æ¢å¡ç‰‡
                        const temp = cards[draggedIndex];
                        cards[draggedIndex] = cards[dropIndex];
                        cards[dropIndex] = temp;
                        saveToLocalStorage();
                        renderCards();
                        showToast('å¡ç‰‡ä½ç½®å·²äº¤æ¢', 'success');
                    }
                    draggedIndex = -1;
                }
            });
        }

        // åˆ‡æ¢åˆ é™¤æ¨¡å¼
        function toggleDeleteMode() {
            deleteMode = !deleteMode;
            swapMode = false;
            const container = document.querySelector('.container');
            const deleteActions = document.getElementById('deleteActions');
            const deleteBtn = document.getElementById('deleteBtn');
            const swapBtn = document.getElementById('swapBtn');
            const swapHint = document.getElementById('swapHint');
            
            if (deleteMode) {
                container.classList.add('delete-mode');
                deleteActions.classList.add('active');
                deleteBtn.innerHTML = '<span>âœ…</span> é€€å‡ºåˆ é™¤';
                swapBtn.innerHTML = '<span>ğŸ”„</span> äº¤æ¢';
                selectedCards.clear();
            } else {
                container.classList.remove('delete-mode');
                deleteActions.classList.remove('active');
                deleteBtn.innerHTML = '<span>ğŸ—‘ï¸</span> åˆ é™¤';
                selectedCards.clear();
                swapHint.classList.remove('active');
                renderCards();
            }
        }

        // åˆ‡æ¢äº¤æ¢æ¨¡å¼
        function toggleSwapMode() {
            swapMode = !swapMode;
            deleteMode = false;
            const container = document.querySelector('.container');
            const deleteBtn = document.getElementById('deleteBtn');
            const swapBtn = document.getElementById('swapBtn');
            const deleteActions = document.getElementById('deleteActions');
            const swapHint = document.getElementById('swapHint');
            
            if (swapMode) {
                container.classList.remove('delete-mode');
                deleteActions.classList.remove('active');
                deleteBtn.innerHTML = '<span>ğŸ—‘ï¸</span> åˆ é™¤';
                swapBtn.innerHTML = '<span>âœ…</span> é€€å‡ºäº¤æ¢';
                swapHint.classList.add('active');
                swapFirstIndex = -1;
            } else {
                swapBtn.innerHTML = '<span>ğŸ”„</span> äº¤æ¢';
                swapHint.classList.remove('active');
                // æ¸…é™¤é€‰ä¸­çŠ¶æ€
                document.querySelectorAll('.card.selected-for-swap').forEach(card => {
                    card.classList.remove('selected-for-swap');
                });
                renderCards();
            }
        }

        // å¤„ç†äº¤æ¢ç‚¹å‡»
        function handleSwapClick(index) {
            if (swapFirstIndex === -1) {
                // ç¬¬ä¸€æ¬¡ç‚¹å‡»
                swapFirstIndex = index;
                const card = document.querySelector(`[data-index="${index}"]`);
                if (card) card.classList.add('selected-for-swap');
            } else {
                // ç¬¬äºŒæ¬¡ç‚¹å‡»
                if (swapFirstIndex !== index) {
                    // äº¤æ¢å¡ç‰‡
                    const temp = cards[swapFirstIndex];
                    cards[swapFirstIndex] = cards[index];
                    cards[index] = temp;
                    saveToLocalStorage();
                    showToast('å¡ç‰‡ä½ç½®å·²äº¤æ¢', 'success');
                }
                // æ¸…é™¤é€‰ä¸­çŠ¶æ€
                document.querySelectorAll('.card.selected-for-swap').forEach(card => {
                    card.classList.remove('selected-for-swap');
                });
                swapFirstIndex = -1;
                renderCards();
            }
        }

        // é€€å‡ºåˆ é™¤æ¨¡å¼
        function exitDeleteMode() {
            deleteMode = false;
            const container = document.querySelector('.container');
            const deleteActions = document.getElementById('deleteActions');
            const deleteBtn = document.getElementById('deleteBtn');
            container.classList.remove('delete-mode');
            deleteActions.classList.remove('active');
            deleteBtn.innerHTML = '<span>ğŸ—‘ï¸</span> åˆ é™¤';
            selectedCards.clear();
            renderCards();
        }

        // åˆ‡æ¢å¡ç‰‡é€‰ä¸­çŠ¶æ€
        function toggleCardSelection(index) {
            if (selectedCards.has(index)) {
                selectedCards.delete(index);
            } else {
                selectedCards.add(index);
            }
            const card = document.querySelector(`[data-index="${index}"]`);
            if (card) {
                card.classList.toggle('selected');
            }
            updateSelectedCount();
        }

        // æ›´æ–°é€‰ä¸­æ•°é‡
        function updateSelectedCount() {
            document.getElementById('selectedCount').textContent = selectedCards.size;
        }

        // åˆ é™¤é€‰ä¸­çš„å¡ç‰‡
        function deleteSelected() {
            if (selectedCards.size === 0) {
                showToast('è¯·é€‰æ‹©è¦åˆ é™¤çš„å†…å®¹', 'info');
                return;
            }
            if (confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„${selectedCards.size} æ¡å†…å®¹å—ï¼Ÿ`)) {
                // æŒ‰ç´¢å¼•ä»å¤§åˆ°å°æ’åºï¼Œé¿å…åˆ é™¤æ—¶ç´¢å¼•é”™ä½
                const indicesToDelete = Array.from(selectedCards).sort((a, b) => b - a);
                indicesToDelete.forEach(index => {
                    cards.splice(index, 1);
                });
                saveToLocalStorage();
                exitDeleteMode();
                showToast(`å·²åˆ é™¤ ${indicesToDelete.length} æ¡å†…å®¹`, 'success');
            }
        }

        // HTML è½¬ä¹‰
        function escapeHtml(text) {
            const map = {
                '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        // æ ¼å¼åŒ–æ—¶é—´
        function formatTime(timestamp) {
            if (!timestamp) return '';
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            if (diff < 60000) return 'åˆšåˆš';
            if (diff < 3600000) return Math.floor(diff / 60000) + 'åˆ†é’Ÿå‰';
            if (diff < 86400000) return Math.floor(diff / 3600000) + 'å°æ—¶å‰';
            return date.toLocaleDateString('zh-CN');
        }

        // æ‰“å¼€æ·»åŠ æ¨¡æ€æ¡†
        function openModal() {
            currentEditIndex = -1;
            document.getElementById('modalTitle').textContent = 'æ·»åŠ æ–°å†…å®¹';
            document.getElementById('cardName').value = '';
            document.getElementById('cardContent').value = '';
            document.getElementById('cardModal').classList.add('active');
            // å°è¯•ä»å‰ªè´´æ¿è·å–å†…å®¹
            if (navigator.clipboard && navigator.clipboard.readText) {
                navigator.clipboard.readText().then(text => {
                    if (text && text.trim()) {
                        document.getElementById('cardContent').value = text;
                    }
                }).catch(() => {
                    // å¿½ç•¥é”™è¯¯
                });
            }
        }

        // ç¼–è¾‘å¡ç‰‡
        function editCard(index) {
            currentEditIndex = index;
            const card = cards[index];
            document.getElementById('modalTitle').textContent = 'ç¼–è¾‘å†…å®¹';
            document.getElementById('cardName').value = card.name || '';
            document.getElementById('cardContent').value = card.content || '';
            document.getElementById('cardModal').classList.add('active');
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            document.getElementById('cardModal').classList.remove('active');
        }

        // ä¿å­˜å¡ç‰‡
        function saveCard() {
            const name = document.getElementById('cardName').value.trim();
            const content = document.getElementById('cardContent').value.trim();
            if (!name || !content) {
                showToast('è¯·å¡«å†™åç§°å’Œå†…å®¹', 'error');
                return;
            }
            const card = {
                name: name,
                content: content,
                timestamp: new Date().toISOString()
            };
            if (currentEditIndex >= 0) {
                cards[currentEditIndex] = card;
                showToast('å†…å®¹å·²æ›´æ–°', 'success');
            } else {
                cards.push(card);
                showToast('å†…å®¹å·²æ·»åŠ ', 'success');
            }
            saveToLocalStorage();
            renderCards();
            closeModal();
        }

        // å¤åˆ¶å•ä¸ªå¡ç‰‡
        function copyCard(index) {
            const card = cards[index];
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(card.content).then(() => {
                    showToast(`å·²å¤åˆ¶: ${card.name}`, 'success');
                }).catch(() => {
                    showToast('å¤åˆ¶å¤±è´¥', 'error');
                });
            } else {
                // é™çº§æ–¹æ¡ˆ
                const textarea = document.createElement('textarea');
                textarea.value = card.content;
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    showToast(`å·²å¤åˆ¶: ${card.name}`, 'success');
                } catch (err) {
                    showToast('å¤åˆ¶å¤±è´¥', 'error');
                }
                document.body.removeChild(textarea);
            }
        }

        // å¤åˆ¶å…¨éƒ¨
        function copyAll() {
            if (cards.length === 0) {
                showToast('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹', 'info');
                return;
            }
            let allText = cards.map((card, index) => {
                return `${index + 1}. ã€${card.name}ã€‘\n${card.content}`;
            }).join('\n\n---\n\n');
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(allText).then(() => {
                    showToast(`å·²å¤åˆ¶å…¨éƒ¨${cards.length} æ¡å†…å®¹`, 'success');
                }).catch(() => {
                    showToast('å¤åˆ¶å¤±è´¥', 'error');
                });
            } else {
                // é™çº§æ–¹æ¡ˆ
                const textarea = document.createElement('textarea');
                textarea.value = allText;
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    showToast(`å·²å¤åˆ¶å…¨éƒ¨${cards.length} æ¡å†…å®¹`, 'success');
                } catch (err) {
                    showToast('å¤åˆ¶å¤±è´¥', 'error');
                }
                document.body.removeChild(textarea);
            }
        }

        // å¯¼å‡ºæ•°æ®
        function exportData() {
            if (cards.length === 0) {
                showToast('æ²¡æœ‰å¯å¯¼å‡ºçš„å†…å®¹', 'info');
                return;
            }
            let exportText = cards.map((card, index) => {
                return `${index + 1}. ã€${card.name}ã€‘\n${card.content}`;
            }).join('\n\n---\n\n');
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(exportText).then(() => {
                    showToast('æ•°æ®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œè¯·ä¿å­˜', 'success');
                }).catch(() => {
                    showToast('å¯¼å‡ºå¤±è´¥', 'error');
                });
            } else {
                // é™çº§æ–¹æ¡ˆ
                const textarea = document.createElement('textarea');
                textarea.value = exportText;
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    showToast('æ•°æ®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œè¯·ä¿å­˜', 'success');
                } catch (err) {
                    showToast('å¯¼å‡ºå¤±è´¥', 'error');
                }
                document.body.removeChild(textarea);
            }
        }

        // æ‰“å¼€å¯¼å…¥æ¨¡æ€æ¡†
        function importData() {
            document.getElementById('importData').value = '';
            document.querySelector('input[name="importMode"][value="replace"]').checked = true;
            document.getElementById('importModal').classList.add('active');
        }

        // å…³é—­å¯¼å…¥æ¨¡æ€æ¡†
        function closeImportModal() {
            document.getElementById('importModal').classList.remove('active');
        }

        // æ‰§è¡Œå¯¼å…¥
        function doImport() {
            const importText = document.getElementById('importData').value.trim();
            if (!importText) {
                showToast('è¯·è¾“å…¥è¦å¯¼å…¥çš„æ•°æ®', 'error');
                return;
            }
            const importMode = document.querySelector('input[name="importMode"]:checked').value;
            try {
                const sections = importText.split(/\n\s*---\s*\n/);
                const newCards = [];
                sections.forEach(section => {
                    const lines = section.trim().split('\n');
                    if (lines.length > 0) {
                        let name = '';
                        let content = '';
                        let match = lines[0].match(/^\d+\.\s*ã€(.+?)ã€‘/);
                        if (match) {
                            name = match[1];
                            content = lines.slice(1).join('\n').trim();
                        } else {
                            match = lines[0].match(/^ã€(.+?)ã€‘$/);
                            if (match) {
                                name = match[1];
                                content = lines.slice(1).join('\n').trim();
                            } else {
                                if (lines.length >= 2) {
                                    name = lines[0].trim();
                                    content = lines.slice(1).join('\n').trim();
                                } else if (lines.length === 1) {
                                    const line = lines[0];
                                    name = line.length > 20 ? line.substring(0, 20) + '...' : line;
                                    content = line;
                                }
                            }
                        }
                        if (name && content) {
                            newCards.push({
                                name: name,
                                content: content,
                                timestamp: new Date().toISOString()
                            });
                        }
                    }
                });
                if (newCards.length > 0) {
                    const message = importMode === 'replace'
                        ? `å°†å¯¼å…¥${newCards.length} æ¡å†…å®¹å¹¶è¦†ç›–ç°æœ‰æ•°æ®ï¼Œç¡®å®šå—ï¼Ÿ`
                        : `å°†è¿½åŠ ${newCards.length} æ¡å†…å®¹åˆ°ç°æœ‰æ•°æ®ï¼Œç¡®å®šå—ï¼Ÿ`;
                    if (confirm(message)) {
                        if (importMode === 'replace') {
                            cards = newCards;
                        } else {
                            cards = cards.concat(newCards);
                        }
                        saveToLocalStorage();
                        renderCards();
                        closeImportModal();
                        showToast(`æˆåŠŸå¯¼å…¥ ${newCards.length} æ¡å†…å®¹`, 'success');
                    }
                } else {
                    showToast('æœªæ‰¾åˆ°æœ‰æ•ˆçš„å†…å®¹ï¼Œè¯·æ£€æŸ¥æ ¼å¼', 'error');
                }
            } catch (error) {
                console.error('Import error:', error);
                showToast('å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ•°æ®æ ¼å¼', 'error');
            }
        }

        // ç¼©æ”¾åŠŸèƒ½
        function zoomIn() {
            if (currentZoom < 150) {
                currentZoom += 10;
                applyZoom();
            }
        }

        function zoomOut() {
            if (currentZoom > 50) {
                currentZoom -= 10;
                applyZoom();
            }
        }

        function resetZoom() {
            currentZoom = 100;
            applyZoom();
        }

        function applyZoom() {
            document.body.style.transform = `scale(${currentZoom / 100})`;
            document.getElementById('zoomLevel').textContent = `${currentZoom}%`;
        }

        // Toast æç¤º
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            const icon = {
                success: 'âœ…',
                error: 'âŒ',
                info: 'â„¹ï¸'
            }[type] || 'â„¹ï¸';
            toast.innerHTML = `
                <span style="font-size: 14px;">${icon}</span>
                <span>${message}</span>
            `;
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.style.animation = 'slideInRight 0.3s ease reverse';
                setTimeout(() => {
                    if (document.body.contains(toast)) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + N: æ–°å»º
            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                e.preventDefault();
                openModal();
            }
            // Ctrl/Cmd + E: å¯¼å‡º
            if ((e.ctrlKey || e.metaKey) && e.key === 'e') {
                e.preventDefault();
                exportData();
            }
            // Ctrl/Cmd + I: å¯¼å…¥
            if ((e.ctrlKey || e.metaKey) && e.key === 'i') {
                e.preventDefault();
                importData();
            }
            // Ctrl/Cmd + A: å¤åˆ¶å…¨éƒ¨
            if ((e.ctrlKey || e.metaKey) && e.key === 'a' && !e.shiftKey) {
                e.preventDefault();
                copyAll();
            }
            // ESC: å…³é—­æ¨¡æ€æ¡†æˆ–é€€å‡ºæ¨¡å¼
            if (e.key === 'Escape') {
                if (deleteMode) {
                    exitDeleteMode();
                } else if (swapMode) {
                    toggleSwapMode();
                } else {
                    closeModal();
                    closeImportModal();
                }
            }
        });

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.getElementById('cardModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
        document.getElementById('importModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeImportModal();
            }
        });
    </script>
</body> 
</html>
