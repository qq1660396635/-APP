<!DOCTYPE html> 
<html lang="zh-CN"> 
<head>
<meta charset="UTF-8"> 
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>æ¸¸æˆä¸–ç•Œ</title> 
<style>
*{margin:0;padding:0;box-sizing:border-box;} 
body{
font-family:-apple-system, BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial, sans-serif;
background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); 
background-size:cover; 
background-position: center; 
background-attachment: fixed; 
min-height: 100vh; 
padding: 15px; 
position:relative; 
} 
.container{max-width:1200px;margin:0 auto;} 
header{text-align: center; margin-bottom:30px;color:white;} 
h1{ font-size: 2.5rem; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); animation: fadeInDown 0.8s ease;}
.subtitle{font-size:1.1rem;opacity:0.9;animation:fadeInUp 0.8s ease;}

/* èƒŒæ™¯æ›´æ¢æŒ‰é’® */
.bg-upload-btn{
position: fixed; 
top:20px; 
right:20px; 
width:40px; 
height:40px; 
background:rgba(255,255,255,0.9); 
border-radius:50%; 
display:flex; 
align-items:center; 
justify-content:center; 
cursor:pointer; 
box-shadow:0 2px 8px rgba(0,0,0,0.2); 
transition:all 0.3s ease;
z-index:1000;
} 
.bg-upload-btn:hover{ 
transform:scale(1.1); 
box-shadow:0 4px 12px rgba(0,0,0,0.3);
} 
.bg-upload-btn i{ 
color:#667eea; 
font-size:18px;
} 
#bgInput{ display: none;} 

/* Toastæç¤º */
.toast{ 
position: fixed; 
bottom: 30px; 
left: 50%; 
transform: translateX(-50%) translateY(100px);
background:rgba(102,126,234,0.95); 
color: white; 
padding: 12px 24px; 
border-radius: 30px; 
font-size: 14px;
font-weight:500;
box-shadow:0 4px 12px rgba(0,0,0,0.2); 
opacity:0; 
transition: all 0.3s ease; 
z-index:2000; 
max-width: 80%; 
text-align: center;
} 
.toast.show{ 
transform:translateX(-50%) translateY(0);
opacity:1;
} 

/* Poki å•ç‹¬å¡ç‰‡*/
.featured-container{margin-bottom:30px;animation:slideIn 0.6s ease;} 
.featured-card{
background: rgba(255,255,255,0.95); 
border-radius:15px; 
padding:30px; 
text-decoration:none; 
color:#333; 
transition:all 0.3s ease; 
box-shadow:0 10px 30px rgba(0,0,0,0.2); 
backdrop-filter:blur(10px); 
position:relative; 
overflow:hidden; 
cursor: pointer; 
display: flex; 
flex-direction: column; 
align-items: center; 
text-align: center;
} 
.featured-card::before{
content:""; 
position:absolute; 
top:0; 
left:0; 
right:0; 
height:4px; 
background:linear-gradient(90deg,#667eea,#764ba2); 
transform:scaleX(0); 
transition:transform 0.3s ease; 
} 
.featured-card:hover{
transform: translateY(-5px); 
box-shadow:0 15px 40px rgba(0,0,0,0.3);
} 
.featured-card:hover::before{ transform: scaleX(1);} 
.featured-icon{font-size:5rem;margin-bottom:20px;animation:float 3s ease-in-out infinite;}
.featured-title{font-size:2.2rem;font-weight:700;color:#333;margin-bottom:15px;}
.featured-desc{font-size:1.1rem;color:#666;line-height:1.6;max-width:600px;}
.featured-badge{display:inline-block;background:linear-gradient(135deg,#667eea,#764ba2);color:white;padding:8px 16px;border-radius:20px;font-size:14px;font-weight:bold;margin-top:15px;}

/* æ¸¸æˆç½‘æ ¼- è‡ªé€‚åº”å¸ƒå±€*/
.games-grid{
display:grid; 
grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); 
gap:15px; 
margin-bottom:20px; 
animation:fadeIn 0.8s ease; 
} 
.game-card{
background: rgba(255,255,255,0.95); 
border-radius:15px; 
padding:20px; 
text-decoration:none; 
color:#333; 
transition:all 0.3s ease; 
box-shadow:0 5px 15px rgba(0,0,0,0.1); 
backdrop-filter:blur(10px);
position:relative; 
overflow:hidden; 
cursor: pointer; 
display: flex; 
flex-direction: column; 
align-items: center; 
text-align: center; 
min-height: 160px; 
} 
.game-card::before{
content:""; 
position:absolute; 
top:0; 
left:0; 
right:0; 
height:3px; 
background:linear-gradient(90deg,#667eea,#764ba2); 
transform:scaleX(0); 
transition:transform 0.3s ease; 
} 
.game-card:hover{
transform: translateY(-5px); 
box-shadow:0 15px 30px rgba(0,0,0,0.2);
} 
.game-card:hover::before{ transform: scaleX(1);} 
.game-number{ display: inline-block; background:linear-gradient(135deg,#667eea,#764ba2);color:white; padding:4px 10px;border-radius:20px;font-size:11px;font-weight:bold;margin-bottom:8px; } 
.game-icon{font-size:2.8rem;margin-bottom:12px;animation:float 3s ease-in-out infinite;}
.game-name{ font-size:1.1rem;font-weight:600;color:#333;line-height:1.3;margin-bottom:6px;}
.game-desc{font-size:0.85rem;color:#666;line-height:1.4;}

/* InAppBrowser å®¹å™¨*/
#inapp-browser {
position: fixed; 
top: 0; 
left: 0; 
width: 100%; 
height: 100%; 
background: white; 
z-index: 1000;
display: none; 
flex-direction: column;
} 
#inapp-browser.active { display: flex;}

/* æµè§ˆå™¨é¡¶éƒ¨æ */
.browser-header { 
background: linear-gradient(135deg, #667eea, #764ba2); 
color: white; 
padding: 15px 20px; 
display: flex; 
align-items: center; 
gap: 15px; 
box-shadow: 0 4px 20px rgba(0,0,0,0.1);
} 
.browser-controls { display: flex; gap: 10px;}
.browser-btn { 
width: 40px; 
height: 40px; 
background: rgba(255,255,255,0.2); 
border: none; 
border-radius: 50%; 
display: flex; 
align-items: center; 
justify-content: center; 
cursor: pointer; 
font-size: 16px; 
transition: all 0.3s; 
color: white;
} 
.browser-btn:hover { 
background: rgba(255,255,255,0.3); 
transform: scale(1.1);
} 
.browser-title { 
flex: 1; 
font-size: 16px; 
font-weight: 600; 
text-align: center; 
white-space: nowrap; 
overflow: hidden; 
text-overflow: ellipsis;
} 
.browser-url { 
background: rgba(255,255,255,0.2); 
color: white; 
padding: 8px 15px; 
border-radius: 20px; 
font-size: 12px; 
white-space: nowrap; 
overflow: hidden; 
text-overflow: ellipsis; 
max-width: 250px;
} 

/* æµè§ˆå™¨å†…å®¹åŒº*/
.browser-content { 
flex: 1; 
position: relative; 
background: white;
} 
#browser-iframe { 
width: 100%; 
height: 100%; 
border: none; 
display: block;
} 

/* åŠ è½½æŒ‡ç¤ºå™¨*/
.browser-loading { 
position: absolute; 
top: 50%; 
left: 50%; 
transform: translate(-50%, -50%); 
display: none; 
flex-direction: column;
align-items: center; 
gap: 15px;
} 
.browser-loading.show { display: flex;}
.loading-spinner { 
width: 50px; 
height: 50px; 
border: 4px solid #f3f3f3; 
border-top: 4px solid #667eea; 
border-radius: 50%; 
animation: spin 1s linear infinite;
} 
.loading-text { 
font-size: 16px; 
color: #666; 
font-weight: 500;
} 

/* æ§åˆ¶æŒ‰é’®*/
.control-buttons { 
position: fixed; 
bottom: 30px; 
right: 30px; 
display: flex; 
gap: 15px; 
z-index: 100;
} 
.control-btn { 
width: 50px; 
height: 50px; 
background: rgba(255,255,255,0.9); 
backdrop-filter: blur(10px); 
border: 1px solid rgba(255,255,255,0.3); 
border-radius: 50%; 
font-size: 20px; 
cursor: pointer; 
box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
transition: all 0.3s;
display: flex; 
align-items: center; 
justify-content: center;
} 
.control-btn:hover { 
transform: scale(1.1); 
box-shadow: 0 15px 40px rgba(0,0,0,0.15);
} 

/* æ¨¡æ€æ¡†*/
.modal { 
position: fixed; 
top: 0; 
left: 0; 
width: 100%; 
height: 100%; 
background: rgba(0,0,0,0.5); 
backdrop-filter: blur(5px); 
display: none; 
align-items: center; 
justify-content: center; 
z-index: 2000;
} 
.modal.show { display: flex;}
.modal-content { 
background: rgba(255,255,255,0.95); 
backdrop-filter: blur(20px); 
border: 1px solid rgba(255,255,255,0.3); 
border-radius: 24px; 
padding: 40px; 
width: 90%; 
max-width: 450px; 
box-shadow: 0 20px 60px rgba(0,0,0,0.2);
} 
.modal-title { 
font-size: 1.8rem; 
font-weight: 700; 
text-align: center;
margin-bottom: 30px; 
color: #333;
} 
.form-group { margin-bottom: 20px;}
.form-group label { 
display: block; 
margin-bottom: 8px; 
font-weight: 600; 
color: #333;
} 
.form-group input { 
width: 100%; 
padding: 15px; 
border: 2px solid #e0e0e0; 
border-radius: 12px; 
font-size: 16px; 
transition: all 0.3s; 
background: rgba(255,255,255,0.8);
} 
.form-group input:focus { 
outline: none; 
border-color: #667eea; 
box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
} 
.modal-buttons { 
display: flex; 
gap: 15px; 
margin-top: 30px;
} 
.modal-btn { 
flex: 1; 
padding: 15px; 
border: none; 
border-radius: 12px; 
font-size: 16px; 
font-weight: 600;
cursor: pointer; 
transition: all 0.3s;
} 
.modal-btn.cancel { 
background: #f5f5f5; 
color: #666;
} 
.modal-btn.confirm { 
background: linear-gradient(135deg, #667eea, #764ba2); 
color: white;
} 
.modal-btn:hover { 
transform: translateY(-2px); 
box-shadow: 0 10px 30px rgba(0,0,0,0.2);
} 

/* åŠ¨ç”»*/
@keyframes fadeInDown{from{opacity:0;transform:translateY(-20px);}to{opacity:1;transform:translateY(0);}}
@keyframes fadeInUp{ from{ opacity:0;transform:translateY(20px);} to{opacity:1;transform:translateY(0);}}
@keyframes fadeIn{ from{ opacity: 0;} to: opacity:1;}} 
@keyframes slideIn{ from{ opacity: 0; transform: translateY(-10px);} to:opacity:1;transform:translateY(0);}}
@keyframes float{0%,100%{transform:translateY(0);}50%{transform:translateY(-10px);}}
@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}

/* å“åº”å¼*/
@media(max-width: 768px){
h1{ font-size: 2rem;} 
.featured-card{padding:20px;} 
.featured-title{font-size:1.8rem;} 
.featured-icon{font-size:4rem;} 
.game-icon{font-size:2.5rem;}
} 

@media(max-width: 480px){
.games-grid{gap:10px;}
.game-card{padding:15px;min-height:140px;}
.game-icon{font-size:2.2rem;}
.game-name{font-size:1rem;}
.game-desc{font-size:0.8rem;}
}
</style> 
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body> 
<!-- èƒŒæ™¯æ›´æ¢æŒ‰é’® -->
<div class="bg-upload-btn" onclick="document.getElementById('bgInput').click()" title="æ›´æ¢èƒŒæ™¯">
    <i class="fas fa-image"></i>
</div>
<input type="file" id="bgInput" accept="image/*" onchange="handleBgUpload(event)">
<div id="toast" class="toast"></div>

<div class="container"> 
<header>
<h1>æ¸¸æˆä¸–ç•Œ</h1> 
<p class="subtitle">ç²¾é€‰å°æ¸¸æˆï¼Œéšæ—¶ç•…ç©</p> 
</header>

<!-- Poki å•ç‹¬å¡ç‰‡-->
<div class="featured-container">
<div class="featured-card" onclick="openInAppBrowser({name: 'Poki123 æ¸¸æˆå¹³å°', url: 'https://poki.com/zh', icon: 'ğŸ®'})">
<div class="featured-icon">ğŸ®</div>
<div class="featured-title">Poki123 æ¸¸æˆå¹³å°</div> 
<div class="featured-desc">å¤§å‹ç»¼åˆæ¸¸æˆå¹³å°ï¼Œ æ¸¸æˆæ•°é‡è¶…ä¸¤ä¸‡ï¼Œ æ¶µç›–åŠ¨ä½œã€è§£è°œã€è·‘é…·ç­‰å¤šç§ç±»å‹</div>
<div class="featured-badge">çƒ­é—¨æ¨è</div> 
</div> 
</div>

<!-- æ¸¸æˆç½‘æ ¼- è‡ªé€‚åº”å¸ƒå±€-->
<main> 
<div class="games-grid" id="gamesGrid"></div> 
</main> 
</div>

<!-- InAppBrowser å®¹å™¨-->
<div id="inapp-browser">
<div class="browser-header">
<div class="browser-controls">
<button class="browser-btn" id="browser-back" title="åé€€">â†</button>
<button class="browser-btn" id="browser-forward" title="å‰è¿›">â†’</button>
<button class="browser-btn" id="browser-refresh" title="åˆ·æ–°">â†»</button>
</div>
<div class="browser-title" id="browser-title">æ¸¸æˆåŠ è½½ä¸­...</div> 
<div class="browser-url" id="browser-url"></div>
<button class="browser-btn" id="browser-close" title="å…³é—­">âœ•</button>
</div> 
<div class="browser-content">
<iframe id="browser-iframe" sandbox="allow-same-origin allow-scripts allow-popups allow-forms allow-top-navigation-by-user-activation"></iframe>
<div class="browser-loading" id="browser-loading">
<div class="loading-spinner"></div>
<div class="loading-text">æ­£åœ¨åŠ è½½æ¸¸æˆ...</div> 
</div> 
</div> 
</div>

<!-- æ§åˆ¶æŒ‰é’®-->
<div class="control-buttons">
<button class="control-btn" id="add-btn" title="æ·»åŠ æ¸¸æˆ">+</button> 
<button class="control-btn" id="rotate-btn" title="åˆ·æ–°å¡ç‰‡">â†»</button> 
<button class="control-btn" id="clear-btn" title="é‡ç½®æ¸¸æˆ">ğŸ—‘ï¸</button> 
</div>

<!-- æ·»åŠ æ¸¸æˆçš„æ¨¡æ€æ¡†-->
<div class="modal" id="add-modal">
<div class="modal-content">
<div class="modal-title">æ·»åŠ æ–°æ¸¸æˆ</div> 
<div class="form-group">
<label for="site-name">æ¸¸æˆåç§°</label> 
<input type="text" id="site-name" placeholder="è¾“å…¥æ¸¸æˆåç§°"> 
</div> 
<div class="form-group">
<label for="site-url">æ¸¸æˆåœ°å€</label> 
<input type="text" id="site-url" placeholder="è¾“å…¥æ¸¸æˆURL (åŒ…å«http://æˆ–https://)">
</div> 
<div class="modal-buttons">
<button class="modal-btn cancel" id="cancel-add">å–æ¶ˆ</button>
<button class="modal-btn confirm" id="confirm-add">ç¡®è®¤æ·»åŠ </button>
</div> 
</div> 
</div>

<script>
// èƒŒæ™¯ä¸»é¢˜æ•°ç»„ï¼ˆ20 ç§æ¸å˜è‰²ï¼‰ 
const backgrounds = [
'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', 
'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)', 
'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)', 
'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
'linear-gradient(135deg, #fa709a 0%, #fee140 100%)', 
'linear-gradient(135deg, #30cfd0 0%, #330867 100%)', 
'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)', 
'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)', 
'linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%)', 
'linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%)', 
'linear-gradient(135deg, #d299c2 0%, #fef9d7 100%)', 
'linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%)', 
'linear-gradient(135deg, #fddb92 0%, #d1fdff 100%)', 
'linear-gradient(135deg, #9890e3 0%, #b1f4cf 100%)', 
'linear-gradient(135deg, #ebc0fd 0%, #d9ded8 100%)', 
'linear-gradient(135deg, #96e6a1 0%, #d4fc79 100%)', 
'linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)', 
'linear-gradient(135deg, #ff6e7f 0%, #bfe9ff 100%)', 
'linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%)', 
'linear-gradient(135deg, #f6d365 0%, #fda085 100%)' 
];

// æ¸¸æˆç½‘ç«™æ•°æ® 
let sites = [
{name: 'å°æ¸¸æˆåˆé›†', url: 'https://cn.pigame.cc/tag/mobile', icon: 'ğŸ•¹ï¸', desc:'ç»å…¸çº¢ç™½æœºã€è¡—æœºæ¸¸æˆåˆé›†'},
{name: 'PlayHop æ¸¸æˆ', url: 'https://playhop.com/zh', icon: 'ğŸ¯', desc: 'é«˜å“è´¨HTML5 æ¸¸æˆå¹³å°'},
{name: 'Slither.io', url: 'http://slither.io', icon: 'ğŸ', desc: 'å¤šäººåœ¨çº¿è´ªåƒè›‡å¤§ä½œæˆ˜'},
{name: 'SEOML æ¸¸æˆ', url: 'https://game.seoml.com/onlie/', icon: 'ğŸ²', desc:'è€ç‰Œæ¸¸æˆç½‘ç«™ï¼Œæµ·é‡æ¸¸æˆ'},
{name: 'æ¡Œæ¸¸åˆé›†', url: 'https://game.hullqin.cn', icon: 'ğŸ²', desc: '20 å¤šæ¬¾è”æœºæ¡Œæ¸¸'},
{name: 'åœ¨çº¿CS1.6', url: 'https://play-cs.com/zh/servers', icon: 'ğŸ”«', desc: 'ç½‘é¡µç‰ˆåæç²¾è‹±'},
{name: 'Slow Roads', url: 'https://slowroads.io', icon: 'ğŸš—', desc: 'æ…¢èŠ‚å¥é©¾é©¶æ¸¸æˆ'}
];

let browserHistory = []; 
let currentHistoryIndex = -1;

// è®¾ç½®éšæœºèƒŒæ™¯ 
function setRandomBackground() {
    const randomIndex = Math.floor(Math.random() * backgrounds.length); 
    document.body.style.background = backgrounds[randomIndex];
}

// ç”Ÿæˆæ¸¸æˆå¡ç‰‡ 
function generateGames() {
    const gamesGrid = document.getElementById('gamesGrid'); 
    gamesGrid.innerHTML = '';
    
    sites.forEach((site, index) => {
        const card = document.createElement('div'); 
        card.className = 'game-card'; 
        card.onclick = () => openInAppBrowser(site);
        
        card.innerHTML = `
            <div class="game-number">${index + 1}</div> 
            <div class="game-icon">${site.icon}</div> 
            <div class="game-name">${site.name}</div> 
            <div class="game-desc">${site.desc}</div> 
        `;
        
        gamesGrid.appendChild(card); 
    });
}

// æ‰“å¼€InAppBrowser 
function openInAppBrowser(site) {
    const browser = document.getElementById('inapp-browser'); 
    const iframe = document.getElementById('browser-iframe'); 
    const title = document.getElementById('browser-title'); 
    const url = document.getElementById('browser-url'); 
    const loading = document.getElementById('browser-loading');
    
    // æ˜¾ç¤ºæµè§ˆå™¨ 
    browser.classList.add('active'); 
    loading.classList.add('show');
    
    // è®¾ç½®æ ‡é¢˜å’ŒURL 
    title.textContent = site.name; 
    url.textContent = site.url;
    
    // æ·»åŠ åˆ°å†å²è®°å½• 
    browserHistory.push(site.url); 
    currentHistoryIndex = browserHistory.length - 1;
    
    // åˆ›å»ºæ–°çš„iframe å…ƒç´  
    const newIframe = document.createElement('iframe');
    newIframe.id = 'browser-iframe'; 
    newIframe.sandbox = 'allow-same-origin allow-scripts allow-popups allow-forms allow-top-navigation-by-user-activation';
    newIframe.style.cssText = 'width: 100%; height: 100%; border: none; display: block;';
    newIframe.setAttribute('allow', 'fullscreen *; picture-in-picture *; microphone *; camera *; geolocation *');
    newIframe.setAttribute('referrerpolicy', 'no-referrer-when-downgrade');
    
    // æ›¿æ¢æ—§çš„iframe 
    const oldIframe = document.getElementById('browser-iframe'); 
    oldIframe.parentNode.replaceChild(newIframe, oldIframe);
    
    // è®¾ç½®åŠ è½½äº‹ä»¶ 
    newIframe.onload = function() {
        setTimeout(() => {
            loading.classList.remove('show'); 
        }, 1000); 
    };
    
    newIframe.onerror = function() {
        loading.classList.remove('show'); 
        loadWithProxy(site.url); 
    };
    
    // åŠ è½½URL 
    newIframe.src = site.url;
    
    // æ›´æ–°æŒ‰é’®çŠ¶æ€ 
    updateBrowserControls();
}

// ä½¿ç”¨ä»£ç†åŠ è½½ 
function loadWithProxy(originalUrl) {
    const iframe = document.getElementById('browser-iframe'); 
    const loading = document.getElementById('browser-loading');
    
    const proxyUrls = [
        `https://r.jina.ai/http://${originalUrl.replace(/^https?:\/\//, '')}`,
        `https://api.allorigins.win/raw?url=${encodeURIComponent(originalUrl)}`,
        `https://corsproxy.io/?${encodeURIComponent(originalUrl)}`
    ]; 
    
    iframe.src = proxyUrls[0];
    
    iframe.onload = function() {
        setTimeout(() => {
            loading.classList.remove('show'); 
        }, 1000); 
    };
}

// å…³é—­InAppBrowser 
function closeInAppBrowser() {
    const browser = document.getElementById('inapp-browser'); 
    const iframe = document.getElementById('browser-iframe');
    
    browser.classList.remove('active'); 
    iframe.src = '';
    
    browserHistory = []; 
    currentHistoryIndex = -1;
}

// æµè§ˆå™¨å¯¼èˆª 
function browserBack() {
    if (currentHistoryIndex > 0) {
        currentHistoryIndex--; 
        const url = browserHistory[currentHistoryIndex]; 
        const iframe = document.getElementById('browser-iframe'); 
        iframe.src = url; 
        updateBrowserControls();
    }
}

function browserForward() {
    if (currentHistoryIndex < browserHistory.length - 1) {
        currentHistoryIndex++; 
        const url = browserHistory[currentHistoryIndex]; 
        const iframe = document.getElementById('browser-iframe'); 
        iframe.src = url; 
        updateBrowserControls();
    }
}

function browserRefresh() {
    const iframe = document.getElementById('browser-iframe');
    const loading = document.getElementById('browser-loading'); 
    const currentSrc = iframe.src;
    
    loading.classList.add('show'); 
    iframe.src = ''; 
    setTimeout(() => {
        iframe.src = currentSrc; 
    }, 100);
}

// æ›´æ–°æµè§ˆå™¨æ§åˆ¶æŒ‰é’®çŠ¶æ€ 
function updateBrowserControls() {
    const backBtn = document.getElementById('browser-back'); 
    const forwardBtn = document.getElementById('browser-forward');
    
    backBtn.style.opacity = currentHistoryIndex > 0 ? '1' : '0.5'; 
    forwardBtn.style.opacity = currentHistoryIndex < browserHistory.length - 1 ? '1' : '0.5';
}

// åˆ·æ–°å¡ç‰‡åŠ¨ç”» 
function refreshCards() {
    const cards = document.querySelectorAll('.game-card'); 
    cards.forEach((card, index) => {
        card.style.transform = 'scale(0.8)'; 
        card.style.opacity = '0'; 
        setTimeout(() => {
            card.style.transform = 'scale(1)'; 
            card.style.opacity = '1'; 
        }, index * 100); 
    });
}

// æ˜¾ç¤ºæ·»åŠ æ¨¡æ€æ¡† 
function showAddModal() {
    document.getElementById('add-modal').classList.add('show');
}

// éšè—æ·»åŠ æ¨¡æ€æ¡† 
function hideAddModal() {
    document.getElementById('add-modal').classList.remove('show'); 
    document.getElementById('site-name').value = ''; 
    document.getElementById('site-url').value = '';
}

// æ·»åŠ æ–°æ¸¸æˆ 
function addNewSite() {
    const name = document.getElementById('site-name').value.trim(); 
    const url = document.getElementById('site-url').value.trim();
    
    if (!name || !url) {
        showToast('è¯·å¡«å†™å®Œæ•´çš„æ¸¸æˆä¿¡æ¯ï¼'); 
        return;
    }
    
    if (!url.startsWith('http://') && !url.startsWith('https://')) {
        showToast('è¯·è¾“å…¥æœ‰æ•ˆçš„URLï¼ˆåŒ…å«http://æˆ–https://ï¼‰'); 
        return;
    }
    
    const icons = ['ğŸ®', 'ğŸ•¹ï¸', 'ğŸ¯', 'ğŸ', 'ğŸ²', 'ğŸ”«', 'ğŸš—', 'ğŸ¨', 'ğŸª', 'ğŸ­', 'ğŸ¬', 'ğŸ‘‘']; 
    const randomIcon = icons[Math.floor(Math.random() * icons.length)];
    
    sites.push({
        name: name, 
        url: url, 
        icon: randomIcon,
        desc: 'ç”¨æˆ·æ·»åŠ çš„æ¸¸æˆ' 
    });
    
    generateGames(); 
    hideAddModal();
}

// é‡ç½®æ¸¸æˆ 
function resetGames() {
    if (confirm('ç¡®å®šè¦é‡ç½®ä¸ºåˆå§‹æ¸¸æˆåˆ—è¡¨å—ï¼Ÿ')) {
        sites = [
            {name: 'å°æ¸¸æˆåˆé›†', url: 'https://cn.pigame.cc/tag/mobile', icon:'ğŸ•¹ï¸', desc: 'ç»å…¸çº¢ç™½æœºã€è¡—æœºæ¸¸æˆåˆé›†'},
            {name: 'PlayHop æ¸¸æˆ', url: 'https://playhop.com/zh', icon:'ğŸ¯', desc: 'é«˜å“è´¨HTML5 æ¸¸æˆå¹³å°'},
            {name: 'Slither.io', url: 'http://slither.io', icon:'ğŸ', desc: 'å¤šäººåœ¨çº¿è´ªåƒè›‡å¤§ä½œæˆ˜'},
            {name: 'SEOML æ¸¸æˆ', url: 'https://game.seoml.com/onlie/', icon:'ğŸ²', desc: 'è€ç‰Œæ¸¸æˆç½‘ç«™ï¼Œæµ·é‡æ¸¸æˆ'},
            {name: 'æ¡Œæ¸¸åˆé›†', url: 'https://game.hullqin.cn', icon:'ğŸ²', desc: '20 å¤šæ¬¾è”æœºæ¡Œæ¸¸'},
            {name: 'åœ¨çº¿CS1.6', url: 'https://play-cs.com/zh/servers', icon:'ğŸ”«', desc: 'ç½‘é¡µç‰ˆåæç²¾è‹±'},
            {name: 'Slow Roads', url: 'https://slowroads.io', icon:'ğŸš—', desc: 'æ…¢èŠ‚å¥é©¾é©¶æ¸¸æˆ'}
        ]; 
        generateGames();
    }
}

// Toastæç¤º
function showToast(message, duration=3000) {
    const toast = document.getElementById('toast');
    toast.textContent = message;
    toast.classList.add('show');
    setTimeout(() => {
        toast.classList.remove('show');
    }, duration);
}

// èƒŒæ™¯ä¸Šä¼ å¤„ç†
function handleBgUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    if (!file.type.startsWith('image/')) {
        showToast('è¯·é€‰æ‹©æœ‰æ•ˆçš„å›¾ç‰‡æ–‡ä»¶');
        return;
    }
    
    if (file.size > 5*1024*1024) {
        showToast('å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡5MB');
        return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            localStorage.setItem('pageBackground', e.target.result);
            localStorage.setItem('bgTimestamp', Date.now().toString());
            document.body.style.backgroundImage = `url(${e.target.result})`;
            document.body.style.backgroundSize = 'cover';
            document.body.style.backgroundPosition = 'center';
            document.body.style.backgroundAttachment = 'fixed';
            showToast('èƒŒæ™¯æ›´æ¢æˆåŠŸ!');
        } catch (e) {
            showToast('èƒŒæ™¯æ›´æ¢å¤±è´¥ï¼Œè¯·æ›´æ¢å¦ä¸€å¼ å›¾ç‰‡');
        }
    };
    
    reader.onerror = function() {
        showToast('å›¾ç‰‡è¯»å–å¤±è´¥ï¼Œè¯·æ›´æ¢å¦ä¸€å¼ å›¾ç‰‡');
    };
    
    reader.readAsDataURL(file);
    event.target.value = "";
}

// åŠ è½½ä¿å­˜çš„èƒŒæ™¯
function loadSavedBackground() {
    const savedBg = localStorage.getItem('pageBackground');
    const timestamp = localStorage.getItem('bgTimestamp');
    if (savedBg && timestamp) {
        const age = Date.now() - parseInt(timestamp);
        if (age < 7*24*60*60*1000) { // 7å¤©æœ‰æ•ˆæœŸ
            document.body.style.backgroundImage = `url(${savedBg})`;
            document.body.style.backgroundSize = 'cover';
            document.body.style.backgroundPosition = 'center';
            document.body.style.backgroundAttachment = 'fixed';
            return true;
        } else {
            localStorage.removeItem('pageBackground');
            localStorage.removeItem('bgTimestamp');
        }
    }
    return false;
}

// äº‹ä»¶ç»‘å®š 
document.getElementById('browser-close').addEventListener('click', closeInAppBrowser);
document.getElementById('browser-back').addEventListener('click', browserBack);
document.getElementById('browser-forward').addEventListener('click', browserForward);
document.getElementById('browser-refresh').addEventListener('click', browserRefresh);
document.getElementById('add-btn').addEventListener('click', showAddModal);
document.getElementById('rotate-btn').addEventListener('click', refreshCards);
document.getElementById('clear-btn').addEventListener('click', resetGames);
document.getElementById('cancel-add').addEventListener('click', hideAddModal);
document.getElementById('confirm-add').addEventListener('click', addNewSite);

// ESC é”®å…³é—­æµè§ˆå™¨å’Œæ¨¡æ€æ¡† 
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        if (document.getElementById('inapp-browser').classList.contains('active')) {
            closeInAppBrowser();
        } else if (document.getElementById('add-modal').classList.contains('show')) {
            hideAddModal();
        }
    }
});

// é¡µé¢åŠ è½½å®Œæˆ
window.addEventListener('load', () => {
    if (!loadSavedBackground()) {
        setRandomBackground();
    }
    generateGames(); 
});
</script> 
</body> 
</html>
