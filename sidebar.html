<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>用户中心</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{ font-family:-apple-system, BlinkMacSystemFont,'Segoe UI', Roboto,'Helvetica Neue',Arial, sans-serif; background:linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(240,240,255,0.95) 100%);margin:0;padding:0;height:100vh;overflow-y:auto;backdrop-filter:blur(10px);}
.top-bar{display:flex;justify-content:space-between;align-items:center;padding:8px 15px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;box-shadow:0 2px 10px rgba(0,0,0,0.1);}
.user-status{font-size:13px;padding:4px 10px;background:rgba(255,255,255,0.2);border-radius:12px;display:inline-block;font-weight:500;}
.button-group{display:flex;align-items:center;gap:5px;}
.sidebar-bg-btn{background:rgba(255,255,255,0.2);border:none;color:white;width:28px;height:28px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.3s ease;font-size:13px;flex-shrink:0;}
.sidebar-bg-btn:hover{background:rgba(255,255,255,0.3);transform:scale(1.1);}
.sidebar-close{background:rgba(255,255,255,0.2);border:none;color:white;width:28px;height:28px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.3s ease;font-size:13px;flex-shrink:0;}
.sidebar-close:hover{background:rgba(255,255,255,0.3);transform:rotate(90deg);}
.user-profile-section{padding:15px;background:white;margin:10px 15px 15px;border-radius:15px;box-shadow:0 3px 15px rgba(0,0,0,0.08);position:relative;text-align:center;}
.avatar-container{margin-bottom:10px;}
.sidebar-avatar{width:100px;height:100px;border-radius:50%;object-fit:cover;border:4px solid #667eea;margin-bottom:8px;cursor:pointer;transition:all 0.3s ease;box-shadow:0 5px 15px rgba(102,126,234,0.3);}
.sidebar-avatar:hover{transform:scale(1.05);box-shadow:0 8px 25px rgba(102,126,234,0.4);}
.username-container{margin-bottom:10px;}
.sidebar-username{font-size:1.1rem;font-weight:bold;color:#333;margin-bottom:5px;cursor:pointer;transition:all 0.3s ease;display:inline-block;padding:4px 12px;border-radius:20px;background:linear-gradient(135deg,#f5f5f5 0%,#e8e8e8 100%);}
.sidebar-username:hover{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;transform:scale(1.02);}
.username-input{width:80%;padding:8px 12px;border:2px solid #667eea;border-radius:20px;font-size:1rem;text-align:center;display:none;background:white;box-shadow:0 3px 10px rgba(0,0,0,0.1);}
.username-actions{display:none;justify-content:center;gap:8px;margin-top:8px;}
.signature-container{margin:10px 0;}
.signature-label{font-size:12px;color:#666;margin-bottom:5px;display:block;font-weight:500;}
.signature{background:linear-gradient(135deg,#f8f9fa 0%,#e9ecef 100%);padding:8px 12px;border-radius:10px;font-size:13px;color:#333;min-height:35px;cursor:pointer;transition:all 0.3s ease;border:2px solid transparent;box-shadow:0 2px 8px rgba(0,0,0,0.05);}
.signature:hover{background:linear-gradient(135deg,#e9ecef 0%,#dee2e6 100%);border-color:#667eea;transform:translateY(-2px);}
.signature-input{width:100%;padding:8px 12px;border:2px solid #667eea;border-radius:10px;font-size:13px;display:none;background:white;box-shadow:0 3px 10px rgba(0,0,0,0.1);}
.signature-actions{display:none;justify-content:center;gap:8px;margin-top:8px;}
.btn-save,.btn-cancel{padding:5px 12px;border:none;border-radius:15px;cursor:pointer;font-size:12px;font-weight:500;transition:all 0.3s ease;box-shadow:0 2px 8px rgba(0,0,0,0.1);}
.btn-save{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;}
.btn-cancel{background:linear-gradient(135deg,#e9ecef 0%,#dee2e6 100%);color:#333;}
.btn-save:hover{background:linear-gradient(135deg,#5a6fd8 0%,#6a4190 100%);transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.2);}
.btn-cancel:hover{background:linear-gradient(135deg,#dee2e6 0%,#ced4da 100%);transform:translateY(-2px);}
.menu-section{padding:15px 15px;margin:0 15px 15px;background:white;border-radius:15px;box-shadow:0 3px 15px rgba(0,0,0,0.08);}
.menu-title{font-size:1rem;font-weight:bold;color:#333;margin-bottom:10px;padding-bottom:6px;border-bottom:2px solid #f0f0f0;display:flex;align-items:center;gap:8px;}
.menu-title::before{content:'';width:4px;height:16px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:2px;}
.menu-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;}
.menu-item{background:linear-gradient(135deg,#f8f9fa 0%,#ffffff 100%);padding:10px;border-radius:10px;text-align:center;cursor:pointer;transition:all 0.3s ease;border:1px solid #e9ecef;box-shadow:0 2px 8px rgba(0,0,0,0.05);}
.menu-item:hover{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);transform:translateY(-3px);box-shadow:0 5px 15px rgba(102,126,234,0.3);border-color:transparent;}
.menu-item:hover .menu-icon{color:white;transform:scale(1.1);}
.menu-item:hover .menu-name{color:white;}
.menu-icon{font-size:16px;margin-bottom:5px;color:#667eea;transition:all 0.3s ease;}
.menu-name{font-size:11px;color:#333;font-weight:500;transition:all 0.3s ease;}
#avatarInput{display:none;}

/* 确保即使在窄屏下也是两列布局 */
@media(max-width: 480px){
    .menu-grid{grid-template-columns:repeat(2,1fr);gap:6px;}
    .menu-item{padding:8px 6px;}
    .menu-icon{font-size:14px;margin-bottom:3px;}
    .menu-name{font-size:10px;}
    .user-profile-section{padding:12px;}
    .sidebar-avatar{width:80px;height:80px;}
    .sidebar-username{font-size:1rem;}
    .top-bar{padding:6px 10px;}
    .user-status{font-size:12px;padding:3px 8px;}
    .sidebar-bg-btn,.sidebar-close{width:24px;height:24px;font-size:11px;}
    .button-group{gap:3px;}
}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
<div class="top-bar">
<div class="user-status" id="userStatus">普通用户</div>
<div class="button-group">
<button class="sidebar-bg-btn" onclick="changeBackground()" title="更换背景">
<i class="fas fa-image"></i>
</button>
<button class="sidebar-close" onclick="closeSidebar()">
<i class="fas fa-times"></i>
</button>
</div>
</div>

<div class="user-profile-section">
<div class="avatar-container">
<img id="sidebarUserAvatar" class="sidebar-avatar" src="https://picsum.photos/seed/default-avatar/100/100.jpg" alt="用户头像" onclick="document.getElementById('avatarInput').click()">
<input type="file" id="avatarInput" accept="image/*" onchange="handleAvatarUpload(event)">
</div>

<div class="username-container">
<div class="sidebar-username" id="usernameDisplay" onclick="editUsername()">凉安</div>
<input type="text" class="username-input" id="usernameInput" maxlength="20" placeholder="输入用户名">
<div class="username-actions" id="usernameActions">
<button class="btn-save" onclick="saveUsername()">保存</button>
<button class="btn-cancel" onclick="cancelEditUsername()">取消</button>
</div>
</div>

<div class="signature-container">
<label class="signature-label">个性签名</label>
<div class="signature" id="signatureDisplay" onclick="editSignature()">暂无个性签名</div>
<input type="text" class="signature-input" id="signatureInput" maxlength="19" placeholder="输入个性签名(最多19字)">
<div class="signature-actions" id="signatureActions">
<button class="btn-save" onclick="saveSignature()">保存</button>
<button class="btn-cancel" onclick="cancelEditSignature()">取消</button>
</div>
</div>
</div>

<div class="menu-section">
<div class="menu-title">我的游戏</div>
<div class="menu-grid">
<div class="menu-item">
<div class="menu-icon"><i class="fas fa-star"></i></div>
<div class="menu-name">收藏</div>
</div>
<div class="menu-item">
<div class="menu-icon"><i class="fas fa-history"></i></div>
<div class="menu-name">历史记录</div>
</div>
<div class="menu-item">
<div class="menu-icon"><i class="fas fa-trophy"></i></div>
<div class="menu-name">成就</div>
</div>
<div class="menu-item">
<div class="menu-icon"><i class="fas fa-chart-bar"></i></div>
<div class="menu-name">游戏统计</div>
</div>
</div>
</div>

<div class="menu-section">
<div class="menu-title">设置</div>
<div class="menu-grid">
<div class="menu-item">
<div class="menu-icon"><i class="fas fa-bell"></i></div>
<div class="menu-name">通知设置</div>
</div>
<div class="menu-item">
<div class="menu-icon"><i class="fas fa-shield-alt"></i></div>
<div class="menu-name">隐私设置</div>
</div>
<div class="menu-item">
<div class="menu-icon"><i class="fas fa-question-circle"></i></div>
<div class="menu-name">帮助与反馈</div>
</div>
<div class="menu-item">
<div class="menu-icon"><i class="fas fa-info-circle"></i></div>
<div class="menu-name">关于</div>
</div>
<div class="menu-item">
<div class="menu-icon"><i class="fas fa-moon"></i></div>
<div class="menu-name">夜间模式</div>
</div>
<div class="menu-item">
<div class="menu-icon"><i class="fas fa-language"></i></div>
<div class="menu-name">语言设置</div>
</div>
</div>
</div>

<script>
// 更新用户数据
function updateUserData() {
    loadUserAvatar();
    loadUserData();
}

// 加载用户数据
function loadUserData() {
    // 加载用户名
    const savedUsername = localStorage.getItem('username');
    if (savedUsername) {
        document.getElementById('usernameDisplay').textContent = savedUsername;
    } else {
        // 如果没有保存的用户名，使用默认值
        document.getElementById('usernameDisplay').textContent = '凉安';
    }
    
    // 加载个性签名
    const savedSignature = localStorage.getItem('userSignature');
    if (savedSignature) {
        document.getElementById('signatureDisplay').textContent = savedSignature;
    } else {
        // 如果没有保存的个性签名，使用默认值
        document.getElementById('signatureDisplay').textContent = '暂无个性签名';
    }
    
    // 加载用户状态
    const userStatus = localStorage.getItem('userStatus');
    if (userStatus) {
        document.getElementById('userStatus').textContent = userStatus;
    }
}

// 加载用户头像
function loadUserAvatar() {
    const savedAvatar = localStorage.getItem('userAvatar');
    if (savedAvatar) {
        document.getElementById('sidebarUserAvatar').src = savedAvatar;
    }
}

// 处理头像上传
function handleAvatarUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    if (!file.type.startsWith('image/')) {
        parent.postMessage({type: 'showToast', message: '请选择有效的图片文件'}, '*');
        return;
    }
    
    if (file.size > 5 * 1024 * 1024) {
        parent.postMessage({type: 'showToast', message: '图片大小不能超过5MB'}, '*');
        return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
        const avatarData = e.target.result;
        document.getElementById('sidebarUserAvatar').src = avatarData;
        
        // 只更新头像数据，不删除其他缓存
        localStorage.setItem('userAvatar', avatarData);
        
        // 通知父页面更新头像
        parent.postMessage({type: 'updateAvatar', avatar: avatarData}, '*');
        parent.postMessage({type: 'showToast', message: '头像更换成功!'}, '*');
    };
    reader.readAsDataURL(file);
    event.target.value = "";
}

// 编辑用户名
function editUsername() {
    const display = document.getElementById('usernameDisplay');
    const input = document.getElementById('usernameInput');
    const actions = document.getElementById('usernameActions');
    
    input.value = display.textContent;
    display.style.display = 'none';
    input.style.display = 'block';
    actions.style.display = 'flex';
    input.focus();
    input.select();
}

// 保存用户名
function saveUsername() {
    const input = document.getElementById('usernameInput');
    const display = document.getElementById('usernameDisplay');
    const actions = document.getElementById('usernameActions');
    
    const username = input.value.trim();
    if (username === "") {
        parent.postMessage({type: 'showToast', message: '用户名不能为空'}, '*');
        return;
    }
    
    display.textContent = username;
    
    // 只更新用户名数据，不删除其他缓存
    localStorage.setItem('username', username);
    
    display.style.display = 'inline-block';
    input.style.display = 'none';
    actions.style.display = 'none';
    
    parent.postMessage({type: 'showToast', message: '用户名已更新'}, '*');
}

// 取消编辑用户名
function cancelEditUsername() {
    const display = document.getElementById('usernameDisplay');
    const input = document.getElementById('usernameInput');
    const actions = document.getElementById('usernameActions');
    
    display.style.display = 'inline-block';
    input.style.display = 'none';
    actions.style.display = 'none';
}

// 编辑个性签名
function editSignature() {
    const display = document.getElementById('signatureDisplay');
    const input = document.getElementById('signatureInput');
    const actions = document.getElementById('signatureActions');
    
    // 如果当前是默认值，则清空输入框
    input.value = display.textContent === "暂无个性签名" ? "" : display.textContent;
    display.style.display = 'none';
    input.style.display = 'block';
    actions.style.display = 'flex';
    input.focus();
}

// 保存个性签名
function saveSignature() {
    const input = document.getElementById('signatureInput');
    const display = document.getElementById('signatureDisplay');
    const actions = document.getElementById('signatureActions');
    
    const signature = input.value.trim();
    if (signature === "") {
        parent.postMessage({type: 'showToast', message: '个性签名不能为空'}, '*');
        return;
    }
    
    display.textContent = signature;
    
    // 只更新个性签名数据，不删除其他缓存
    localStorage.setItem('userSignature', signature);
    
    display.style.display = 'block';
    input.style.display = 'none';
    actions.style.display = 'none';
    
    parent.postMessage({type: 'showToast', message: '个性签名已更新'}, '*');
}

// 取消编辑个性签名
function cancelEditSignature() {
    const display = document.getElementById('signatureDisplay');
    const input = document.getElementById('signatureInput');
    const actions = document.getElementById('signatureActions');
    
    display.style.display = 'block';
    input.style.display = 'none';
    actions.style.display = 'none';
}

// 关闭侧边栏
function closeSidebar() {
    parent.postMessage({type: 'closeSidebar'}, '*');
}

// 更换背景
function changeBackground() {
    parent.postMessage({type: 'changeBackground'}, '*');
}

// 页面加载时初始化
window.addEventListener('load', function() {
    loadUserAvatar();
    loadUserData();
});
</script>
</body>
</html>
