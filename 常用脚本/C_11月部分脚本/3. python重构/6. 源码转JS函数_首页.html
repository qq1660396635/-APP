<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è„šæœ¬åº“æŸ¥çœ‹å™¨</title>
    <script src="scripts_library.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI',
            Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2
            100%);
            min-height: 100vh; padding: 15px;
        }
        .container {
            max-width: 1200px; margin: 0 auto;
        }
        /* æœç´¢æ¡†*/
        .search-container {
            background: rgba(255,255,255,0.95); border-radius: 15px; padding: 20px; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); backdrop-filter: blur(10px);
        }
        .search-box {
            position: relative; max-width: 500px; margin: 0 auto;
        }
        .search-input {
            width: 100%; padding: 15px 50px 15px 20px; border: 2px solid #e0e0e0; border-radius: 50px; font-size: 16px; transition: all 0.3s ease; background: white;
        }
        .search-input:focus {
            outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .search-icon {
            position: absolute; right: 20px; top: 50%; transform: translateY(-50%); color: #999; pointer-events: none;
        }
        /* ã€å¸ƒå±€ä¿®æ”¹ç‚¹ 1ã€‘ä¸€è¡Œä¸€ä¸ªå¡ç‰‡ */
        .cards-container {
            display: flex;
            flex-direction: column;
            gap: 20px; margin-bottom: 30px;
        }
        .link-card {
            background: rgba(255,255,255,0.95); border-radius: 15px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.1); backdrop-filter: blur(10px); transition: all 0.3s ease; position: relative;
        }
        .link-card::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #667eea, #764ba2); transform: scaleX(0); transition: transform 0.3s ease;
        }
        .link-card:hover {
            transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0,0,0,0.2);
        }
        .link-card:hover::before {
            transform: scaleX(1);
        }
        .link-card h3 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2
            100%);
            color: white; padding: 15px; margin: 0; font-size: 1.1em; font-weight: 600;
        }
        .link-card:nth-child(even) h3 { /* ä¿®æ”¹é€‰æ‹©å™¨ï¼Œå› ä¸ºç°åœ¨å¡ç‰‡æ˜¯å‚ç›´æ’åˆ—çš„ */
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        /* å¡ç‰‡å†…å®¹*/
        .card-content {
            padding: 15px; max-height: 400px; overflow-y: auto;
        }
        /* ã€å¸ƒå±€ä¿®æ”¹ç‚¹ 2ã€‘å¡ç‰‡å†…å®¹ä¸€è¡Œä¸¤ä¸ª */
.script-list {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
}
       .script-item {
            display: flex; align-items: center; padding: 10px; background: rgba(255,255,255,0.8); border-radius: 10px; transition: all 0.3s ease; cursor: pointer; border-left: 3px solid #667eea;
        }
        .link-card:nth-child(even) .script-item {
            border-left-color: #f5576c;
        }
        .script-item:hover {
            background: rgba(255,255,255,1); transform: translateX(5px); box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        .script-number {
            background: linear-gradient(135deg, #667eea, #764ba2); color: white; width: 26px; height: 26px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; margin-right: 10px; flex-shrink: 0;
        }
        .link-card:nth-child(even) .script-number {
            background: linear-gradient(135deg, #f093fb, #f5576c);
        }
        .script-info {
            flex: 1; display: flex; flex-direction: column; min-width: 0;
        }
        .script-name {
            color: #333; font-size: 0.9em; font-weight: 500; /* å…è®¸æ¢è¡Œä»¥é€‚åº”æ›´çª„çš„åˆ— */
            white-space: normal;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        .script-meta {
            display: flex; justify-content: space-between; align-items: center; margin-top: 3px;
        }
        .script-type {
            padding: 2px 6px; border-radius: 10px; font-size: 0.7em; font-weight: bold; text-transform: uppercase; color: white;
        }
        .bash { background: #27ae60; } .python { background: #3498db; }
        .script-size {
            font-size: 0.7em; color: #666;
        }
        /* åˆ†é¡µ*/
        .pagination {
            display: flex; justify-content: center;
            align-items: center; gap: 10px; margin-top: 40px; flex-wrap: wrap;
        }
        .pagination button {
            padding: 10px 15px; border: none; background: rgba(255,255,255,0.9); color: #667eea; border-radius: 10px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; min-width: 40px;
        }
        .pagination button:hover:not(:disabled) {
            background: white; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .pagination button.active {
            background: linear-gradient(135deg, #667eea, #764ba2); color: white;
        }
        .pagination button:disabled {
            opacity: 0.5; cursor: not-allowed;
        }
        .page-info {
            color: white; font-weight: 600; padding: 0 15px;
        }
        .no-results {
            text-align: center; color: white; padding: 40px;
            font-size: 18px;
        }
        /* è„šæœ¬æŸ¥çœ‹å™¨å¼¹çª—*/
        .script-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; justify-content: center; align-items: center;
        }
        .script-content {
            background: white; border-radius: 15px; padding: 25px; max-width: 90%; max-height: 80%; width: 800px; overflow: hidden; display: flex; flex-direction: column;
        }
        .script-header {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #eee;
        }
        .script-title {
            font-size: 1.2em; color: #333; font-weight: bold; display: flex; align-items: center;
            gap: 10px;
        }
        .script-index {
            background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 3px 10px; border-radius: 15px; font-size: 0.8em;
        }
        .script-close {
            background: #f44336; color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-size: 14px; transition: all 0.3s ease;
        }
        .script-close:hover {
            background: #d32f2f;
        }
        .script-body {
            background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 8px; font-family: 'Consolas', 'Monaco', 'Courier New', monospace; font-size: 14px; line-height: 1.5; overflow: auto; white-space: pre-wrap; flex: 1;
        }
        .script-actions {
            display: flex; gap: 10px; margin-top: 15px;
        }
        .script-btn {
            padding: 8px 16px; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.3s ease; display: flex; align-items: center; gap: 5px;
        }
        .copy-btn {
            background: #2196F3; color: white;
        }
        .download-btn {
            background: #4CAF50; color: white;
        }
        .script-btn:hover {
            transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        /* å“åº”å¼*/
@media (max-width: 768px) {
    .script-list {
        grid-template-columns: repeat(2, 1fr); /* æ‰‹æœºä¹ŸåŒåˆ— */
    }
}
    </style>
</head>
<body>
<div class="container">
    <!-- æœç´¢æ¡†-->
    <div class="search-container">
        <div class="search-box">
            <input type="text" class="search-input" id="searchInput"
                   placeholder="æœç´¢è„šæœ¬åç§°...">
            <span class="search-icon">ğŸ”</span>
        </div>
    </div>
    <!-- å¡ç‰‡å®¹å™¨-->
    <div class="cards-container" id="content">
        <div class="no-results">æ­£åœ¨åŠ è½½è„šæœ¬åº“...</div>
    </div>
    <!-- åˆ†é¡µ-->
    <div class="pagination" id="pagination"></div>
</div>
<!-- è„šæœ¬æŸ¥çœ‹å™¨å¼¹çª—-->
<div class="script-modal" id="scriptModal">
    <div class="script-content">
        <div class="script-header">
            <div class="script-title">
                <span class="script-index" id="scriptIndex">1</span>
                <span id="scriptName">è„šæœ¬åç§°</span>
            </div>
            <button class="script-close" onclick="closeScriptModal()">âœ•
                å…³é—­</button>
        </div>
        <div class="script-body" id="scriptBody">
            è„šæœ¬å†…å®¹
        </div>
        <div class="script-actions">
            <button class="script-btn copy-btn"
                    onclick="copyScriptContent()">ğŸ“‹å¤åˆ¶å†…å®¹
            </button>
            <button class="script-btn download-btn"
                    onclick="downloadScript()">ğŸ’¾ä¸‹è½½æ–‡ä»¶
            </button>
        </div>
    </div>
</div>
<script>
    // ===== å…¨å±€å˜é‡ (å·²ä¿®æ”¹) =====
    let allScripts = [];
    let allScriptsFlat = []; // æ‰å¹³åŒ–çš„è„šæœ¬åˆ—è¡¨
    let filteredScripts = []; // ç”¨äºæœç´¢å’Œåˆ†é¡µçš„åˆ—è¡¨
    let currentPage = 1;
    const scriptsPerPage = 15; // ã€åˆ†é¡µä¿®æ”¹ç‚¹ã€‘æ¯é¡µ15ä¸ªè„šæœ¬
    let totalPages = 1;

    // ===== åˆå§‹åŒ–=====
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(() => {
            loadScripts();
        }, 100);
    });

    // ===== åŠ è½½è„šæœ¬æ•°æ®=====
    function loadScripts() {
        if (typeof scriptCount === 'undefined') {
            document.getElementById('content').innerHTML = '<div class="no-results">è„šæœ¬åº“æœªæ­£ç¡®åŠ è½½</div>';
            return;
        }
        allScripts = [];
        for (let i = 0; i < scriptCount; i++) {
            const firstChar = String.fromCharCode(97 + Math.floor(i / 26));
            const secondChar = String.fromCharCode(97 + (i % 26));
            const varName = firstChar + secondChar;
            if (window[varName]) {
                allScripts.push({
                    name: varName,
                    data: window[varName]
                });
            }
        }
        if (allScripts.length === 0) {
            document.getElementById('content').innerHTML = '<div class="no-results">æœªæ‰¾åˆ°ä»»ä½•è„šæœ¬æ–‡ä»¶</div>';
            return;
        }

        // ã€é€»è¾‘ä¿®æ”¹ç‚¹ã€‘å…ˆåˆ†ç»„ï¼Œå†æ‰å¹³åŒ–
        groupScriptsByDirectory();
        flattenScripts();

        filteredScripts = [...allScriptsFlat];
        renderPage();
        renderPagination();

        document.getElementById('searchInput').addEventListener('input', handleSearch);
    }

    // ===== æŒ‰ç›®å½•åˆ†ç»„è„šæœ¬ (ä¿ç•™ï¼Œç”¨äºæ‰å¹³åŒ–) =====
    function groupScriptsByDirectory() {
        const dirMap = new Map();
        allScripts.forEach(script => {
            const filename = script.data.filename;
            const dirMatch = filename.match(/^(.+?)\/[^\/]+$/);
            const dirName = dirMatch ? dirMatch[1] : 'æ ¹ç›®å½•';
            if (!dirMap.has(dirName)) {
                dirMap.set(dirName, {
                    name: dirName,
                    scripts: []
                });
            }
            dirMap.get(dirName).scripts.push(script);
        });
        // è¿™ä¸ªå‡½æ•°ç°åœ¨åªä¸ºäº†åœ¨windowä¸Šåˆ›å»ºallDirectoriesï¼Œä¾›flattenScriptsä½¿ç”¨
        window.allDirectories = Array.from(dirMap.values()).sort((a, b) => {
            const aIsNum = /^\d/.test(a.name);
            const bIsNum = /^\d/.test(b.name);
            if (aIsNum && !bIsNum) return -1;
            if (!aIsNum && bIsNum) return 1;
            return a.name.localeCompare(b.name);
        });
    }

    // ===== ã€æ–°å¢å‡½æ•°ã€‘æ‰å¹³åŒ–è„šæœ¬åˆ—è¡¨ =====
    function flattenScripts() {
        allScriptsFlat = [];
        const allDirectories = window.allDirectories || [];
        allDirectories.forEach(dir => {
            dir.scripts.forEach(script => {
                allScriptsFlat.push({
                    ...script.data,
                    varName: script.name, // ä¿ç•™åŸå§‹å˜é‡åç”¨äºshowScript
                    dirName: dir.name
                });
            });
        });
        // å¯¹æ‰å¹³åŒ–åˆ—è¡¨è¿›è¡Œæ’åºï¼Œæ–¹ä¾¿åˆ†é¡µ
        allScriptsFlat.sort((a, b) => {
            const dirCompare = a.dirName.localeCompare(b.dirName);
            if (dirCompare !== 0) return dirCompare;
            return a.filename.localeCompare(b.filename);
        });
    }

    // ===== ã€é€»è¾‘ä¿®æ”¹ç‚¹ã€‘æœç´¢å¤„ç†=====
    function handleSearch(e) {
        const searchTerm = e.target.value.toLowerCase().trim();
        if (searchTerm === '') {
            filteredScripts = [...allScriptsFlat];
        } else {
            filteredScripts = allScriptsFlat.filter(script =>
                script.filename.toLowerCase().includes(searchTerm) ||
                script.content.toLowerCase().includes(searchTerm) ||
                script.dirName.toLowerCase().includes(searchTerm)
            );
        }
        currentPage = 1;
        renderPage();
        renderPagination();
    }

    // ===== ã€é€»è¾‘ä¿®æ”¹ç‚¹ã€‘æ¸²æŸ“é¡µé¢=====
    function renderPage() {
        const startIndex = (currentPage - 1) * scriptsPerPage;
        const endIndex = startIndex + scriptsPerPage;
        const pageScripts = filteredScripts.slice(startIndex, endIndex);

        if (pageScripts.length === 0) {
            document.getElementById('content').innerHTML = '<div class="no-results">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„è„šæœ¬</div>';
            return;
        }

        // å°†å½“å‰é¡µçš„è„šæœ¬ä¸´æ—¶æŒ‰ç›®å½•åˆ†ç»„ï¼Œç”¨äºæ¸²æŸ“
        const scriptsByDir = new Map();
        pageScripts.forEach(script => {
            if (!scriptsByDir.has(script.dirName)) {
                scriptsByDir.set(script.dirName, []);
            }
            scriptsByDir.get(script.dirName).push(script);
        });

        let html = '';
        let dirCardIndex = 0;
        scriptsByDir.forEach((scripts, dirName) => {
            dirCardIndex++;
            html += `
                <div class="link-card">
                    <h3>${dirName}</h3>
                    <div class="card-content">
                        <div class="script-list">
            `;
            scripts.forEach((script, localIndex) => {
                const globalIndex = startIndex + localIndex + 1; // ã€ç¼–å·ä¿®æ”¹ç‚¹ã€‘è®¡ç®—å…¨å±€åºå·
                const fileName = script.filename.split('/').pop();
                const sizeKB = Math.round(script.content.length / 1024);
                html += `
                    <div class="script-item" onclick="showScript('${script.varName}')">
                        <span class="script-number">${globalIndex}</span>
                        <div class="script-info">
                            <div class="script-name">${fileName}</div>
                            <div class="script-meta">
                                <span class="script-type ${script.type}">${script.type}</span>
                                <span class="script-size">${sizeKB}KB</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            html += `
                        </div>
                    </div>
                </div>
            `;
        });

        document.getElementById('content').innerHTML = html;
    }

    // ===== ã€é€»è¾‘ä¿®æ”¹ç‚¹ã€‘æ¸²æŸ“åˆ†é¡µ=====
    function renderPagination() {
        const pagination = document.getElementById('pagination');
        totalPages = Math.ceil(filteredScripts.length / scriptsPerPage);

        if (totalPages <= 1) {
            pagination.innerHTML = '';
            return;
        }

        let paginationHTML = '';
        paginationHTML += `<button onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>ä¸Šä¸€é¡µ</button>`;

        for (let i = 1; i <= totalPages; i++) {
            if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                paginationHTML += `<button onclick="changePage(${i})" class="${i === currentPage ? 'active' : ''}">${i}</button>`;
            } else if (i === currentPage - 3 || i === currentPage + 3) {
                paginationHTML += `<span style="color: white;">...</span>`;
            }
        }

        paginationHTML += `<button onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>ä¸‹ä¸€é¡µ</button>`;
        paginationHTML += `<span class="page-info">ç¬¬ ${currentPage} / ${totalPages} é¡µ</span>`;

        pagination.innerHTML = paginationHTML;
    }

    // ===== åˆ‡æ¢é¡µé¢=====
    function changePage(page) {
        if (page >= 1 && page <= totalPages) {
            currentPage = page;
            renderPage();
            renderPagination();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    }

    // ===== æ˜¾ç¤ºè„šæœ¬å†…å®¹ (æ— éœ€ä¿®æ”¹) =====
    function showScript(varName) {
        const script = allScripts.find(s => s.name === varName);
        if (!script) return;
        document.getElementById('scriptIndex').textContent = script.data.index;
        document.getElementById('scriptName').textContent = script.data.filename;
        document.getElementById('scriptBody').textContent = script.data.content;
        document.getElementById('scriptModal').style.display = 'flex';
        event.stopPropagation();
    }

    // ===== å…³é—­è„šæœ¬å¼¹çª—=====
    function closeScriptModal() {
        document.getElementById('scriptModal').style.display = 'none';
    }

    // ===== å¤åˆ¶è„šæœ¬å†…å®¹=====
    function copyScriptContent() {
        const content = document.getElementById('scriptBody').textContent;
        navigator.clipboard.writeText(content).then(() => {
            showToast('å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
        }).catch(() => {
            const textArea = document.createElement('textarea');
            textArea.value = content;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            showToast('å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
        });
    }

    // ===== ä¸‹è½½è„šæœ¬=====
    function downloadScript() {
        const content = document.getElementById('scriptBody').textContent;
        const filename = document.getElementById('scriptName').textContent;
        const blob = new Blob([content], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        showToast(`å·²ä¸‹è½½: ${filename}`);
    }

    // ===== æ˜¾ç¤ºæç¤ºæ¶ˆæ¯=====
    function showToast(message) {
        const toast = document.createElement('div');
        toast.style.cssText = `
            position: fixed; bottom: 30px; right: 30px; background: #4CAF50; color: white; padding: 15px 25px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); z-index: 10000; animation: slideIn 0.3s ease;
        `;
        toast.textContent = message;
        document.body.appendChild(toast);
        setTimeout(() => {
            toast.style.animation = 'slideOut 0.3s ease';
            setTimeout(() => document.body.removeChild(toast), 300);
        }, 3000);
    }

    // ===== æ·»åŠ åŠ¨ç”»æ ·å¼=====
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes slideOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }
    `;
    document.head.appendChild(style);

    // ===== ESC é”®å…³é—­å¼¹çª—=====
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeScriptModal();
        }
    });
    document.getElementById('scriptModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeScriptModal();
        }
    });
</script>
</body>
</html>
