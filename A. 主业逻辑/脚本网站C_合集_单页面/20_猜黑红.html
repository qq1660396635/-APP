<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŒœé»‘çº¢æ‰‘å…‹ç‰Œæ¸¸æˆ</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            color: #fff;
            min-height: 100vh;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            touch-action: manipulation;
            transition: background 0.5s ease;
        }
        
        .container {
            width: 100%;
            max-width: 900px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        header {
            text-align: center;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            color: #ffd700;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .player-info, .ai-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .card-count {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .player-area, .ai-area {
            display: flex;
            flex-direction: column;
            gap: 10px;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .area-title {
            text-align: center;
            font-size: 1.2rem;
            color: #ffd700;
            margin-bottom: 5px;
        }
        
        .hand-cards {
            display: flex;
            flex-wrap: nowrap;
            overflow-x: auto;
            gap: 2px;
            justify-content: flex-start;
            min-height: 90px;
            padding: 5px;
            -webkit-overflow-scrolling: touch;
        }
        
        .card {
            width: 60px;
            height: 85px;
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 5px;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            z-index: 1;
            pointer-events: none;
        }
        
        .card.red {
            background: linear-gradient(135deg, #f8f8f8, #e0e0e0);
            color: #d40000;
            border: 2px solid #d40000;
        }
        
        .card.black {
            background: linear-gradient(135deg, #f8f8f8, #e0e0e0);
            color: #000;
            border: 2px solid #000;
        }
        
        .card.back {
            background: linear-gradient(135deg, #1a3a5f, #2a5a8f);
            color: white;
            border: 2px solid #ffd700;
        }
        
        .card.selected {
            transform: translateY(-10px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5);
            border: 2px solid #ffd700;
        }
        
        .card-value {
            font-size: 1rem;
            z-index: 2;
        }
        
        .card-suit {
            font-size: 1.4rem;
            align-self: center;
            z-index: 2;
        }
        
        .card-corner {
            font-size: 0.7rem;
            z-index: 2;
        }
        
        .game-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .betting-area {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 5px 0;
        }
        
        .bet-cards {
            display: flex;
            gap: 5px;
            min-height: 90px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            min-width: 120px;
        }
        
        .primary-btn {
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
            color: white;
        }
        
        .secondary-btn {
            background: linear-gradient(135deg, #4ecdc4, #6ae6dd);
            color: white;
        }
        
        .choice-btn {
            background: linear-gradient(135deg, #ffd166, #ffdc87);
            color: #333;
            padding: 12px 20px;
            font-size: 0.9rem;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .message {
            padding: 10px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            text-align: center;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            margin: 5px 0;
            width: 100%;
        }
        
        .zoom-controls {
            position: fixed;
            bottom: 15px;
            right: 15px;
            display: flex;
            gap: 8px;
            flex-direction: column;
            align-items: center;
        }
        
        .zoom-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border: 2px solid #ffd700;
        }
        
        .theme-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border: 2px solid #ffd700;
            margin-top: 10px;
        }
        
        @media (max-width: 480px) {
            .container {
                gap: 10px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .card {
                width: 50px;
                height: 70px;
            }
            
            .card-suit {
                font-size: 1.2rem;
            }
            
            .card-value {
                font-size: 0.9rem;
            }
            
            button {
                padding: 8px 15px;
                font-size: 0.8rem;
                min-width: 100px;
            }
            
            .choice-btn {
                padding: 10px 15px;
                font-size: 0.8rem;
            }
            
            .hand-cards {
                min-height: 75px;
            }
        }
        
        .current-turn {
            border: 2px solid #ffd700;
            box-shadow: 0 0 10px #ffd700;
        }
        
        .selection-count {
            margin-top: 5px;
            font-size: 0.9rem;
            color: #ffd700;
        }
        
        .result-message {
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid #ffd700;
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>çŒœé»‘çº¢æ‰‘å…‹ç‰Œæ¸¸æˆ</h1>
            <p>é€‰æ‹©é»‘è‰²å¤šã€çº¢è‰²å¤šè¿˜æ˜¯ä¸€æ ·å¤šï¼ŒçŒœå¯¹èµ¢å¾—æ‰€æœ‰ç‰Œï¼ŒçŒœé”™åˆ™è¾“æ‰ç‰Œï¼</p>
        </header>
        
        <div class="game-info">
            <div class="player-info">
                <h2>ç©å®¶</h2>
                <div class="card-count">æ‰‹ç‰Œ: <span id="player-count">26</span>å¼ </div>
            </div>
            <div class="ai-info">
                <h2>AIå¯¹æ‰‹</h2>
                <div class="card-count">æ‰‹ç‰Œ: <span id="ai-count">26</span>å¼ </div>
            </div>
        </div>
        
        <div class="ai-area">
            <div class="area-title">AIçš„æ‰‹ç‰Œ</div>
            <div class="hand-cards" id="ai-cards">
                <!-- AIçš„ç‰Œå°†ç”±JSç”Ÿæˆ -->
            </div>
        </div>
        
        <div class="game-area">
            <div class="area-title">å‡ºç‰ŒåŒº</div>
            <div class="betting-area">
                <div class="bet-cards" id="bet-cards">
                    <!-- å‡ºç‰ŒåŒºçš„ç‰Œå°†ç”±JSç”Ÿæˆ -->
                </div>
            </div>
            
            <div class="message" id="game-message">
                æ¸¸æˆå‡†å¤‡å¼€å§‹ï¼Œè¯·ç‚¹å‡»"å¼€å§‹æ¸¸æˆ"æŒ‰é’®
            </div>
            
            <div class="controls">
                <button id="start-btn" class="primary-btn">å¼€å§‹æ¸¸æˆ</button>
                <button id="restart-btn" class="secondary-btn">é‡æ–°å¼€å§‹</button>
                <button id="play-cards-btn" class="primary-btn" disabled>å‡ºç‰Œ</button>
                <button id="guess-black-btn" class="choice-btn" disabled>çŒœé»‘è‰²å¤š</button>
                <button id="guess-red-btn" class="choice-btn" disabled>çŒœçº¢è‰²å¤š</button>
                <button id="guess-equal-btn" class="choice-btn" disabled>çŒœä¸€æ ·å¤š</button>
            </div>
        </div>
        
        <div class="player-area">
            <div class="area-title">ä½ çš„æ‰‹ç‰Œ</div>
            <div class="hand-cards" id="player-cards">
                <!-- ç©å®¶çš„ç‰Œå°†ç”±JSç”Ÿæˆ -->
            </div>
            <div class="selection-count" id="selection-count">å·²é€‰æ‹© 0 å¼ ç‰Œ (æœ€å¤š7å¼ )</div>
        </div>
    </div>
    
    <div class="zoom-controls">
        <button class="zoom-btn" id="zoom-in">+</button>
        <button class="zoom-btn" id="zoom-out">-</button>
        <button class="zoom-btn" id="reset-zoom">100%</button>
        <button class="theme-btn" id="change-theme">ğŸ¨</button>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        const gameState = {
            playerCards: [],
            aiCards: [],
            betCards: [],
            currentPlayer: 'player', // 'player' æˆ– 'ai'
            gameStarted: false,
            maxBetCards: 7,
            currentBetCount: 0,
            playerSelectedCards: [],
            aiErrorRate: 0.2, // AIæœ‰20%çš„æ¦‚ç‡çŒœé”™
            betCardsRevealed: false // å‡ºç‰ŒåŒºçš„ç‰Œæ˜¯å¦å·²æ­æ™“
        };
        
        // æ‰‘å…‹ç‰ŒèŠ±è‰²å’Œç‚¹æ•°
        const suits = ['â™ ', 'â™¥', 'â™¦', 'â™£'];
        const values = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
        
        // é¢„å®šä¹‰çš„èƒŒæ™¯é¢œè‰²æ•°ç»„
        const backgroundThemes = [
            'linear-gradient(135deg, #1a2a3a, #2d4a5c)',
            'linear-gradient(135deg, #2d1a3a, #5c2d4a)',
            'linear-gradient(135deg, #3a2a1a, #5c4a2d)',
            'linear-gradient(135deg, #1a3a2a, #2d5c4a)',
            'linear-gradient(135deg, #3a1a2a, #5c2d4a)',
            'linear-gradient(135deg, #2a1a3a, #4a2d5c)',
            'linear-gradient(135deg, #1a3a3a, #2d5c5c)',
            'linear-gradient(135deg, #3a3a1a, #5c5c2d)',
            'linear-gradient(135deg, #3a1a1a, #5c2d2d)',
            'linear-gradient(135deg, #1a1a3a, #2d2d5c)',
            'linear-gradient(135deg, #3a2a3a, #5c4a5c)',
            'linear-gradient(135deg, #2a3a1a, #4a5c2d)',
            'linear-gradient(135deg, #1a2a2a, #2d4a4a)',
            'linear-gradient(135deg, #2a1a1a, #4a2d2d)',
            'linear-gradient(135deg, #1a1a1a, #2d2d2d)'
        ];
        
        // DOMå…ƒç´ 
        const playerCardsEl = document.getElementById('player-cards');
        const aiCardsEl = document.getElementById('ai-cards');
        const betCardsEl = document.getElementById('bet-cards');
        const playerCountEl = document.getElementById('player-count');
        const aiCountEl = document.getElementById('ai-count');
        const gameMessageEl = document.getElementById('game-message');
        const selectionCountEl = document.getElementById('selection-count');
        
        // æŒ‰é’®
        const startBtn = document.getElementById('start-btn');
        const restartBtn = document.getElementById('restart-btn');
        const playCardsBtn = document.getElementById('play-cards-btn');
        const guessBlackBtn = document.getElementById('guess-black-btn');
        const guessRedBtn = document.getElementById('guess-red-btn');
        const guessEqualBtn = document.getElementById('guess-equal-btn');
        const zoomInBtn = document.getElementById('zoom-in');
        const zoomOutBtn = document.getElementById('zoom-out');
        const resetZoomBtn = document.getElementById('reset-zoom');
        const changeThemeBtn = document.getElementById('change-theme');
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            gameState.gameStarted = false;
            gameState.playerCards = [];
            gameState.aiCards = [];
            gameState.betCards = [];
            gameState.currentPlayer = 'player';
            gameState.currentBetCount = 0;
            gameState.playerSelectedCards = [];
            gameState.betCardsRevealed = false;
            
            // åˆ›å»ºä¸€å‰¯æ‰‘å…‹ç‰Œ
            const deck = [];
            for (let suit of suits) {
                for (let value of values) {
                    const isRed = suit === 'â™¥' || suit === 'â™¦';
                    deck.push({
                        suit: suit,
                        value: value,
                        isRed: isRed,
                        color: isRed ? 'red' : 'black',
                        id: `${suit}-${value}` // æ·»åŠ å”¯ä¸€æ ‡è¯†ç¬¦
                    });
                }
            }
            
            // æ´—ç‰Œ
            shuffleDeck(deck);
            
            // å‘ç‰Œç»™ç©å®¶å’ŒAI
            for (let i = 0; i < deck.length; i++) {
                if (i % 2 === 0) {
                    gameState.playerCards.push(deck[i]);
                } else {
                    gameState.aiCards.push(deck[i]);
                }
            }
            
            // æ›´æ–°UI
            updateUI();
            
            // æ›´æ–°æ¶ˆæ¯
            gameMessageEl.textContent = "æ¸¸æˆå·²å‡†å¤‡ï¼Œè¯·ç‚¹å‡»'å¼€å§‹æ¸¸æˆ'æŒ‰é’®";
            
            // å¯ç”¨/ç¦ç”¨æŒ‰é’®
            startBtn.disabled = false;
            playCardsBtn.disabled = true;
            guessBlackBtn.disabled = true;
            guessRedBtn.disabled = true;
            guessEqualBtn.disabled = true;
            
            // æ›´æ–°é€‰æ‹©è®¡æ•°
            updateSelectionCount();
        }
        
        // æ´—ç‰Œå‡½æ•°
        function shuffleDeck(deck) {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }
        
        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            if (gameState.gameStarted) return;
            
            gameState.gameStarted = true;
            gameState.currentPlayer = 'player';
            gameMessageEl.textContent = "ä½ çš„å›åˆï¼šè¯·é€‰æ‹©1-7å¼ ç‰Œå‡ºç‰Œ";
            
            // å¯ç”¨/ç¦ç”¨æŒ‰é’®
            startBtn.disabled = true;
            playCardsBtn.disabled = false;
            guessBlackBtn.disabled = true;
            guessRedBtn.disabled = true;
            guessEqualBtn.disabled = true;
            
            updateUI();
        }
        
        // æ›´æ–°UI
        function updateUI() {
            // æ›´æ–°ç©å®¶æ‰‹ç‰Œ
            playerCardsEl.innerHTML = '';
            gameState.playerCards.forEach((card, index) => {
                const cardEl = createCardElement(card, index, 'player');
                playerCardsEl.appendChild(cardEl);
            });
            
            // æ›´æ–°AIæ‰‹ç‰Œï¼ˆèƒŒé¢æ˜¾ç¤ºï¼‰
            aiCardsEl.innerHTML = '';
            gameState.aiCards.forEach((card, index) => {
                const cardEl = createCardElement(card, index, 'ai');
                aiCardsEl.appendChild(cardEl);
            });
            
            // æ›´æ–°å‡ºç‰ŒåŒº
            betCardsEl.innerHTML = '';
            gameState.betCards.forEach((card, index) => {
                const cardEl = createCardElement(card, index, 'bet');
                betCardsEl.appendChild(cardEl);
            });
            
            // æ›´æ–°ç‰Œæ•°
            playerCountEl.textContent = gameState.playerCards.length;
            aiCountEl.textContent = gameState.aiCards.length;
            
            // é«˜äº®å½“å‰å›åˆçš„ç©å®¶åŒºåŸŸ
            document.querySelector('.player-area').classList.toggle('current-turn', gameState.currentPlayer === 'player');
            document.querySelector('.ai-area').classList.toggle('current-turn', gameState.currentPlayer === 'ai');
            
            // æ›´æ–°é€‰æ‹©è®¡æ•°
            updateSelectionCount();
        }
        
        // åˆ›å»ºå¡ç‰Œå…ƒç´ 
        function createCardElement(card, index, owner) {
            const cardEl = document.createElement('div');
            
            // å†³å®šå¡ç‰Œæ˜¾ç¤ºæ–¹å¼
            let displayType = 'front';
            if (owner === 'ai') {
                // AIçš„æ‰‹ç‰Œå§‹ç»ˆæ˜¾ç¤ºèƒŒé¢
                displayType = 'back';
            } else if (owner === 'bet') {
                // å‡ºç‰ŒåŒºçš„ç‰Œï¼šå¦‚æœå·²æ­æ™“åˆ™æ˜¾ç¤ºæ­£é¢ï¼Œå¦åˆ™æ˜¾ç¤ºèƒŒé¢
                displayType = gameState.betCardsRevealed ? 'front' : 'back';
            }
            
            cardEl.className = `card ${displayType === 'back' ? 'back' : card.color}`;
            cardEl.dataset.id = card.id; // æ·»åŠ æ•°æ®æ ‡è¯†
            
            if (displayType === 'back') {
                // æ˜¾ç¤ºèƒŒé¢
                cardEl.innerHTML = `
                    <div class="card-corner"></div>
                    <div class="card-suit"></div>
                    <div class="card-value"></div>
                `;
            } else {
                // æ˜¾ç¤ºæ­£é¢
                cardEl.innerHTML = `
                    <div class="card-corner">${card.value}${card.suit}</div>
                    <div class="card-suit">${card.suit}</div>
                    <div class="card-value">${card.value}${card.suit}</div>
                `;
            }
            
            // å¦‚æœæ˜¯ç©å®¶çš„ç‰Œï¼Œæ·»åŠ ç‚¹å‡»äº‹ä»¶
            if (owner === 'player' && gameState.currentPlayer === 'player' && gameState.gameStarted) {
                cardEl.addEventListener('click', () => selectCard(card.id));
            }
            
            // å¦‚æœç‰Œè¢«é€‰ä¸­ï¼Œæ·»åŠ é€‰ä¸­æ ·å¼
            if (gameState.playerSelectedCards.includes(card.id)) {
                cardEl.classList.add('selected');
            }
            
            return cardEl;
        }
        
        // æ›´æ–°é€‰æ‹©è®¡æ•°æ˜¾ç¤º
        function updateSelectionCount() {
            const count = gameState.playerSelectedCards.length;
            const max = Math.min(gameState.maxBetCards, gameState.playerCards.length);
            selectionCountEl.textContent = `å·²é€‰æ‹© ${count} å¼ ç‰Œ (æœ€å¤š${max}å¼ )`;
        }
        
        // é€‰æ‹©å¡ç‰Œ
        function selectCard(cardId) {
            if (gameState.currentPlayer !== 'player' || !gameState.gameStarted) return;
            
            const maxSelect = Math.min(gameState.maxBetCards, gameState.playerCards.length);
            
            if (gameState.playerSelectedCards.includes(cardId)) {
                // å–æ¶ˆé€‰æ‹©
                gameState.playerSelectedCards = gameState.playerSelectedCards.filter(id => id !== cardId);
            } else {
                // é€‰æ‹©ç‰Œ
                if (gameState.playerSelectedCards.length < maxSelect) {
                    gameState.playerSelectedCards.push(cardId);
                } else {
                    gameMessageEl.textContent = `æœ€å¤šåªèƒ½é€‰æ‹©${maxSelect}å¼ ç‰Œ`;
                    return;
                }
            }
            
            updateUI();
            
            // æ›´æ–°æ¶ˆæ¯
            if (gameState.playerSelectedCards.length > 0) {
                gameMessageEl.textContent = `å·²é€‰æ‹© ${gameState.playerSelectedCards.length} å¼ ç‰Œï¼Œç‚¹å‡»"å‡ºç‰Œ"æŒ‰é’®ç¡®è®¤`;
            } else {
                gameMessageEl.textContent = "ä½ çš„å›åˆï¼šè¯·é€‰æ‹©1-7å¼ ç‰Œå‡ºç‰Œ";
            }
        }
        
        // ç©å®¶å‡ºç‰Œ
        function playerPlayCards() {
            if (gameState.currentPlayer !== 'player' || !gameState.gameStarted) return;
            
            if (gameState.playerSelectedCards.length === 0) {
                gameMessageEl.textContent = "è¯·è‡³å°‘é€‰æ‹©ä¸€å¼ ç‰Œå‡ºç‰Œ";
                return;
            }
            
            if (gameState.playerSelectedCards.length > gameState.maxBetCards) {
                gameMessageEl.textContent = `æ¯æ¬¡æœ€å¤šåªèƒ½å‡º${gameState.maxBetCards}å¼ ç‰Œ`;
                return;
            }
            
            // å°†é€‰ä¸­çš„ç‰Œç§»åˆ°å‡ºç‰ŒåŒº
            const selectedCards = gameState.playerCards.filter(card => 
                gameState.playerSelectedCards.includes(card.id)
            );
            
            // ä»ç©å®¶æ‰‹ç‰Œä¸­ç§»é™¤é€‰ä¸­çš„ç‰Œ
            gameState.playerCards = gameState.playerCards.filter(card => 
                !gameState.playerSelectedCards.includes(card.id)
            );
            
            // æ·»åŠ åˆ°å‡ºç‰ŒåŒº
            gameState.betCards = selectedCards;
            gameState.currentBetCount = selectedCards.length;
            gameState.playerSelectedCards = [];
            gameState.betCardsRevealed = false; // å‡ºç‰ŒåŒºçš„ç‰Œæœªæ­æ™“
            
            // åˆ‡æ¢åˆ°AIçŒœæµ‹
            gameState.currentPlayer = 'ai';
            gameMessageEl.textContent = "AIæ­£åœ¨æ€è€ƒ...";
            
            // ç¦ç”¨å‡ºç‰ŒæŒ‰é’®
            playCardsBtn.disabled = true;
            
            // æ›´æ–°UI
            updateUI();
            
            // AIåœ¨1.5ç§’ååšå‡ºçŒœæµ‹
            setTimeout(aiGuess, 1500);
        }
        
        // AIçŒœæµ‹
        function aiGuess() {
            if (gameState.currentPlayer !== 'ai' || !gameState.gameStarted) return;
            
            // è®¡ç®—é»‘è‰²å’Œçº¢è‰²ç‰Œçš„æ•°é‡
            let blackCount = 0;
            let redCount = 0;
            
            gameState.betCards.forEach(card => {
                if (card.isRed) {
                    redCount++;
                } else {
                    blackCount++;
                }
            });
            
            // AIæ ¹æ®æ¦‚ç‡åšå‡ºçŒœæµ‹ï¼Œä½†æœ‰20%çš„æ¦‚ç‡æ•…æ„çŒœé”™
            let aiGuess;
            const shouldMakeError = Math.random() < gameState.aiErrorRate;
            
            if (shouldMakeError) {
                // AIæ•…æ„çŒœé”™
                if (blackCount > redCount) {
                    aiGuess = Math.random() > 0.5 ? 'red' : 'equal';
                } else if (redCount > blackCount) {
                    aiGuess = Math.random() > 0.5 ? 'black' : 'equal';
                } else {
                    aiGuess = Math.random() > 0.5 ? 'black' : 'red';
                }
            } else {
                // AIæ­£å¸¸çŒœæµ‹
                if (blackCount > redCount) {
                    aiGuess = 'black';
                } else if (redCount > blackCount) {
                    aiGuess = 'red';
                } else {
                    aiGuess = 'equal';
                }
            }
            
            // æ˜¾ç¤ºAIçš„çŒœæµ‹
            let guessText = '';
            if (aiGuess === 'black') {
                guessText = 'é»‘è‰²å¤š';
            } else if (aiGuess === 'red') {
                guessText = 'çº¢è‰²å¤š';
            } else {
                guessText = 'ä¸€æ ·å¤š';
            }
            gameMessageEl.textContent = `AIçŒœæµ‹æ˜¯${guessText}`;
            
            // åˆ¤æ–­çŒœæµ‹ç»“æœ
            const correctGuess = (aiGuess === 'black' && blackCount > redCount) || 
                                (aiGuess === 'red' && redCount > blackCount) ||
                                (aiGuess === 'equal' && blackCount === redCount);
            
            // 1ç§’åæ˜¾ç¤ºç»“æœ
            setTimeout(() => {
                // æ­æ™“ç‰Œé¢
                gameState.betCardsRevealed = true;
                updateUI();
                
                if (correctGuess) {
                    // AIçŒœå¯¹äº†ï¼Œç‰Œç»™AI
                    gameState.aiCards = gameState.aiCards.concat(gameState.betCards);
                    gameMessageEl.innerHTML = `<div class="result-message">AIçŒœå¯¹äº†ï¼AIè·å¾—äº†${gameState.betCards.length}å¼ ç‰Œ</div>`;
                } else {
                    // AIçŒœé”™äº†ï¼Œç‰Œç»™ç©å®¶
                    gameState.playerCards = gameState.playerCards.concat(gameState.betCards);
                    gameMessageEl.innerHTML = `<div class="result-message">AIçŒœé”™äº†ï¼ä½ è·å¾—äº†${gameState.betCards.length}å¼ ç‰Œ</div>`;
                }
                
                // æ˜¾ç¤ºå®é™…ç»“æœ
                let actualResult = '';
                if (blackCount > redCount) {
                    actualResult = `å®é™…æ˜¯é»‘è‰²å¤šï¼ˆ${blackCount}é»‘ ${redCount}çº¢ï¼‰`;
                } else if (redCount > blackCount) {
                    actualResult = `å®é™…æ˜¯çº¢è‰²å¤šï¼ˆ${blackCount}é»‘ ${redCount}çº¢ï¼‰`;
                } else {
                    actualResult = `å®é™…æ˜¯ä¸€æ ·å¤šï¼ˆ${blackCount}é»‘ ${redCount}çº¢ï¼‰`;
                }
                gameMessageEl.innerHTML += `<div class="result-message">${actualResult}</div>`;
                
                gameState.betCards = [];
                
                // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
                if (checkGameOver()) {
                    return;
                }
                
                // å»¶è¿Ÿ2ç§’ååˆ‡æ¢åˆ°AIå‡ºç‰Œ
                setTimeout(() => {
                    // åˆ‡æ¢åˆ°AIå‡ºç‰Œï¼Œç©å®¶çŒœæµ‹
                    gameState.currentPlayer = 'ai';
                    
                    // 2ç§’åAIå‡ºç‰Œ
                    setTimeout(aiPlayCards, 2000);
                }, 2000);
            }, 1000);
        }
        
        // AIå‡ºç‰Œ
        function aiPlayCards() {
            if (gameState.currentPlayer !== 'ai' || !gameState.gameStarted) return;
            
            gameMessageEl.textContent = "AIæ­£åœ¨å‡ºç‰Œ...";
            
            // AIéšæœºé€‰æ‹©1-7å¼ ç‰Œï¼ˆä¸è¶…è¿‡æ‰‹ç‰Œæ•°ï¼‰
            const maxCards = Math.min(gameState.maxBetCards, gameState.aiCards.length);
            const numCards = Math.floor(Math.random() * maxCards) + 1;
            
            // éšæœºé€‰æ‹©ç‰Œ
            const selectedCards = [];
            for (let i = 0; i < numCards; i++) {
                if (gameState.aiCards.length === 0) break;
                const randomIndex = Math.floor(Math.random() * gameState.aiCards.length);
                selectedCards.push(gameState.aiCards[randomIndex]);
                gameState.aiCards.splice(randomIndex, 1);
            }
            
            // æ·»åŠ åˆ°å‡ºç‰ŒåŒº
            gameState.betCards = selectedCards;
            gameState.currentBetCount = selectedCards.length;
            gameState.betCardsRevealed = false; // å‡ºç‰ŒåŒºçš„ç‰Œæœªæ­æ™“
            
            // æ›´æ–°UI
            updateUI();
            
            gameMessageEl.textContent = `AIå‡ºäº†${numCards}å¼ ç‰Œï¼Œè¯·çŒœæµ‹æ˜¯é»‘è‰²å¤šã€çº¢è‰²å¤šè¿˜æ˜¯ä¸€æ ·å¤š`;
            
            // åˆ‡æ¢åˆ°ç©å®¶çŒœæµ‹
            gameState.currentPlayer = 'player';
            
            // å¯ç”¨çŒœæµ‹æŒ‰é’®
            guessBlackBtn.disabled = false;
            guessRedBtn.disabled = false;
            guessEqualBtn.disabled = false;
        }
        
        // ç©å®¶çŒœæµ‹
        function playerGuess(guess) {
            if (gameState.currentPlayer !== 'player' || !gameState.gameStarted) return;
            
            // è®¡ç®—é»‘è‰²å’Œçº¢è‰²ç‰Œçš„æ•°é‡
            let blackCount = 0;
            let redCount = 0;
            
            gameState.betCards.forEach(card => {
                if (card.isRed) {
                    redCount++;
                } else {
                    blackCount++;
                }
            });
            
            // æ˜¾ç¤ºç©å®¶çš„çŒœæµ‹
            let guessText = '';
            if (guess === 'black') {
                guessText = 'é»‘è‰²å¤š';
            } else if (guess === 'red') {
                guessText = 'çº¢è‰²å¤š';
            } else {
                guessText = 'ä¸€æ ·å¤š';
            }
            gameMessageEl.textContent = `ä½ çŒœæµ‹æ˜¯${guessText}`;
            
            // åˆ¤æ–­çŒœæµ‹ç»“æœ
            const correctGuess = (guess === 'black' && blackCount > redCount) || 
                                (guess === 'red' && redCount > blackCount) ||
                                (guess === 'equal' && blackCount === redCount);
            
            // ç¦ç”¨çŒœæµ‹æŒ‰é’®
            guessBlackBtn.disabled = true;
            guessRedBtn.disabled = true;
            guessEqualBtn.disabled = true;
            
            // 1ç§’åæ˜¾ç¤ºç»“æœ
            setTimeout(() => {
                // æ­æ™“ç‰Œé¢
                gameState.betCardsRevealed = true;
                updateUI();
                
                if (correctGuess) {
                    // ç©å®¶çŒœå¯¹äº†ï¼Œç‰Œç»™ç©å®¶
                    gameState.playerCards = gameState.playerCards.concat(gameState.betCards);
                    gameMessageEl.innerHTML = `<div class="result-message">ä½ çŒœå¯¹äº†ï¼ä½ è·å¾—äº†${gameState.betCards.length}å¼ ç‰Œ</div>`;
                } else {
                    // ç©å®¶çŒœé”™äº†ï¼Œç‰Œç»™AI
                    gameState.aiCards = gameState.aiCards.concat(gameState.betCards);
                    gameMessageEl.innerHTML = `<div class="result-message">ä½ çŒœé”™äº†ï¼AIè·å¾—äº†${gameState.betCards.length}å¼ ç‰Œ</div>`;
                }
                
                // æ˜¾ç¤ºå®é™…ç»“æœ
                let actualResult = '';
                if (blackCount > redCount) {
                    actualResult = `å®é™…æ˜¯é»‘è‰²å¤šï¼ˆ${blackCount}é»‘ ${redCount}çº¢ï¼‰`;
                } else if (redCount > blackCount) {
                    actualResult = `å®é™…æ˜¯çº¢è‰²å¤šï¼ˆ${blackCount}é»‘ ${redCount}çº¢ï¼‰`;
                } else {
                    actualResult = `å®é™…æ˜¯ä¸€æ ·å¤šï¼ˆ${blackCount}é»‘ ${redCount}çº¢ï¼‰`;
                }
                gameMessageEl.innerHTML += `<div class="result-message">${actualResult}</div>`;
                
                gameState.betCards = [];
                
                // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
                if (checkGameOver()) {
                    return;
                }
                
                // å»¶è¿Ÿ2ç§’ååˆ‡æ¢åˆ°ç©å®¶å‡ºç‰Œ
                setTimeout(() => {
                    // åˆ‡æ¢åˆ°ç©å®¶å‡ºç‰Œï¼ŒAIçŒœæµ‹
                    gameState.currentPlayer = 'player';
                    gameMessageEl.textContent = "ä½ çš„å›åˆï¼šè¯·é€‰æ‹©1-7å¼ ç‰Œå‡ºç‰Œ";
                    
                    // å¯ç”¨å‡ºç‰ŒæŒ‰é’®
                    playCardsBtn.disabled = false;
                    
                    updateUI();
                }, 2000);
            }, 1000);
        }
        
        // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
        function checkGameOver() {
            if (gameState.playerCards.length === 0) {
                gameMessageEl.textContent = "æ¸¸æˆç»“æŸï¼AIè·èƒœï¼";
                endGame();
                return true;
            } else if (gameState.aiCards.length === 0) {
                gameMessageEl.textContent = "æ¸¸æˆç»“æŸï¼ä½ è·èƒœäº†ï¼";
                endGame();
                return true;
            }
            return false;
        }
        
        // ç»“æŸæ¸¸æˆ
        function endGame() {
            gameState.gameStarted = false;
            
            // ç¦ç”¨æ‰€æœ‰æ¸¸æˆæŒ‰é’®
            playCardsBtn.disabled = true;
            guessBlackBtn.disabled = true;
            guessRedBtn.disabled = true;
            guessEqualBtn.disabled = true;
        }
        
        // é¡µé¢ç¼©æ”¾åŠŸèƒ½
        let currentZoom = 100;
        
        function zoomPage(zoomLevel) {
            document.body.style.zoom = `${zoomLevel}%`;
            currentZoom = zoomLevel;
        }
        
        // éšæœºåˆ‡æ¢èƒŒæ™¯ä¸»é¢˜
        function changeBackgroundTheme() {
            const randomIndex = Math.floor(Math.random() * backgroundThemes.length);
            document.body.style.background = backgroundThemes[randomIndex];
        }
        
        // äº‹ä»¶ç›‘å¬å™¨
        startBtn.addEventListener('click', startGame);
        restartBtn.addEventListener('click', initGame);
        playCardsBtn.addEventListener('click', playerPlayCards);
        guessBlackBtn.addEventListener('click', () => playerGuess('black'));
        guessRedBtn.addEventListener('click', () => playerGuess('red'));
        guessEqualBtn.addEventListener('click', () => playerGuess('equal'));
        
        zoomInBtn.addEventListener('click', () => {
            if (currentZoom < 150) {
                zoomPage(currentZoom + 10);
            }
        });
        
        zoomOutBtn.addEventListener('click', () => {
            if (currentZoom > 50) {
                zoomPage(currentZoom - 10);
            }
        });
        
        resetZoomBtn.addEventListener('click', () => {
            zoomPage(100);
        });
        
        changeThemeBtn.addEventListener('click', changeBackgroundTheme);
        
        // åˆå§‹åŒ–æ¸¸æˆ
        initGame();
        
        // é¡µé¢åŠ è½½æ—¶éšæœºé€‰æ‹©èƒŒæ™¯ä¸»é¢˜
        window.addEventListener('load', changeBackgroundTheme);
    </script>
</body>
</html>
