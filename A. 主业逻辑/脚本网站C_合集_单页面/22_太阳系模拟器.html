<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¤ªé˜³ç³»æ¨¡æ‹Ÿå™¨ - Solar System Simulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            background: #000;
            color: #fff;
            touch-action: none;
        }

        #canvas-container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        /* æ¨ªå±æç¤º */
        #orientation-notice {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        #orientation-notice.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .rotate-icon {
            width: 80px;
            height: 80px;
            border: 3px solid #4a9eff;
            border-radius: 15px;
            margin-bottom: 30px;
            animation: rotate 2s linear infinite;
            position: relative;
        }

        .rotate-icon::before {
            content: 'ğŸ“±';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 40px;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(-90deg); }
        }

        .rotate-text {
            font-size: 24px;
            color: #4a9eff;
            text-align: center;
            margin-bottom: 10px;
        }

        .rotate-subtext {
            font-size: 16px;
            color: #aaa;
            text-align: center;
            margin-bottom: 20px;
        }

        .skip-btn {
            background: #4a9eff;
            border: none;
            color: #fff;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .skip-btn:hover {
            background: #3a7edd;
            transform: scale(1.05);
        }

        /* ç§»åŠ¨ç«¯æ§åˆ¶é¢æ¿ */
        #mobile-controls {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 100;
            display: none;
        }

        @media (max-width: 768px) {
            #mobile-controls {
                display: block;
            }
        }

        .mobile-btn {
            background: rgba(74, 158, 255, 0.2);
            border: 1px solid #4a9eff;
            color: #fff;
            padding: 8px 12px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
            margin: 2px;
            display: inline-block;
        }

        .mobile-btn:hover {
            background: rgba(74, 158, 255, 0.4);
        }

        .mobile-btn.active {
            background: #4a9eff;
        }

        /* ä¿¡æ¯é¢æ¿ - ç§»åŠ¨ç«¯ä¼˜åŒ– */
        #info-panel {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 250px;
            max-height: 70vh;
            overflow-y: auto;
            transition: all 0.3s ease;
        }

        @media (max-width: 768px) {
            #info-panel {
                display: none;
            }
        }

        #info-panel h2 {
            color: #4a9eff;
            margin-bottom: 10px;
            font-size: 1.2em;
            text-shadow: 0 0 10px rgba(74, 158, 255, 0.5);
        }

        .planet-info {
            margin: 8px 0;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .planet-info:hover {
            background: rgba(255, 255, 255, 0.1);
            border-left-color: #4a9eff;
            transform: translateX(3px);
        }

        .planet-name {
            font-weight: bold;
            color: #fff;
            margin-bottom: 3px;
            font-size: 14px;
        }

        .planet-details {
            font-size: 11px;
            color: #aaa;
        }

        /* æ¡Œé¢ç«¯æ§åˆ¶é¢æ¿ */
        #desktop-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            padding: 15px 30px;
            border-radius: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 20px;
            align-items: center;
        }

        @media (max-width: 768px) {
            #desktop-controls {
                display: none;
            }
        }

        .control-btn {
            background: rgba(74, 158, 255, 0.2);
            border: 1px solid #4a9eff;
            color: #fff;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .control-btn:hover {
            background: rgba(74, 158, 255, 0.4);
            transform: scale(1.05);
        }

        .control-btn.active {
            background: #4a9eff;
        }

        #speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #speed-slider {
            width: 100px;
            height: 4px;
            -webkit-appearance: none;
            appearance: none;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            outline: none;
        }

        #speed-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: #4a9eff;
            border-radius: 50%;
            cursor: pointer;
        }

        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            color: #4a9eff;
            text-shadow: 0 0 20px rgba(74, 158, 255, 0.8);
        }

        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            border: 1px solid rgba(74, 158, 255, 0.5);
            z-index: 1000;
        }

        .tooltip.show {
            opacity: 1;
        }

        /* è§¦æ‘¸æç¤º */
        .touch-hint {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(74, 158, 255, 0.2);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            color: #fff;
            border: 1px solid #4a9eff;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        /* ç§»åŠ¨ç«¯é€Ÿåº¦æ§åˆ¶ */
        .speed-control-mobile {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 5px;
        }

        .speed-btn {
            background: rgba(74, 158, 255, 0.2);
            border: 1px solid #4a9eff;
            color: #fff;
            padding: 4px 8px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 11px;
        }

        .speed-btn.active {
            background: #4a9eff;
        }

        /* è°ƒè¯•ä¿¡æ¯ */
        .debug-info {
            position: absolute;
            top: 60px;
            left: 10px;
            background: rgba(255, 0, 0, 0.3);
            padding: 5px;
            border-radius: 5px;
            font-size: 10px;
            color: #fff;
            display: none;
        }
    </style>
</head>
<body>
    <div id="canvas-container">
        <!-- æ¨ªå±æç¤º -->
        <div id="orientation-notice">
            <div class="rotate-icon"></div>
            <div class="rotate-text">è¯·æ¨ªå±è§‚çœ‹</div>
            <div class="rotate-subtext">ä¸ºäº†æ›´å¥½çš„ä½“éªŒï¼Œè¯·å°†æ‰‹æœºæ¨ªå±</div>
            <button class="skip-btn" onclick="skipOrientationCheck()">å¼ºåˆ¶ç»§ç»­</button>
        </div>

        <div id="loading">æ­£åœ¨åŠ è½½å¤ªé˜³ç³»...</div>
        
        <!-- è°ƒè¯•ä¿¡æ¯ -->
        <div class="debug-info" id="debug-info"></div>
        
        <!-- ç§»åŠ¨ç«¯æ§åˆ¶é¢æ¿ -->
        <div id="mobile-controls">
            <button class="mobile-btn" id="mobile-toggle-orbits">è½¨é“</button>
            <button class="mobile-btn" id="mobile-toggle-labels">æ ‡ç­¾</button>
            <button class="mobile-btn" id="mobile-toggle-animation">æš‚åœ</button>
            <button class="mobile-btn" id="mobile-reset-view">é‡ç½®</button>
            <div class="speed-control-mobile">
                <span style="font-size: 12px;">é€Ÿåº¦:</span>
                <button class="speed-btn" data-speed="0.5">0.5x</button>
                <button class="speed-btn active" data-speed="1">1x</button>
                <button class="speed-btn" data-speed="2">2x</button>
                <button class="speed-btn" data-speed="5">5x</button>
            </div>
        </div>

        <!-- æ¡Œé¢ç«¯ä¿¡æ¯é¢æ¿ -->
        <div id="info-panel">
            <h2>ğŸŒŒ å¤ªé˜³ç³»æ¨¡æ‹Ÿå™¨</h2>
            <div class="planet-info" data-planet="sun">
                <div class="planet-name">â˜€ï¸ å¤ªé˜³</div>
                <div class="planet-details">æ’æ˜Ÿ | ç›´å¾„: 139.2ä¸‡km</div>
            </div>
            <div class="planet-info" data-planet="mercury">
                <div class="planet-name">â˜¿ æ°´æ˜Ÿ</div>
                <div class="planet-details">å²©çŸ³è¡Œæ˜Ÿ | è·å¤ªé˜³: 5790ä¸‡km</div>
            </div>
            <div class="planet-info" data-planet="venus">
                <div class="planet-name">â™€ é‡‘æ˜Ÿ</div>
                <div class="planet-details">å²©çŸ³è¡Œæ˜Ÿ | è·å¤ªé˜³: 1.08äº¿km</div>
            </div>
            <div class="planet-info" data-planet="earth">
                <div class="planet-name">ğŸŒ åœ°çƒ</div>
                <div class="planet-details">å²©çŸ³è¡Œæ˜Ÿ | è·å¤ªé˜³: 1.5äº¿km</div>
            </div>
            <div class="planet-info" data-planet="mars">
                <div class="planet-name">â™‚ ç«æ˜Ÿ</div>
                <div class="planet-details">å²©çŸ³è¡Œæ˜Ÿ | è·å¤ªé˜³: 2.28äº¿km</div>
            </div>
            <div class="planet-info" data-planet="jupiter">
                <div class="planet-name">â™ƒ æœ¨æ˜Ÿ</div>
                <div class="planet-details">æ°”æ€å·¨è¡Œæ˜Ÿ | è·å¤ªé˜³: 7.78äº¿km</div>
            </div>
            <div class="planet-info" data-planet="saturn">
                <div class="planet-name">â™„ åœŸæ˜Ÿ</div>
                <div class="planet-details">æ°”æ€å·¨è¡Œæ˜Ÿ | è·å¤ªé˜³: 14.3äº¿km</div>
            </div>
            <div class="planet-info" data-planet="uranus">
                <div class="planet-name">â™… å¤©ç‹æ˜Ÿ</div>
                <div class="planet-details">å†°å·¨è¡Œæ˜Ÿ | è·å¤ªé˜³: 28.7äº¿km</div>
            </div>
            <div class="planet-info" data-planet="neptune">
                <div class="planet-name">â™† æµ·ç‹æ˜Ÿ</div>
                <div class="planet-details">å†°å·¨è¡Œæ˜Ÿ | è·å¤ªé˜³: 45äº¿km</div>
            </div>
        </div>

        <!-- æ¡Œé¢ç«¯æ§åˆ¶é¢æ¿ -->
        <div id="desktop-controls">
            <button class="control-btn" id="toggle-orbits">è½¨é“æ˜¾ç¤º</button>
            <button class="control-btn" id="toggle-labels">æ ‡ç­¾æ˜¾ç¤º</button>
            <button class="control-btn" id="toggle-animation">æš‚åœåŠ¨ç”»</button>
            <div id="speed-control">
                <span>é€Ÿåº¦:</span>
                <input type="range" id="speed-slider" min="0" max="5" step="0.1" value="1">
                <span id="speed-value">1x</span>
            </div>
            <button class="control-btn" id="reset-view">é‡ç½®è§†è§’</button>
        </div>

        <!-- ç§»åŠ¨ç«¯è§¦æ‘¸æç¤º -->
        <div class="touch-hint" id="touch-hint">ğŸ‘† å•æŒ‡æ—‹è½¬ | åŒæŒ‡ç¼©æ”¾</div>

        <div class="tooltip" id="tooltip"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.134.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        // æ£€æµ‹è®¾å¤‡ç±»å‹
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        let orientationChecked = false;
        let forceSkip = false;

        // å¤ªé˜³ç³»æ•°æ® - ä¼˜åŒ–äº†é¢œè‰²å’Œæè´¨
        const solarSystemData = {
            sun: {
                name: 'å¤ªé˜³',
                radius: isMobile ? 3 : 5,
                color: 0xffee44,
                emissive: 0xffaa00,
                emissiveIntensity: 1,
                distance: 0,
                speed: 0,
                rotationSpeed: 0.001,
                shininess: 100
            },
            mercury: {
                name: 'æ°´æ˜Ÿ',
                radius: isMobile ? 0.2 : 0.3,
                color: 0x8c7853,
                emissive: 0x4a4030,
                emissiveIntensity: 0.1,
                distance: isMobile ? 6 : 10,
                speed: 0.02,
                rotationSpeed: 0.005,
                shininess: 10
            },
            venus: {
                name: 'é‡‘æ˜Ÿ',
                radius: isMobile ? 0.3 : 0.5,
                color: 0xffc649,
                emissive: 0xffd700,
                emissiveIntensity: 0.2,
                distance: isMobile ? 9 : 15,
                speed: 0.015,
                rotationSpeed: 0.003,
                shininess: 30
            },
            earth: {
                name: 'åœ°çƒ',
                radius: isMobile ? 0.3 : 0.5,
                color: 0x2e7fff,
                emissive: 0x112244,
                emissiveIntensity: 0.1,
                distance: isMobile ? 12 : 20,
                speed: 0.01,
                rotationSpeed: 0.01,
                hasMoon: true,
                shininess: 50
            },
            mars: {
                name: 'ç«æ˜Ÿ',
                radius: isMobile ? 0.25 : 0.4,
                color: 0xcd5c5c,
                emissive: 0x8b2500,
                emissiveIntensity: 0.1,
                distance: isMobile ? 15 : 25,
                speed: 0.008,
                rotationSpeed: 0.009,
                shininess: 20
            },
            jupiter: {
                name: 'æœ¨æ˜Ÿ',
                radius: isMobile ? 1.2 : 2,
                color: 0xd4a76a,
                emissive: 0x8b6914,
                emissiveIntensity: 0.1,
                distance: isMobile ? 24 : 40,
                speed: 0.005,
                rotationSpeed: 0.02,
                shininess: 40
            },
            saturn: {
                name: 'åœŸæ˜Ÿ',
                radius: isMobile ? 1 : 1.8,
                color: 0xfad5a5,
                emissive: 0xdaa520,
                emissiveIntensity: 0.1,
                distance: isMobile ? 33 : 55,
                speed: 0.003,
                rotationSpeed: 0.018,
                hasRing: true,
                shininess: 35
            },
            uranus: {
                name: 'å¤©ç‹æ˜Ÿ',
                radius: isMobile ? 0.6 : 1,
                color: 0x4fd0e7,
                emissive: 0x00ced1,
                emissiveIntensity: 0.15,
                distance: isMobile ? 42 : 70,
                speed: 0.002,
                rotationSpeed: 0.015,
                shininess: 45
            },
            neptune: {
                name: 'æµ·ç‹æ˜Ÿ',
                radius: isMobile ? 0.6 : 1,
                color: 0x4b70dd,
                emissive: 0x1e3a8a,
                emissiveIntensity: 0.15,
                distance: isMobile ? 51 : 85,
                speed: 0.001,
                rotationSpeed: 0.012,
                shininess: 45
            }
        };

        // åˆå§‹åŒ–åœºæ™¯
        let scene, camera, renderer, controls;
        let planets = {};
        let orbits = {};
        let labels = {};
        let animationSpeed = 1;
        let isAnimating = true;
        let showOrbits = true;
        let showLabels = true;

        // æ”¹è¿›çš„æ¨ªå±æ£€æµ‹
        function isLandscape() {
            // å¤šç§æ£€æµ‹æ–¹æ³•ç»„åˆ
            const wh = window.innerHeight > window.innerWidth;
            const screenAngle = window.screen && window.screen.orientation ? 
                window.screen.orientation.angle : 
                (window.orientation || 0);
            const isLandscapeByOrientation = Math.abs(screenAngle) === 90 || Math.abs(screenAngle) === 270;
            
            // è°ƒè¯•ä¿¡æ¯
            const debugInfo = document.getElementById('debug-info');
            if (debugInfo) {
                debugInfo.innerHTML = `
                    å®½é«˜æ¯”: ${window.innerWidth}x${window.innerHeight}<br>
                    é«˜>å®½: ${wh}<br>
                    å±å¹•è§’åº¦: ${screenAngle}Â°<br>
                    æ¨ªå±æ£€æµ‹: ${isLandscapeByOrientation}<br>
                    å¼ºåˆ¶è·³è¿‡: ${forceSkip}
                `;
            }
            
            // å¦‚æœå¼ºåˆ¶è·³è¿‡ï¼Œç›´æ¥è¿”å›true
            if (forceSkip) return true;
            
            // æ¡Œé¢ç«¯ç›´æ¥è¿”å›true
            if (!isMobile) return true;
            
            // ç§»åŠ¨ç«¯ä½¿ç”¨å¤šç§æ£€æµ‹
            return !wh || isLandscapeByOrientation;
        }

        // å¼ºåˆ¶è·³è¿‡æ¨ªå±æ£€æµ‹
        function skipOrientationCheck() {
            forceSkip = true;
            document.getElementById('orientation-notice').classList.add('hidden');
            if (!orientationChecked) {
                orientationChecked = true;
                startInit();
            }
        }

        // æ£€æŸ¥æ¨ªå±çŠ¶æ€
        function checkOrientation() {
            const notice = document.getElementById('orientation-notice');
            const isLand = isLandscape();
            
            if (isLand) {
                notice.classList.add('hidden');
                if (!orientationChecked) {
                    orientationChecked = true;
                    setTimeout(() => {
                        startInit();
                    }, 300);
                }
                return true;
            } else {
                notice.classList.remove('hidden');
                return false;
            }
        }

        function init() {
            // å»¶è¿Ÿæ£€æµ‹ï¼Œç¡®ä¿é¡µé¢å®Œå…¨åŠ è½½
            setTimeout(() => {
                checkOrientation();
            }, 100);
            
            // ç›‘å¬æ–¹å‘å˜åŒ–
            window.addEventListener('resize', () => {
                if (!orientationChecked) {
                    checkOrientation();
                }
            });
            
            window.addEventListener('orientationchange', () => {
                setTimeout(() => {
                    checkOrientation();
                }, 500);
            });
        }

        function startInit() {
            // åˆ›å»ºåœºæ™¯
            scene = new THREE.Scene();

            // åˆ›å»ºç›¸æœº
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(isMobile ? 20 : 30, isMobile ? 20 : 30, isMobile ? 35 : 50);

            // åˆ›å»ºæ¸²æŸ“å™¨
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            renderer.setPixelRatio(window.devicePixelRatio);
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            // æ·»åŠ æ§åˆ¶å™¨
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.minDistance = isMobile ? 5 : 10;
            controls.maxDistance = isMobile ? 100 : 200;
            
            // ç§»åŠ¨ç«¯ä¼˜åŒ–
            if (isMobile) {
                controls.enablePan = false;
                controls.rotateSpeed = 0.5;
                controls.zoomSpeed = 0.8;
            }

            // åˆ›å»ºæ˜Ÿç©ºèƒŒæ™¯
            createStarfield();

            // åˆ›å»ºå…‰æº
            createLights();

            // åˆ›å»ºå¤ªé˜³ç³»
            createSolarSystem();

            // éšè—åŠ è½½æç¤º
            document.getElementById('loading').style.display = 'none';

            // éšè—è§¦æ‘¸æç¤º
            if (isMobile) {
                setTimeout(() => {
                    document.getElementById('touch-hint').style.display = 'none';
                }, 5000);
            }

            // æ·»åŠ äº‹ä»¶ç›‘å¬
            addEventListeners();

            // å¼€å§‹åŠ¨ç”»
            animate();
        }

        function createStarfield() {
            const starsGeometry = new THREE.BufferGeometry();
            const starsMaterial = new THREE.PointsMaterial({
                color: 0xffffff,
                size: isMobile ? 0.3 : 0.5,
                transparent: true,
                opacity: 0.8
            });

            const starsVertices = [];
            const starCount = isMobile ? 5000 : 10000;
            for (let i = 0; i < starCount; i++) {
                const x = (Math.random() - 0.5) * 2000;
                const y = (Math.random() - 0.5) * 2000;
                const z = (Math.random() - 0.5) * 2000;
                starsVertices.push(x, y, z);
            }

            starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starsVertices, 3));
            const starField = new THREE.Points(starsGeometry, starsMaterial);
            scene.add(starField);
        }

        function createLights() {
            // å¢å¼ºç¯å¢ƒå…‰ï¼Œè®©è¡Œæ˜Ÿæ›´æ˜äº®
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);

            // å¤ªé˜³å…‰æº - æ›´å¼ºçš„å…‰ç…§
            const sunLight = new THREE.PointLight(0xffffff, 3, 400);
            sunLight.position.set(0, 0, 0);
            sunLight.castShadow = true;
            sunLight.shadow.mapSize.width = 2048;
            sunLight.shadow.mapSize.height = 2048;
            scene.add(sunLight);

            // æ·»åŠ é¢å¤–çš„è¡¥å…‰ï¼Œå‡å°‘é˜´å½±è¿‡æš—
            const fillLight = new THREE.DirectionalLight(0x4444ff, 0.3);
            fillLight.position.set(50, 50, 50);
            scene.add(fillLight);
        }

        function createSolarSystem() {
            Object.keys(solarSystemData).forEach(planetKey => {
                const planetData = solarSystemData[planetKey];
                
                // åˆ›å»ºè¡Œæ˜Ÿ - ä½¿ç”¨æ›´ä¸°å¯Œçš„æè´¨
                const geometry = new THREE.SphereGeometry(planetData.radius, isMobile ? 16 : 32, isMobile ? 16 : 32);
                
                // æ ¹æ®è¡Œæ˜Ÿç±»å‹åˆ›å»ºä¸åŒæè´¨
                let material;
                if (planetKey === 'sun') {
                    // å¤ªé˜³ç‰¹æ®Šæè´¨
                    material = new THREE.MeshBasicMaterial({
                        color: planetData.color,
                        emissive: planetData.emissive,
                        emissiveIntensity: planetData.emissiveIntensity
                    });
                } else if (planetKey === 'earth') {
                    // åœ°çƒç‰¹æ®Šå¤„ç†
                    material = new THREE.MeshPhongMaterial({
                        color: planetData.color,
                        emissive: planetData.emissive,
                        emissiveIntensity: planetData.emissiveIntensity,
                        shininess: planetData.shininess,
                        specular: 0x222222
                    });
                } else {
                    // å…¶ä»–è¡Œæ˜Ÿ
                    material = new THREE.MeshPhongMaterial({
                        color: planetData.color,
                        emissive: planetData.emissive,
                        emissiveIntensity: planetData.emissiveIntensity,
                        shininess: planetData.shininess,
                        specular: 0x111111
                    });
                }

                const planet = new THREE.Mesh(geometry, material);
                planet.position.x = planetData.distance;
                planet.castShadow = true;
                planet.receiveShadow = true;
                planet.userData = planetData;

                scene.add(planet);
                planets[planetKey] = planet;

                // åˆ›å»ºè½¨é“
                if (planetData.distance > 0) {
                    const orbitGeometry = new THREE.RingGeometry(planetData.distance - 0.1, planetData.distance + 0.1, 32);
                    const orbitMaterial = new THREE.MeshBasicMaterial({
                        color: 0x404040,
                        side: THREE.DoubleSide,
                        transparent: true,
                        opacity: 0.3
                    });
                    const orbit = new THREE.Mesh(orbitGeometry, orbitMaterial);
                    orbit.rotation.x = -Math.PI / 2;
                    scene.add(orbit);
                    orbits[planetKey] = orbit;
                }

                // æ·»åŠ åœŸæ˜Ÿç¯ - æ›´ç»šä¸½çš„é¢œè‰²
                if (planetData.hasRing && planetKey === 'saturn') {
                    const ringGeometry = new THREE.RingGeometry(planetData.radius * 1.5, planetData.radius * 2.5, 32);
                    const ringMaterial = new THREE.MeshBasicMaterial({
                        color: 0xf4e4c1,
                        side: THREE.DoubleSide,
                        transparent: true,
                        opacity: 0.8
                    });
                    const ring = new THREE.Mesh(ringGeometry, ringMaterial);
                    ring.rotation.x = -Math.PI / 2;
                    planet.add(ring);
                }

                // æ·»åŠ åœ°çƒçš„æœˆäº®
                if (planetData.hasMoon && planetKey === 'earth') {
                    const moonGeometry = new THREE.SphereGeometry(0.15, 16, 16);
                    const moonMaterial = new THREE.MeshPhongMaterial({ 
                        color: 0xcccccc,
                        emissive: 0x222222,
                        emissiveIntensity: 0.1
                    });
                    const moon = new THREE.Mesh(moonGeometry, moonMaterial);
                    moon.position.x = planetData.radius + 2;
                    planet.add(moon);
                    planet.moon = moon;
                }

                // åˆ›å»ºæ ‡ç­¾
                createLabel(planetKey, planetData.name);
            });
        }

        function createLabel(planetKey, text) {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = 256;
            canvas.height = 64;
            
            context.fillStyle = 'rgba(0, 0, 0, 0)';
            context.fillRect(0, 0, canvas.width, canvas.height);
            
            context.font = isMobile ? '18px Arial' : '24px Arial';
            context.fillStyle = 'white';
            context.textAlign = 'center';
            context.fillText(text, canvas.width / 2, canvas.height / 2);

            const texture = new THREE.CanvasTexture(canvas);
            const spriteMaterial = new THREE.SpriteMaterial({ map: texture });
            const sprite = new THREE.Sprite(spriteMaterial);
            sprite.scale.set(isMobile ? 8 : 10, isMobile ? 2 : 2.5, 1);
            sprite.position.y = planets[planetKey].userData.radius + 3;
            
            planets[planetKey].add(sprite);
            labels[planetKey] = sprite;
        }

        function animate() {
            requestAnimationFrame(animate);

            if (isAnimating) {
                Object.keys(planets).forEach(planetKey => {
                    const planet = planets[planetKey];
                    const planetData = planet.userData;

                    // è‡ªè½¬
                    planet.rotation.y += planetData.rotationSpeed * animationSpeed;

                    // å…¬è½¬
                    if (planetData.distance > 0) {
                        const time = Date.now() * 0.001 * animationSpeed;
                        planet.position.x = Math.cos(time * planetData.speed) * planetData.distance;
                        planet.position.z = Math.sin(time * planetData.speed) * planetData.distance;
                    }

                    // æœˆäº®å…¬è½¬
                    if (planet.moon) {
                        const moonTime = Date.now() * 0.002 * animationSpeed;
                        planet.moon.position.x = Math.cos(moonTime) * (planetData.radius + 2);
                        planet.moon.position.z = Math.sin(moonTime) * (planetData.radius + 2);
                    }
                });
            }

            controls.update();
            renderer.render(scene, camera);
        }

        function addEventListeners() {
            // çª—å£å¤§å°è°ƒæ•´
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });

            // æ¡Œé¢ç«¯æ§åˆ¶
            document.getElementById('toggle-orbits')?.addEventListener('click', function() {
                showOrbits = !showOrbits;
                Object.values(orbits).forEach(orbit => {
                    orbit.visible = showOrbits;
                });
                this.classList.toggle('active');
            });

            document.getElementById('toggle-labels')?.addEventListener('click', function() {
                showLabels = !showLabels;
                Object.values(labels).forEach(label => {
                    label.visible = showLabels;
                });
                this.classList.toggle('active');
            });

            document.getElementById('toggle-animation')?.addEventListener('click', function() {
                isAnimating = !isAnimating;
                this.textContent = isAnimating ? 'æš‚åœåŠ¨ç”»' : 'æ’­æ”¾åŠ¨ç”»';
                this.classList.toggle('active');
            });

            document.getElementById('speed-slider')?.addEventListener('input', function() {
                animationSpeed = parseFloat(this.value);
                document.getElementById('speed-value').textContent = animationSpeed.toFixed(1) + 'x';
            });

            document.getElementById('reset-view')?.addEventListener('click', () => {
                camera.position.set(isMobile ? 20 : 30, isMobile ? 20 : 30, isMobile ? 35 : 50);
                controls.reset();
            });

            // ç§»åŠ¨ç«¯æ§åˆ¶
            document.getElementById('mobile-toggle-orbits')?.addEventListener('click', function() {
                showOrbits = !showOrbits;
                Object.values(orbits).forEach(orbit => {
                    orbit.visible = showOrbits;
                });
                this.classList.toggle('active');
            });

            document.getElementById('mobile-toggle-labels')?.addEventListener('click', function() {
                showLabels = !showLabels;
                Object.values(labels).forEach(label => {
                    label.visible = showLabels;
                });
                this.classList.toggle('active');
            });

            document.getElementById('mobile-toggle-animation')?.addEventListener('click', function() {
                isAnimating = !isAnimating;
                this.textContent = isAnimating ? 'æš‚åœ' : 'æ’­æ”¾';
                this.classList.toggle('active');
            });

            document.getElementById('mobile-reset-view')?.addEventListener('click', () => {
                camera.position.set(20, 20, 35);
                controls.reset();
            });

            // ç§»åŠ¨ç«¯é€Ÿåº¦æŒ‰é’®
            document.querySelectorAll('.speed-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.speed-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    animationSpeed = parseFloat(this.dataset.speed);
                });
            });

            // è¡Œæ˜Ÿä¿¡æ¯ç‚¹å‡»ï¼ˆä»…æ¡Œé¢ç«¯ï¼‰
            if (!isMobile) {
                document.querySelectorAll('.planet-info').forEach(info => {
                    info.addEventListener('click', function() {
                        const planetKey = this.dataset.planet;
                        const planet = planets[planetKey];
                        if (planet) {
                            // èšç„¦åˆ°è¡Œæ˜Ÿ
                            const targetPosition = planet.position.clone();
                            targetPosition.y += planet.userData.radius * 3;
                            
                            // å¹³æ»‘ç§»åŠ¨ç›¸æœº
                            const startPosition = camera.position.clone();
                            const startTime = Date.now();
                            const duration = 2000;

                            function moveCamera() {
                                const elapsed = Date.now() - startTime;
                                const progress = Math.min(elapsed / duration, 1);
                                const easeProgress = 1 - Math.pow(1 - progress, 3);

                                camera.position.lerpVectors(startPosition, targetPosition, easeProgress);
                                controls.target.lerp(planet.position, easeProgress);
                                controls.update();

                                if (progress < 1) {
                                    requestAnimationFrame(moveCamera);
                                }
                            }
                            moveCamera();
                        }
                    });
                });
            }

            // é¼ æ ‡/è§¦æ‘¸æ‚¬åœæç¤º
            const tooltip = document.getElementById('tooltip');
            const raycaster = new THREE.Raycaster();
            const mouse = new THREE.Vector2();

            function updateTooltip(clientX, clientY) {
                mouse.x = (clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(clientY / window.innerHeight) * 2 + 1;

                raycaster.setFromCamera(mouse, camera);
                const intersects = raycaster.intersectObjects(Object.values(planets));

                if (intersects.length > 0) {
                    const planet = intersects[0].object;
                    const planetData = planet.userData;
                    
                    tooltip.innerHTML = `
                        <strong>${planetData.name}</strong><br>
                        åŠå¾„: ${planetData.radius * 1000} km<br>
                        ${planetData.distance > 0 ? `è½¨é“åŠå¾„: ${planetData.distance * 10} ç™¾ä¸‡km` : 'æ’æ˜Ÿ'}
                    `;
                    tooltip.style.left = clientX + 10 + 'px';
                    tooltip.style.top = clientY - 30 + 'px';
                    tooltip.classList.add('show');
                } else {
                    tooltip.classList.remove('show');
                }
            }

            if (!isMobile) {
                renderer.domElement.addEventListener('mousemove', (event) => {
                    updateTooltip(event.clientX, event.clientY);
                });
            } else {
                renderer.domElement.addEventListener('touchmove', (event) => {
                    if (event.touches.length === 1) {
                        updateTooltip(event.touches[0].clientX, event.touches[0].clientY);
                    }
                });
            }
        }

        // åˆå§‹åŒ–
        init();
    </script>
</body>
</html>
