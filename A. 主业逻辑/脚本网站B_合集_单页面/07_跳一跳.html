<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>èŒå® è·³è·ƒå¤§å†’é™©</title>
    <style>
        /* ä¸€ã€åŸºç¡€æ ·å¼è®¾ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
            height: 100vh;
        }

        /* äºŒã€æ¸¸æˆç”»å¸ƒæ ·å¼ */
        #gameCanvas {
            display: block;
            margin: 0 auto;
            background: linear-gradient(to bottom, #87CEEB 0%, #FFE4E1 50%, #FFB6C1 100%);
            cursor: pointer;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        /* ä¸‰ã€UIå…ƒç´ æ ·å¼ */
        #score {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 28px;
            color: white;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            z-index: 100;
        }

        #gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            display: none;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            z-index: 200;
        }

        #gameOver h2 {
            margin-bottom: 20px;
            color: white;
            font-size: 36px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        #finalScore {
            color: #FFD700;
            font-size: 32px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        #restartBtn {
            padding: 15px 40px;
            font-size: 20px;
            background: linear-gradient(45deg, #FF6B6B, #FF8E53);
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        #restartBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(0, 0, 0, 0.4);
        }

        #startHint {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 18px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            z-index: 100;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        /* å››ã€å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            #score {
                font-size: 24px;
                top: 15px;
                left: 15px;
            }
            
            #gameOver {
                padding: 30px;
                width: 90%;
            }
            
            #gameOver h2 {
                font-size: 28px;
            }
            
            #finalScore {
                font-size: 24px;
            }
            
            #restartBtn {
                padding: 12px 30px;
                font-size: 18px;
            }
            
            #startHint {
                font-size: 16px;
                bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="score">å¾—åˆ†: 0</div>
    <div id="startHint">ğŸ® æŒ‰ä½å±å¹•è“„åŠ›ï¼Œæ¾å¼€è·³è·ƒ</div>
    <div id="gameOver">
        <h2>æ¸¸æˆç»“æŸï¼</h2>
        <p>æœ€ç»ˆå¾—åˆ†: <span id="finalScore">0</span></p>
        <button id="restartBtn">ğŸ”„ é‡æ–°å¼€å§‹</button>
    </div>

    <script>
        // ä¸€ã€æ¸¸æˆé…ç½®å˜é‡
        const GAME_CONFIG = {
            // 1. ç”»å¸ƒè®¾ç½®
            canvasWidth: window.innerWidth * 0.9,
            canvasHeight: window.innerHeight * 0.8,
            
            // 2. ç©å®¶è®¾ç½®
            playerSize: 40,
            playerColor: '#FF69B4',
            eyeColor: '#FFFFFF',
            pupilColor: '#000000',
            
            // 3. ç‰©ç†å‚æ•°
            gravity: 0.5,
            maxPower: 60,
            powerIncrement: 2,
            powerInterval: 20,
            
            // 4. å¹³å°è®¾ç½®
            platformMinWidth: 60,
            platformMaxWidth: 120,
            platformHeight: 15,
            platformGapMin: 100,
            platformGapMax: 200,
            platformHeightVariation: 250,
            
            // 5. ç›¸æœºè®¾ç½®
            cameraFollowThreshold: 0.5,
            
            // 6. é¢œè‰²é…ç½®
            platformColor: '#8B4513',
            platformPassedColor: '#A0522D',
            platformHighlightColor: '#D2B48C',
            powerBarColor: '#00FF00',
            powerBarDangerColor: '#FF0000',
            
            // 7. èƒŒæ™¯è£…é¥°
            cloudCount: 5,
            starCount: 20
        };

        // äºŒã€æ¸¸æˆçŠ¶æ€å˜é‡
        let canvas, ctx;
        let score = 0;
        let isCharging = false;
        let power = 0;
        let gameRunning = true;
        let cameraX = 0;
        let animationId;

        // ä¸‰ã€æ¸¸æˆå¯¹è±¡
        // 1. ç©å®¶å¯¹è±¡
        const player = {
            x: 100,
            y: GAME_CONFIG.canvasHeight - 150,
            width: GAME_CONFIG.playerSize,
            height: GAME_CONFIG.playerSize,
            vx: 0,
            vy: 0,
            jumping: false,
            rotation: 0,
            trail: []
        };

        // 2. å¹³å°æ•°ç»„
        const platforms = [
            { x: 50, y: GAME_CONFIG.canvasHeight - 100, width: 100, height: GAME_CONFIG.platformHeight, passed: false },
            { x: 200, y: GAME_CONFIG.canvasHeight - 150, width: 80, height: GAME_CONFIG.platformHeight, passed: false },
            { x: 350, y: GAME_CONFIG.canvasHeight - 200, width: 80, height: GAME_CONFIG.platformHeight, passed: false },
            { x: 500, y: GAME_CONFIG.canvasHeight - 250, width: 80, height: GAME_CONFIG.platformHeight, passed: false },
            { x: 650, y: GAME_CONFIG.canvasHeight - 300, width: 80, height: GAME_CONFIG.platformHeight, passed: false }
        ];

        // 3. è£…é¥°å…ƒç´ 
        const clouds = [];
        const stars = [];

        // å››ã€åˆå§‹åŒ–å‡½æ•°
        function init() {
            // 1. è·å–ç”»å¸ƒ
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            
            // 2. è®¾ç½®ç”»å¸ƒå°ºå¯¸
            canvas.width = GAME_CONFIG.canvasWidth;
            canvas.height = GAME_CONFIG.canvasHeight;
            
            // 3. åˆå§‹åŒ–è£…é¥°å…ƒç´ 
            initDecorations();
            
            // 4. ç»‘å®šäº‹ä»¶
            bindEvents();
            
            // 5. å¼€å§‹æ¸¸æˆå¾ªç¯
            gameLoop();
        }

        // äº”ã€è£…é¥°å…ƒç´ åˆå§‹åŒ–
        function initDecorations() {
            // 1. ç”Ÿæˆäº‘æœµ
            for (let i = 0; i < GAME_CONFIG.cloudCount; i++) {
                clouds.push({
                    x: Math.random() * GAME_CONFIG.canvasWidth,
                    y: Math.random() * GAME_CONFIG.canvasHeight * 0.5,
                    size: Math.random() * 30 + 20,
                    speed: Math.random() * 0.5 + 0.1
                });
            }
            
            // 2. ç”Ÿæˆæ˜Ÿæ˜Ÿ
            for (let i = 0; i < GAME_CONFIG.starCount; i++) {
                stars.push({
                    x: Math.random() * GAME_CONFIG.canvasWidth,
                    y: Math.random() * GAME_CONFIG.canvasHeight,
                    size: Math.random() * 3 + 1,
                    twinkle: Math.random() * Math.PI * 2
                });
            }
        }

        // å…­ã€ç»˜åˆ¶å‡½æ•°
        // 1. ç»˜åˆ¶èƒŒæ™¯
        function drawBackground() {
            // 1.1 ç»˜åˆ¶æ¸å˜èƒŒæ™¯
            const gradient = ctx.createLinearGradient(0, 0, 0, GAME_CONFIG.canvasHeight);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(0.5, '#FFE4E1');
            gradient.addColorStop(1, '#FFB6C1');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, GAME_CONFIG.canvasWidth, GAME_CONFIG.canvasHeight);
            
            // 1.2 ç»˜åˆ¶äº‘æœµ
            clouds.forEach(cloud => {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
                ctx.beginPath();
                ctx.arc(cloud.x - cameraX * 0.3, cloud.y, cloud.size, 0, Math.PI * 2);
                ctx.arc(cloud.x - cameraX * 0.3 + cloud.size * 0.5, cloud.y, cloud.size * 0.8, 0, Math.PI * 2);
                ctx.arc(cloud.x - cameraX * 0.3 - cloud.size * 0.5, cloud.y, cloud.size * 0.8, 0, Math.PI * 2);
                ctx.fill();
            });
            
            // 1.3 ç»˜åˆ¶æ˜Ÿæ˜Ÿ
            stars.forEach(star => {
                const opacity = Math.sin(star.twinkle) * 0.5 + 0.5;
                ctx.fillStyle = `rgba(255, 255, 0, ${opacity})`;
                ctx.beginPath();
                ctx.arc(star.x - cameraX * 0.1, star.y, star.size, 0, Math.PI * 2);
                ctx.fill();
                star.twinkle += 0.05;
            });
        }

        // 2. ç»˜åˆ¶ç©å®¶ï¼ˆèŒå® å½¢è±¡ï¼‰
        function drawPlayer() {
            ctx.save();
            
            // 2.1 ç§»åŠ¨åˆ°ç©å®¶ä½ç½®å¹¶æ—‹è½¬
            ctx.translate(player.x - cameraX + player.width / 2, player.y + player.height / 2);
            ctx.rotate(player.rotation);
            
            // 2.2 ç»˜åˆ¶èº«ä½“ï¼ˆåœ†å½¢ï¼‰
            ctx.fillStyle = GAME_CONFIG.playerColor;
            ctx.beginPath();
            ctx.arc(0, 0, player.width / 2, 0, Math.PI * 2);
            ctx.fill();
            
            // 2.3 ç»˜åˆ¶è€³æœµ
            ctx.fillStyle = GAME_CONFIG.playerColor;
            ctx.beginPath();
            ctx.arc(-player.width / 3, -player.width / 2, player.width / 4, 0, Math.PI * 2);
            ctx.arc(player.width / 3, -player.width / 2, player.width / 4, 0, Math.PI * 2);
            ctx.fill();
            
            // 2.4 ç»˜åˆ¶çœ¼ç›
            ctx.fillStyle = GAME_CONFIG.eyeColor;
            ctx.beginPath();
            ctx.arc(-player.width / 4, -player.width / 6, player.width / 6, 0, Math.PI * 2);
            ctx.arc(player.width / 4, -player.width / 6, player.width / 6, 0, Math.PI * 2);
            ctx.fill();
            
            // 2.5 ç»˜åˆ¶ç³å­”
            ctx.fillStyle = GAME_CONFIG.pupilColor;
            ctx.beginPath();
            ctx.arc(-player.width / 4, -player.width / 6, player.width / 12, 0, Math.PI * 2);
            ctx.arc(player.width / 4, -player.width / 6, player.width / 12, 0, Math.PI * 2);
            ctx.fill();
            
            // 2.6 ç»˜åˆ¶å˜´å·´
            ctx.strokeStyle = GAME_CONFIG.pupilColor;
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(0, 0, player.width / 4, 0.2 * Math.PI, 0.8 * Math.PI);
            ctx.stroke();
            
            // 2.7 ç»˜åˆ¶è½¨è¿¹
            if (player.trail.length > 0) {
                ctx.strokeStyle = 'rgba(255, 105, 180, 0.3)';
                ctx.lineWidth = 3;
                ctx.beginPath();
                player.trail.forEach((point, index) => {
                    if (index === 0) {
                        ctx.moveTo(point.x - cameraX + player.width / 2, point.y + player.height / 2);
                    } else {
                        ctx.lineTo(point.x - cameraX + player.width / 2, point.y + player.height / 2);
                    }
                });
                ctx.stroke();
            }
            
            ctx.restore();
        }

        // 3. ç»˜åˆ¶å¹³å°
        function drawPlatforms() {
            platforms.forEach(platform => {
                // 3.1 ç»˜åˆ¶å¹³å°ä¸»ä½“
                const gradient = ctx.createLinearGradient(
                    platform.x - cameraX, 
                    platform.y, 
                    platform.x - cameraX, 
                    platform.y + platform.height
                );
                
                if (platform.passed) {
                    gradient.addColorStop(0, GAME_CONFIG.platformPassedColor);
                    gradient.addColorStop(1, '#8B4513');
                } else {
                    gradient.addColorStop(0, GAME_CONFIG.platformColor);
                    gradient.addColorStop(1, '#654321');
                }
                
                ctx.fillStyle = gradient;
                ctx.fillRect(platform.x - cameraX, platform.y, platform.width, platform.height);
                
                // 3.2 ç»˜åˆ¶å¹³å°è¾¹ç¼˜é«˜å…‰
                ctx.fillStyle = GAME_CONFIG.platformHighlightColor;
                ctx.fillRect(platform.x - cameraX, platform.y, platform.width, 3);
                
                // 3.3 ç»˜åˆ¶å¹³å°é˜´å½±
                ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
                ctx.fillRect(platform.x - cameraX, platform.y + platform.height, platform.width, 5);
            });
        }

        // 4. ç»˜åˆ¶è“„åŠ›æ¡
        function drawPowerBar() {
            if (isCharging) {
                // 4.1 ç»˜åˆ¶èƒŒæ™¯
                ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
                ctx.fillRect(player.x - cameraX - 15, player.y - 40, 60, 12);
                
                // 4.2 ç»˜åˆ¶è“„åŠ›æ¡
                const barColor = power > GAME_CONFIG.maxPower * 0.6 ? GAME_CONFIG.powerBarDangerColor : GAME_CONFIG.powerBarColor;
                ctx.fillStyle = barColor;
                ctx.fillRect(player.x - cameraX - 15, player.y - 40, power * 1.2, 12);
                
                // 4.3 ç»˜åˆ¶è¾¹æ¡†
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 2;
                ctx.strokeRect(player.x - cameraX - 15, player.y - 40, 60, 12);
            }
        }

        // ä¸ƒã€æ¸¸æˆé€»è¾‘å‡½æ•°
        // 1. ç”Ÿæˆæ–°å¹³å°
        function generatePlatform() {
            const lastPlatform = platforms[platforms.length - 1];
            const newX = lastPlatform.x + Math.random() * (GAME_CONFIG.platformGapMax - GAME_CONFIG.platformGapMin) + GAME_CONFIG.platformGapMin;
            const newY = Math.random() * GAME_CONFIG.platformHeightVariation + GAME_CONFIG.canvasHeight - 350;
            const width = Math.random() * (GAME_CONFIG.platformMaxWidth - GAME_CONFIG.platformMinWidth) + GAME_CONFIG.platformMinWidth;
            
            platforms.push({
                x: newX,
                y: newY,
                width: width,
                height: GAME_CONFIG.platformHeight,
                passed: false
            });
        }

        // 2. ç¢°æ’æ£€æµ‹
        function checkCollision() {
            for (let platform of platforms) {
                if (player.x < platform.x + platform.width &&
                    player.x + player.width > platform.x &&
                    player.y + player.height > platform.y &&
                    player.y + player.height < platform.y + platform.height + 10 &&
                    player.vy >= 0) {
                    
                    player.y = platform.y - player.height;
                    player.vy = 0;
                    player.jumping = false;
                    player.vx = 0;
                    player.rotation = 0;
                    player.trail = [];
                    return true;
                }
            }
            return false;
        }

        // 3. æ£€æŸ¥å¹³å°é€šè¿‡
        function checkPlatformPassed() {
            for (let platform of platforms) {
                if (!platform.passed && player.x > platform.x + platform.width) {
                    platform.passed = true;
                    score++;
                    document.getElementById('score').textContent = 'å¾—åˆ†: ' + score;
                }
            }
        }

        // 4. æ›´æ–°æ¸¸æˆçŠ¶æ€
        function update() {
            if (!gameRunning) return;

            // 4.1 åº”ç”¨é‡åŠ›
            player.vy += GAME_CONFIG.gravity;
            
            // 4.2 æ›´æ–°ä½ç½®
            player.x += player.vx;
            player.y += player.vy;
            
            // 4.3 æ›´æ–°æ—‹è½¬
            if (player.jumping) {
                player.rotation += 0.1;
                
                // 4.4 æ›´æ–°è½¨è¿¹
                player.trail.push({ x: player.x, y: player.y });
                if (player.trail.length > 10) {
                    player.trail.shift();
                }
            }
            
            // 4.5 ç¢°æ’æ£€æµ‹
            checkCollision();
            
            // 4.6 æ£€æŸ¥å¹³å°é€šè¿‡
            checkPlatformPassed();
            
            // 4.7 æ›´æ–°ç›¸æœº
            if (player.x > GAME_CONFIG.canvasWidth * GAME_CONFIG.cameraFollowThreshold) {
                cameraX = player.x - GAME_CONFIG.canvasWidth * GAME_CONFIG.cameraFollowThreshold;
            }
            
            // 4.8 æ£€æŸ¥æ‰è½
            if (player.y > GAME_CONFIG.canvasHeight) {
                gameOver();
            }
            
            // 4.9 ç”Ÿæˆæ–°å¹³å°
            if (platforms[platforms.length - 1].x - cameraX < GAME_CONFIG.canvasWidth) {
                generatePlatform();
            }
            
            // 4.10 ç§»é™¤å±å¹•å¤–å¹³å°
            platforms.forEach((platform, index) => {
                if (platform.x + platform.width < cameraX - 100) {
                    platforms.splice(index, 1);
                }
            });
            
            // 4.11 æ›´æ–°äº‘æœµ
            clouds.forEach(cloud => {
                cloud.x += cloud.speed;
                if (cloud.x - cameraX > GAME_CONFIG.canvasWidth + 100) {
                    cloud.x = cameraX - 100;
                }
            });
        }

        // å…«ã€æ¸¸æˆæ§åˆ¶å‡½æ•°
        // 1. æ¸¸æˆç»“æŸ
        function gameOver() {
            gameRunning = false;
            document.getElementById('finalScore').textContent = score;
            document.getElementById('gameOver').style.display = 'block';
            document.getElementById('startHint').style.display = 'none';
        }

        // 2. é‡æ–°å¼€å§‹
        function restart() {
            location.reload();
        }

        // 3. æ¸¸æˆå¾ªç¯
        function gameLoop() {
            update();
            draw();
            animationId = requestAnimationFrame(gameLoop);
        }

        // 4. ç»˜åˆ¶å‡½æ•°æ•´åˆ
        function draw() {
            drawBackground();
            drawPlatforms();
            drawPlayer();
            drawPowerBar();
        }

        // ä¹ã€äº‹ä»¶å¤„ç†
        function bindEvents() {
            // 1. é¼ æ ‡äº‹ä»¶
            canvas.addEventListener('mousedown', startCharging);
            canvas.addEventListener('mouseup', jump);
            canvas.addEventListener('mouseleave', cancelCharging);
            
            // 2. è§¦æ‘¸äº‹ä»¶
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                startCharging();
            });
            canvas.addEventListener('touchend', (e) => {
                e.preventDefault();
                jump();
            });
            
            // 3. é‡æ–°å¼€å§‹æŒ‰é’®
            document.getElementById('restartBtn').addEventListener('click', restart);
            
            // 4. çª—å£è°ƒæ•´
            window.addEventListener('resize', handleResize);
        }

        // 1. å¼€å§‹è“„åŠ›
        function startCharging() {
            if (gameRunning && !player.jumping) {
                isCharging = true;
                power = 0;
            }
        }

        // 2. è·³è·ƒ
        function jump() {
            if (gameRunning && isCharging) {
                isCharging = false;
                player.jumping = true;
                player.vx = power / 5;
                player.vy = -power / 3;
                power = 0;
            }
        }

        // 3. å–æ¶ˆè“„åŠ›
        function cancelCharging() {
            if (isCharging) {
                isCharging = false;
                power = 0;
            }
        }

        // 4. å¤„ç†çª—å£è°ƒæ•´
        function handleResize() {
            GAME_CONFIG.canvasWidth = window.innerWidth * 0.9;
            GAME_CONFIG.canvasHeight = window.innerHeight * 0.8;
            canvas.width = GAME_CONFIG.canvasWidth;
            canvas.height = GAME_CONFIG.canvasHeight;
        }

        // åã€è“„åŠ›ç³»ç»Ÿ
        setInterval(() => {
            if (isCharging && power < GAME_CONFIG.maxPower) {
                power += GAME_CONFIG.powerIncrement;
            }
        }, GAME_CONFIG.powerInterval);

        // åä¸€ã€å¯åŠ¨æ¸¸æˆ
        window.addEventListener('load', init);
    </script>
</body>
</html>
